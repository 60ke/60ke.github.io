<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content=" å®æ—¶æ•°æ®ä»“åº“èƒ½å¤Ÿå¤„ç†é«˜ååé‡çš„æ•°æ®æµå¹¶æ”¯æŒä½å»¶è¿Ÿåˆ†ææŸ¥è¯¢ã€‚Golang ä»¥å…¶é«˜å¹¶å‘æ€§èƒ½å’Œç®€æ´çš„è¯­æ³•ï¼Œç»“åˆ ClickHouse çš„é«˜æ•ˆåˆ—å¼å­˜å‚¨ï¼Œæ˜¯æ„å»ºå®æ—¶æ•°æ®ç®¡é“çš„ç†æƒ³é€‰æ‹©ã€‚æœ¬æ–‡å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Golang ä» Kafka æ¶ˆè´¹è®¢å•æ•°æ®ï¼Œæ‰§è¡Œå®æ—¶ ETLï¼Œå¹¶å­˜å‚¨åˆ° ClickHouseï¼Œæ”¯æŒå®æ—¶æŸ¥è¯¢åˆ†æã€‚\nğŸ’¡ èƒŒæ™¯ä¸åŠ¨æœº å®æ—¶æ•°æ®ä»“åº“é€šè¿‡æµå¤„ç†å’Œå¿«é€ŸæŸ¥è¯¢ï¼Œæ»¡è¶³ä¼ä¸šå¯¹æ•°æ®æ—¶æ•ˆæ€§å’Œåˆ†æèƒ½åŠ›çš„éœ€æ±‚ã€‚æœ¬ç¤ºä¾‹å°†ï¼š\nä½¿ç”¨ Golang ä» Kafka æ¶ˆè´¹è®¢å•æ•°æ®ï¼Œè¿›è¡Œæ¸…æ´—å’Œèšåˆã€‚ å°†å¤„ç†åçš„æ•°æ®å†™å…¥ ClickHouseï¼Œæ„å»ºæ•°æ®ä»“åº“çš„ DWDï¼ˆData Warehouse Detailï¼‰å±‚ã€‚ ä½¿ç”¨ ClickHouse æ‰§è¡Œå®æ—¶åˆ†ææŸ¥è¯¢ï¼Œå±•ç¤ºè®¢å•ç»Ÿè®¡ã€‚ åœºæ™¯ï¼šå¤„ç†ç”µå•†å¹³å°çš„å®æ—¶è®¢å•æ•°æ®ï¼Œè®¡ç®—æ¯åˆ†é’Ÿçš„è®¢å•æ€»æ•°å’Œæ€»é‡‘é¢ï¼Œå¹¶å­˜å‚¨åˆ° ClickHouse ä»¥æ”¯æŒå®æ—¶ä»ªè¡¨ç›˜æŸ¥è¯¢ã€‚\næŠ€æœ¯æ ˆï¼š\nKafkaï¼šå­˜å‚¨åŸå§‹è®¢å•æ•°æ®ã€‚ Golangï¼šæ‰§è¡Œå®æ—¶ ETLï¼ŒåŸºäº saramaï¼ˆKafka å®¢æˆ·ç«¯ï¼‰å’Œ clickhouse-goã€‚ ClickHouseï¼šå­˜å‚¨å¤„ç†åçš„æ•°æ®ï¼Œæ”¯æŒå¿«é€Ÿ OLAP æŸ¥è¯¢ã€‚ ğŸ› ï¸ å‰ç½®æ¡ä»¶ ç¡®ä¿ä»¥ä¸‹å·¥å…·å·²å®‰è£…ï¼š\nGolang 1.21+ï¼ˆæœ¬æ–‡ä½¿ç”¨ 1.22ï¼‰ã€‚ ClickHouse 24.xï¼ˆæ”¯æŒé«˜æ•ˆåˆ—å¼å­˜å‚¨ï¼‰ã€‚ Kafka 3.xï¼ˆæœ¬æ–‡ä½¿ç”¨ 3.5.1ï¼‰ã€‚ Go æ¨¡å—æ”¯æŒï¼ˆgo modï¼‰ã€‚ è¿è¡Œç¯å¢ƒï¼š\næœ¬åœ°æˆ–äº‘æœåŠ¡å™¨ï¼ˆæ¨è 8GB å†…å­˜ï¼Œ4 æ ¸ CPUï¼‰ã€‚ Dockerï¼ˆå¯é€‰ï¼Œç”¨äºå¿«é€Ÿéƒ¨ç½² Kafka å’Œ ClickHouseï¼‰ã€‚ ğŸ”§ é¡¹ç›®è®¾ç½® 1. é…ç½® Kafka å’Œ ClickHouse ä½¿ç”¨ Docker å¿«é€Ÿéƒ¨ç½²ï¼š\n"><title>Goå’ŒClickHouseæ„å»ºæœ€å°åŒ–å®æ—¶æ•°æ®ä»“åº“</title><link rel=canonical href=https://60ke.github.io/posts/go%E5%92%8Cclickhouse%E6%9E%84%E5%BB%BA%E6%9C%80%E5%B0%8F%E5%8C%96%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/><link rel=stylesheet href=/scss/style.min.946cca6c6259ef94ac55abfae7c7bf3291ea3ed5eea17ef77500b257217c6710.css><meta property='og:title' content="Goå’ŒClickHouseæ„å»ºæœ€å°åŒ–å®æ—¶æ•°æ®ä»“åº“"><meta property='og:description' content=" å®æ—¶æ•°æ®ä»“åº“èƒ½å¤Ÿå¤„ç†é«˜ååé‡çš„æ•°æ®æµå¹¶æ”¯æŒä½å»¶è¿Ÿåˆ†ææŸ¥è¯¢ã€‚Golang ä»¥å…¶é«˜å¹¶å‘æ€§èƒ½å’Œç®€æ´çš„è¯­æ³•ï¼Œç»“åˆ ClickHouse çš„é«˜æ•ˆåˆ—å¼å­˜å‚¨ï¼Œæ˜¯æ„å»ºå®æ—¶æ•°æ®ç®¡é“çš„ç†æƒ³é€‰æ‹©ã€‚æœ¬æ–‡å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Golang ä» Kafka æ¶ˆè´¹è®¢å•æ•°æ®ï¼Œæ‰§è¡Œå®æ—¶ ETLï¼Œå¹¶å­˜å‚¨åˆ° ClickHouseï¼Œæ”¯æŒå®æ—¶æŸ¥è¯¢åˆ†æã€‚\nğŸ’¡ èƒŒæ™¯ä¸åŠ¨æœº å®æ—¶æ•°æ®ä»“åº“é€šè¿‡æµå¤„ç†å’Œå¿«é€ŸæŸ¥è¯¢ï¼Œæ»¡è¶³ä¼ä¸šå¯¹æ•°æ®æ—¶æ•ˆæ€§å’Œåˆ†æèƒ½åŠ›çš„éœ€æ±‚ã€‚æœ¬ç¤ºä¾‹å°†ï¼š\nä½¿ç”¨ Golang ä» Kafka æ¶ˆè´¹è®¢å•æ•°æ®ï¼Œè¿›è¡Œæ¸…æ´—å’Œèšåˆã€‚ å°†å¤„ç†åçš„æ•°æ®å†™å…¥ ClickHouseï¼Œæ„å»ºæ•°æ®ä»“åº“çš„ DWDï¼ˆData Warehouse Detailï¼‰å±‚ã€‚ ä½¿ç”¨ ClickHouse æ‰§è¡Œå®æ—¶åˆ†ææŸ¥è¯¢ï¼Œå±•ç¤ºè®¢å•ç»Ÿè®¡ã€‚ åœºæ™¯ï¼šå¤„ç†ç”µå•†å¹³å°çš„å®æ—¶è®¢å•æ•°æ®ï¼Œè®¡ç®—æ¯åˆ†é’Ÿçš„è®¢å•æ€»æ•°å’Œæ€»é‡‘é¢ï¼Œå¹¶å­˜å‚¨åˆ° ClickHouse ä»¥æ”¯æŒå®æ—¶ä»ªè¡¨ç›˜æŸ¥è¯¢ã€‚\næŠ€æœ¯æ ˆï¼š\nKafkaï¼šå­˜å‚¨åŸå§‹è®¢å•æ•°æ®ã€‚ Golangï¼šæ‰§è¡Œå®æ—¶ ETLï¼ŒåŸºäº saramaï¼ˆKafka å®¢æˆ·ç«¯ï¼‰å’Œ clickhouse-goã€‚ ClickHouseï¼šå­˜å‚¨å¤„ç†åçš„æ•°æ®ï¼Œæ”¯æŒå¿«é€Ÿ OLAP æŸ¥è¯¢ã€‚ ğŸ› ï¸ å‰ç½®æ¡ä»¶ ç¡®ä¿ä»¥ä¸‹å·¥å…·å·²å®‰è£…ï¼š\nGolang 1.21+ï¼ˆæœ¬æ–‡ä½¿ç”¨ 1.22ï¼‰ã€‚ ClickHouse 24.xï¼ˆæ”¯æŒé«˜æ•ˆåˆ—å¼å­˜å‚¨ï¼‰ã€‚ Kafka 3.xï¼ˆæœ¬æ–‡ä½¿ç”¨ 3.5.1ï¼‰ã€‚ Go æ¨¡å—æ”¯æŒï¼ˆgo modï¼‰ã€‚ è¿è¡Œç¯å¢ƒï¼š\næœ¬åœ°æˆ–äº‘æœåŠ¡å™¨ï¼ˆæ¨è 8GB å†…å­˜ï¼Œ4 æ ¸ CPUï¼‰ã€‚ Dockerï¼ˆå¯é€‰ï¼Œç”¨äºå¿«é€Ÿéƒ¨ç½² Kafka å’Œ ClickHouseï¼‰ã€‚ ğŸ”§ é¡¹ç›®è®¾ç½® 1. é…ç½® Kafka å’Œ ClickHouse ä½¿ç”¨ Docker å¿«é€Ÿéƒ¨ç½²ï¼š\n"><meta property='og:url' content='https://60ke.github.io/posts/go%E5%92%8Cclickhouse%E6%9E%84%E5%BB%BA%E6%9C%80%E5%B0%8F%E5%8C%96%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/'><meta property='og:site_name' content='LookForAdmin'><meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:published_time' content='2024-08-01T19:27:10+08:00'><meta property='article:modified_time' content='2024-08-01T19:27:10+08:00'><meta name=twitter:title content="Goå’ŒClickHouseæ„å»ºæœ€å°åŒ–å®æ—¶æ•°æ®ä»“åº“"><meta name=twitter:description content=" å®æ—¶æ•°æ®ä»“åº“èƒ½å¤Ÿå¤„ç†é«˜ååé‡çš„æ•°æ®æµå¹¶æ”¯æŒä½å»¶è¿Ÿåˆ†ææŸ¥è¯¢ã€‚Golang ä»¥å…¶é«˜å¹¶å‘æ€§èƒ½å’Œç®€æ´çš„è¯­æ³•ï¼Œç»“åˆ ClickHouse çš„é«˜æ•ˆåˆ—å¼å­˜å‚¨ï¼Œæ˜¯æ„å»ºå®æ—¶æ•°æ®ç®¡é“çš„ç†æƒ³é€‰æ‹©ã€‚æœ¬æ–‡å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Golang ä» Kafka æ¶ˆè´¹è®¢å•æ•°æ®ï¼Œæ‰§è¡Œå®æ—¶ ETLï¼Œå¹¶å­˜å‚¨åˆ° ClickHouseï¼Œæ”¯æŒå®æ—¶æŸ¥è¯¢åˆ†æã€‚\nğŸ’¡ èƒŒæ™¯ä¸åŠ¨æœº å®æ—¶æ•°æ®ä»“åº“é€šè¿‡æµå¤„ç†å’Œå¿«é€ŸæŸ¥è¯¢ï¼Œæ»¡è¶³ä¼ä¸šå¯¹æ•°æ®æ—¶æ•ˆæ€§å’Œåˆ†æèƒ½åŠ›çš„éœ€æ±‚ã€‚æœ¬ç¤ºä¾‹å°†ï¼š\nä½¿ç”¨ Golang ä» Kafka æ¶ˆè´¹è®¢å•æ•°æ®ï¼Œè¿›è¡Œæ¸…æ´—å’Œèšåˆã€‚ å°†å¤„ç†åçš„æ•°æ®å†™å…¥ ClickHouseï¼Œæ„å»ºæ•°æ®ä»“åº“çš„ DWDï¼ˆData Warehouse Detailï¼‰å±‚ã€‚ ä½¿ç”¨ ClickHouse æ‰§è¡Œå®æ—¶åˆ†ææŸ¥è¯¢ï¼Œå±•ç¤ºè®¢å•ç»Ÿè®¡ã€‚ åœºæ™¯ï¼šå¤„ç†ç”µå•†å¹³å°çš„å®æ—¶è®¢å•æ•°æ®ï¼Œè®¡ç®—æ¯åˆ†é’Ÿçš„è®¢å•æ€»æ•°å’Œæ€»é‡‘é¢ï¼Œå¹¶å­˜å‚¨åˆ° ClickHouse ä»¥æ”¯æŒå®æ—¶ä»ªè¡¨ç›˜æŸ¥è¯¢ã€‚\næŠ€æœ¯æ ˆï¼š\nKafkaï¼šå­˜å‚¨åŸå§‹è®¢å•æ•°æ®ã€‚ Golangï¼šæ‰§è¡Œå®æ—¶ ETLï¼ŒåŸºäº saramaï¼ˆKafka å®¢æˆ·ç«¯ï¼‰å’Œ clickhouse-goã€‚ ClickHouseï¼šå­˜å‚¨å¤„ç†åçš„æ•°æ®ï¼Œæ”¯æŒå¿«é€Ÿ OLAP æŸ¥è¯¢ã€‚ ğŸ› ï¸ å‰ç½®æ¡ä»¶ ç¡®ä¿ä»¥ä¸‹å·¥å…·å·²å®‰è£…ï¼š\nGolang 1.21+ï¼ˆæœ¬æ–‡ä½¿ç”¨ 1.22ï¼‰ã€‚ ClickHouse 24.xï¼ˆæ”¯æŒé«˜æ•ˆåˆ—å¼å­˜å‚¨ï¼‰ã€‚ Kafka 3.xï¼ˆæœ¬æ–‡ä½¿ç”¨ 3.5.1ï¼‰ã€‚ Go æ¨¡å—æ”¯æŒï¼ˆgo modï¼‰ã€‚ è¿è¡Œç¯å¢ƒï¼š\næœ¬åœ°æˆ–äº‘æœåŠ¡å™¨ï¼ˆæ¨è 8GB å†…å­˜ï¼Œ4 æ ¸ CPUï¼‰ã€‚ Dockerï¼ˆå¯é€‰ï¼Œç”¨äºå¿«é€Ÿéƒ¨ç½² Kafka å’Œ ClickHouseï¼‰ã€‚ ğŸ”§ é¡¹ç›®è®¾ç½® 1. é…ç½® Kafka å’Œ ClickHouse ä½¿ç”¨ Docker å¿«é€Ÿéƒ¨ç½²ï¼š\n"><link rel="shortcut icon" href=/img/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/Avatar.jpeg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ¥</span></figure><div class=site-meta><h1 class=site-name><a href=/>LookForAdmin</a></h1><h2 class=site-description>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</h2></div></header><ol class=menu-social><li><a href=https://github.com/60ke target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/posts target=_blank><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/drafts><svg class="icon icon-tabler icon-tabler-infinity" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M9.828 9.172a4 4 0 100 5.656A10 10 0 0012 12a10 10 0 012.172-2.828 4 4 0 110 5.656A10 10 0 0112 12 10 10 0 009.828 9.172"/></svg>
<span>è‰ç¨¿ç®±</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>about</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#-èƒŒæ™¯ä¸åŠ¨æœº>ğŸ’¡ èƒŒæ™¯ä¸åŠ¨æœº</a></li><li><a href=#-å‰ç½®æ¡ä»¶>ğŸ› ï¸ å‰ç½®æ¡ä»¶</a></li><li><a href=#-é¡¹ç›®è®¾ç½®>ğŸ”§ é¡¹ç›®è®¾ç½®</a><ol><li><a href=#1-é…ç½®-kafka-å’Œ-clickhouse>1. é…ç½® Kafka å’Œ ClickHouse</a></li><li><a href=#2-åˆ›å»º-golang-é¡¹ç›®>2. åˆ›å»º Golang é¡¹ç›®</a></li></ol></li><li><a href=#-å®ç°æœ€å°åŒ–æ•°æ®ä»“åº“>ğŸ§ª å®ç°æœ€å°åŒ–æ•°æ®ä»“åº“</a><ol><li><a href=#1-æ•°æ®æ¨¡å‹>1. æ•°æ®æ¨¡å‹</a></li><li><a href=#2-golang-etl-ä»£ç >2. Golang ETL ä»£ç </a></li><li><a href=#3-è¿è¡Œä¸æµ‹è¯•>3. è¿è¡Œä¸æµ‹è¯•</a></li></ol></li><li><a href=#-æ€§èƒ½åˆ†æ>ğŸ“ˆ æ€§èƒ½åˆ†æ</a></li><li><a href=#-æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹>ğŸ›¡ï¸ æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹</a></li><li><a href=#-æ€»ç»“>ğŸ§  æ€»ç»“</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/posts/go%E5%92%8Cclickhouse%E6%9E%84%E5%BB%BA%E6%9C%80%E5%B0%8F%E5%8C%96%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/>Goå’ŒClickHouseæ„å»ºæœ€å°åŒ–å®æ—¶æ•°æ®ä»“åº“</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Aug 01, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 6 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><blockquote><p>å®æ—¶æ•°æ®ä»“åº“èƒ½å¤Ÿå¤„ç†é«˜ååé‡çš„æ•°æ®æµå¹¶æ”¯æŒä½å»¶è¿Ÿåˆ†ææŸ¥è¯¢ã€‚<strong>Golang</strong> ä»¥å…¶é«˜å¹¶å‘æ€§èƒ½å’Œç®€æ´çš„è¯­æ³•ï¼Œç»“åˆ <strong>ClickHouse</strong> çš„é«˜æ•ˆåˆ—å¼å­˜å‚¨ï¼Œæ˜¯æ„å»ºå®æ—¶æ•°æ®ç®¡é“çš„ç†æƒ³é€‰æ‹©ã€‚æœ¬æ–‡å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Golang ä» Kafka æ¶ˆè´¹è®¢å•æ•°æ®ï¼Œæ‰§è¡Œå®æ—¶ ETLï¼Œå¹¶å­˜å‚¨åˆ° ClickHouseï¼Œæ”¯æŒå®æ—¶æŸ¥è¯¢åˆ†æã€‚</p></blockquote><h2 id=-èƒŒæ™¯ä¸åŠ¨æœº>ğŸ’¡ èƒŒæ™¯ä¸åŠ¨æœº</h2><p>å®æ—¶æ•°æ®ä»“åº“é€šè¿‡æµå¤„ç†å’Œå¿«é€ŸæŸ¥è¯¢ï¼Œæ»¡è¶³ä¼ä¸šå¯¹æ•°æ®æ—¶æ•ˆæ€§å’Œåˆ†æèƒ½åŠ›çš„éœ€æ±‚ã€‚æœ¬ç¤ºä¾‹å°†ï¼š</p><ul><li>ä½¿ç”¨ <strong>Golang</strong> ä» Kafka æ¶ˆè´¹è®¢å•æ•°æ®ï¼Œè¿›è¡Œæ¸…æ´—å’Œèšåˆã€‚</li><li>å°†å¤„ç†åçš„æ•°æ®å†™å…¥ <strong>ClickHouse</strong>ï¼Œæ„å»ºæ•°æ®ä»“åº“çš„ DWDï¼ˆData Warehouse Detailï¼‰å±‚ã€‚</li><li>ä½¿ç”¨ ClickHouse æ‰§è¡Œå®æ—¶åˆ†ææŸ¥è¯¢ï¼Œå±•ç¤ºè®¢å•ç»Ÿè®¡ã€‚</li></ul><p><strong>åœºæ™¯</strong>ï¼šå¤„ç†ç”µå•†å¹³å°çš„å®æ—¶è®¢å•æ•°æ®ï¼Œè®¡ç®—æ¯åˆ†é’Ÿçš„è®¢å•æ€»æ•°å’Œæ€»é‡‘é¢ï¼Œå¹¶å­˜å‚¨åˆ° ClickHouse ä»¥æ”¯æŒå®æ—¶ä»ªè¡¨ç›˜æŸ¥è¯¢ã€‚</p><p><strong>æŠ€æœ¯æ ˆ</strong>ï¼š</p><ul><li><strong>Kafka</strong>ï¼šå­˜å‚¨åŸå§‹è®¢å•æ•°æ®ã€‚</li><li><strong>Golang</strong>ï¼šæ‰§è¡Œå®æ—¶ ETLï¼ŒåŸºäº <code>sarama</code>ï¼ˆKafka å®¢æˆ·ç«¯ï¼‰å’Œ <code>clickhouse-go</code>ã€‚</li><li><strong>ClickHouse</strong>ï¼šå­˜å‚¨å¤„ç†åçš„æ•°æ®ï¼Œæ”¯æŒå¿«é€Ÿ OLAP æŸ¥è¯¢ã€‚</li></ul><h2 id=-å‰ç½®æ¡ä»¶>ğŸ› ï¸ å‰ç½®æ¡ä»¶</h2><p>ç¡®ä¿ä»¥ä¸‹å·¥å…·å·²å®‰è£…ï¼š</p><ul><li><strong>Golang 1.21+</strong>ï¼ˆæœ¬æ–‡ä½¿ç”¨ 1.22ï¼‰ã€‚</li><li><strong>ClickHouse 24.x</strong>ï¼ˆæ”¯æŒé«˜æ•ˆåˆ—å¼å­˜å‚¨ï¼‰ã€‚</li><li><strong>Kafka 3.x</strong>ï¼ˆæœ¬æ–‡ä½¿ç”¨ 3.5.1ï¼‰ã€‚</li><li><strong>Go æ¨¡å—æ”¯æŒ</strong>ï¼ˆ<code>go mod</code>ï¼‰ã€‚</li></ul><p>è¿è¡Œç¯å¢ƒï¼š</p><ul><li>æœ¬åœ°æˆ–äº‘æœåŠ¡å™¨ï¼ˆæ¨è 8GB å†…å­˜ï¼Œ4 æ ¸ CPUï¼‰ã€‚</li><li>Dockerï¼ˆå¯é€‰ï¼Œç”¨äºå¿«é€Ÿéƒ¨ç½² Kafka å’Œ ClickHouseï¼‰ã€‚</li></ul><h2 id=-é¡¹ç›®è®¾ç½®>ğŸ”§ é¡¹ç›®è®¾ç½®</h2><h3 id=1-é…ç½®-kafka-å’Œ-clickhouse>1. é…ç½® Kafka å’Œ ClickHouse</h3><p>ä½¿ç”¨ Docker å¿«é€Ÿéƒ¨ç½²ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># å¯åŠ¨ Kafkaï¼ˆå¸¦ Zookeeperï¼‰</span>
</span></span><span class=line><span class=cl>docker run -d --name zookeeper -p 2181:2181 zookeeper:3.8
</span></span><span class=line><span class=cl>docker run -d --name kafka -p 9092:9092 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>KAFKA_ZOOKEEPER_CONNECT</span><span class=o>=</span>zookeeper:2181 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>KAFKA_ADVERTISED_LISTENERS</span><span class=o>=</span>PLAINTEXT://localhost:9092 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR</span><span class=o>=</span><span class=m>1</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  confluentinc/cp-kafka:7.5.1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å¯åŠ¨ ClickHouse</span>
</span></span><span class=line><span class=cl>docker run -d --name clickhouse -p 8123:8123 -p 9000:9000 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  clickhouse/clickhouse-server:24.8
</span></span></code></pre></td></tr></table></div></div><p>åˆ›å»º Kafka ä¸»é¢˜ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kafka-topics.sh --create --topic orders --bootstrap-server localhost:9092 --partitions <span class=m>1</span> --replication-factor <span class=m>1</span>
</span></span></code></pre></td></tr></table></div></div><p>åœ¨ ClickHouse ä¸­åˆ›å»ºç›®æ ‡è¡¨ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>default</span><span class=p>.</span><span class=n>orders_dwd</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>window_time</span><span class=w> </span><span class=n>DateTime</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>order_count</span><span class=w> </span><span class=n>UInt64</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>total_amount</span><span class=w> </span><span class=n>Float64</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MergeTree</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>window_time</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=2-åˆ›å»º-golang-é¡¹ç›®>2. åˆ›å»º Golang é¡¹ç›®</h3><p>åˆå§‹åŒ– Go é¡¹ç›®ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir flink-clickhouse-dw
</span></span><span class=line><span class=cl><span class=nb>cd</span> flink-clickhouse-dw
</span></span><span class=line><span class=cl>go mod init com.example/flink-clickhouse-dw
</span></span></code></pre></td></tr></table></div></div><p>å®‰è£…ä¾èµ–ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go get github.com/Shopify/sarama
</span></span><span class=line><span class=cl>go get github.com/ClickHouse/clickhouse-go/v2
</span></span><span class=line><span class=cl>go get github.com/buger/jsonparser
</span></span></code></pre></td></tr></table></div></div><p>ç¼–è¾‘ <code>go.mod</code>ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>module</span> <span class=nx>com</span><span class=p>.</span><span class=nx>example</span><span class=o>/</span><span class=nx>flink</span><span class=o>-</span><span class=nx>clickhouse</span><span class=o>-</span><span class=nx>dw</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>go</span> <span class=mf>1.22</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>require</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>Shopify</span><span class=o>/</span><span class=nx>sarama</span> <span class=nx>v1</span><span class=mf>.38.1</span>
</span></span><span class=line><span class=cl>    <span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>ClickHouse</span><span class=o>/</span><span class=nx>clickhouse</span><span class=o>-</span><span class=k>go</span><span class=o>/</span><span class=nx>v2</span> <span class=nx>v2</span><span class=mf>.16.0</span>
</span></span><span class=line><span class=cl>    <span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>buger</span><span class=o>/</span><span class=nx>jsonparser</span> <span class=nx>v1</span><span class=mf>.1.1</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=-å®ç°æœ€å°åŒ–æ•°æ®ä»“åº“>ğŸ§ª å®ç°æœ€å°åŒ–æ•°æ®ä»“åº“</h2><h3 id=1-æ•°æ®æ¨¡å‹>1. æ•°æ®æ¨¡å‹</h3><p>è®¢å•æ•°æ®çš„ JSON æ ¼å¼ï¼ˆKafka æ¶ˆæ¯ï¼‰ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;order_id&#34;</span><span class=p>:</span> <span class=s2>&#34;12345&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;user_id&#34;</span><span class=p>:</span> <span class=s2>&#34;user_001&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;amount&#34;</span><span class=p>:</span> <span class=mf>99.99</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=s2>&#34;2025-07-01T12:00:00Z&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Golang å°†ï¼š</p><ol><li>ä» Kafka ä¸»é¢˜ <code>orders</code> è¯»å–æ•°æ®ã€‚</li><li>æŒ‰åˆ†é’Ÿçª—å£èšåˆè®¢å•æ•°å’Œæ€»é‡‘é¢ã€‚</li><li>å°†ç»“æœæ‰¹é‡å†™å…¥ ClickHouse è¡¨ <code>orders_dwd</code>ã€‚</li></ol><h3 id=2-golang-etl-ä»£ç >2. Golang ETL ä»£ç </h3><p>åˆ›å»º <code>main.go</code>ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;log&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;sync&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/ClickHouse/clickhouse-go/v2&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/Shopify/sarama&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/buger/jsonparser&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Order å®šä¹‰è®¢å•æ•°æ®ç»“æ„</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Order</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>OrderID</span>   <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>UserID</span>    <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>Amount</span>    <span class=kt>float64</span>
</span></span><span class=line><span class=cl>	<span class=nx>Timestamp</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Time</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// OrderAggregate å®šä¹‰èšåˆç»“æœ</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>OrderAggregate</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>WindowTime</span>  <span class=nx>time</span><span class=p>.</span><span class=nx>Time</span>
</span></span><span class=line><span class=cl>	<span class=nx>OrderCount</span>  <span class=kt>uint64</span>
</span></span><span class=line><span class=cl>	<span class=nx>TotalAmount</span> <span class=kt>float64</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// KafkaConsumer æ¶ˆè´¹ Kafka æ•°æ®å¹¶èšåˆ</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>KafkaConsumer</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>consumer</span>    <span class=nx>sarama</span><span class=p>.</span><span class=nx>Consumer</span>
</span></span><span class=line><span class=cl>	<span class=nx>aggregates</span>  <span class=kd>chan</span> <span class=nx>OrderAggregate</span>
</span></span><span class=line><span class=cl>	<span class=nx>clickhouse</span>  <span class=nx>clickhouse</span><span class=p>.</span><span class=nx>Conn</span>
</span></span><span class=line><span class=cl>	<span class=nx>batch</span>       <span class=p>[]</span><span class=nx>OrderAggregate</span>
</span></span><span class=line><span class=cl>	<span class=nx>batchSize</span>   <span class=kt>int</span>
</span></span><span class=line><span class=cl>	<span class=nx>batchTicker</span> <span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Ticker</span>
</span></span><span class=line><span class=cl>	<span class=nx>mutex</span>       <span class=nx>sync</span><span class=p>.</span><span class=nx>Mutex</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewKafkaConsumer</span><span class=p>(</span><span class=nx>brokers</span> <span class=p>[]</span><span class=kt>string</span><span class=p>,</span> <span class=nx>topic</span> <span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>KafkaConsumer</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>consumer</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>sarama</span><span class=p>.</span><span class=nf>NewConsumer</span><span class=p>(</span><span class=nx>brokers</span><span class=p>,</span> <span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;failed to create consumer: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>conn</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>clickhouse</span><span class=p>.</span><span class=nf>Open</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>clickhouse</span><span class=p>.</span><span class=nx>Options</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Addr</span><span class=p>:</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;localhost:9000&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>Auth</span><span class=p>:</span> <span class=nx>clickhouse</span><span class=p>.</span><span class=nx>Auth</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>Database</span><span class=p>:</span> <span class=s>&#34;default&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>Username</span><span class=p>:</span> <span class=s>&#34;default&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>Password</span><span class=p>:</span> <span class=s>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;failed to connect to ClickHouse: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=o>&amp;</span><span class=nx>KafkaConsumer</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>consumer</span><span class=p>:</span>    <span class=nx>consumer</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>aggregates</span><span class=p>:</span>  <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=nx>OrderAggregate</span><span class=p>,</span> <span class=mi>1000</span><span class=p>),</span>
</span></span><span class=line><span class=cl>		<span class=nx>clickhouse</span><span class=p>:</span>  <span class=nx>conn</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>batch</span><span class=p>:</span>       <span class=nb>make</span><span class=p>([]</span><span class=nx>OrderAggregate</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>100</span><span class=p>),</span>
</span></span><span class=line><span class=cl>		<span class=nx>batchSize</span><span class=p>:</span>   <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>batchTicker</span><span class=p>:</span> <span class=nx>time</span><span class=p>.</span><span class=nf>NewTicker</span><span class=p>(</span><span class=mi>10</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Consume æ¶ˆè´¹ Kafka æ•°æ®å¹¶èšåˆ</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>kc</span> <span class=o>*</span><span class=nx>KafkaConsumer</span><span class=p>)</span> <span class=nf>Consume</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>topic</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>partitionConsumer</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>kc</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nf>ConsumePartition</span><span class=p>(</span><span class=nx>topic</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>sarama</span><span class=p>.</span><span class=nx>OffsetOldest</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;failed to consume partition: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>go</span> <span class=nx>kc</span><span class=p>.</span><span class=nf>processAggregates</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>select</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>case</span> <span class=o>&lt;-</span><span class=nx>ctx</span><span class=p>.</span><span class=nf>Done</span><span class=p>():</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nx>partitionConsumer</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=k>case</span> <span class=nx>msg</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>partitionConsumer</span><span class=p>.</span><span class=nf>Messages</span><span class=p>():</span>
</span></span><span class=line><span class=cl>			<span class=nx>order</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nf>parseOrder</span><span class=p>(</span><span class=nx>msg</span><span class=p>.</span><span class=nx>Value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;failed to parse order: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>				<span class=k>continue</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=nx>kc</span><span class=p>.</span><span class=nf>aggregateOrder</span><span class=p>(</span><span class=nx>order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// parseOrder è§£æ JSON æ•°æ®</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>parseOrder</span><span class=p>(</span><span class=nx>data</span> <span class=p>[]</span><span class=kt>byte</span><span class=p>)</span> <span class=p>(</span><span class=nx>Order</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>orderID</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>jsonparser</span><span class=p>.</span><span class=nf>GetString</span><span class=p>(</span><span class=nx>data</span><span class=p>,</span> <span class=s>&#34;order_id&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>Order</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>userID</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>jsonparser</span><span class=p>.</span><span class=nf>GetString</span><span class=p>(</span><span class=nx>data</span><span class=p>,</span> <span class=s>&#34;user_id&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>Order</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>amount</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>jsonparser</span><span class=p>.</span><span class=nf>GetFloat</span><span class=p>(</span><span class=nx>data</span><span class=p>,</span> <span class=s>&#34;amount&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>Order</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>timestampStr</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>jsonparser</span><span class=p>.</span><span class=nf>GetString</span><span class=p>(</span><span class=nx>data</span><span class=p>,</span> <span class=s>&#34;timestamp&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>Order</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>timestamp</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Parse</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>RFC3339</span><span class=p>,</span> <span class=nx>timestampStr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>Order</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>Order</span><span class=p>{</span><span class=nx>OrderID</span><span class=p>:</span> <span class=nx>orderID</span><span class=p>,</span> <span class=nx>UserID</span><span class=p>:</span> <span class=nx>userID</span><span class=p>,</span> <span class=nx>Amount</span><span class=p>:</span> <span class=nx>amount</span><span class=p>,</span> <span class=nx>Timestamp</span><span class=p>:</span> <span class=nx>timestamp</span><span class=p>},</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// aggregateOrder æŒ‰åˆ†é’Ÿçª—å£èšåˆ</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>kc</span> <span class=o>*</span><span class=nx>KafkaConsumer</span><span class=p>)</span> <span class=nf>aggregateOrder</span><span class=p>(</span><span class=nx>order</span> <span class=nx>Order</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>windowTime</span> <span class=o>:=</span> <span class=nx>order</span><span class=p>.</span><span class=nx>Timestamp</span><span class=p>.</span><span class=nf>Truncate</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Minute</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>aggregate</span> <span class=o>:=</span> <span class=nx>OrderAggregate</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>WindowTime</span><span class=p>:</span>  <span class=nx>windowTime</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>OrderCount</span><span class=p>:</span>  <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>TotalAmount</span><span class=p>:</span> <span class=nx>order</span><span class=p>.</span><span class=nx>Amount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>kc</span><span class=p>.</span><span class=nx>aggregates</span> <span class=o>&lt;-</span> <span class=nx>aggregate</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// processAggregates å¤„ç†èšåˆæ•°æ®å¹¶å†™å…¥ ClickHouse</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>kc</span> <span class=o>*</span><span class=nx>KafkaConsumer</span><span class=p>)</span> <span class=nf>processAggregates</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>aggMap</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=p>]</span><span class=o>*</span><span class=nx>OrderAggregate</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>select</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>case</span> <span class=o>&lt;-</span><span class=nx>ctx</span><span class=p>.</span><span class=nf>Done</span><span class=p>():</span>
</span></span><span class=line><span class=cl>			<span class=nx>kc</span><span class=p>.</span><span class=nf>flushBatch</span><span class=p>()</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=k>case</span> <span class=nx>agg</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>kc</span><span class=p>.</span><span class=nx>aggregates</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=nx>kc</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=nx>existing</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>aggMap</span><span class=p>[</span><span class=nx>agg</span><span class=p>.</span><span class=nx>WindowTime</span><span class=p>];</span> <span class=nx>ok</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=nx>existing</span><span class=p>.</span><span class=nx>OrderCount</span> <span class=o>+=</span> <span class=nx>agg</span><span class=p>.</span><span class=nx>OrderCount</span>
</span></span><span class=line><span class=cl>				<span class=nx>existing</span><span class=p>.</span><span class=nx>TotalAmount</span> <span class=o>+=</span> <span class=nx>agg</span><span class=p>.</span><span class=nx>TotalAmount</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=nx>aggMap</span><span class=p>[</span><span class=nx>agg</span><span class=p>.</span><span class=nx>WindowTime</span><span class=p>]</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>OrderAggregate</span><span class=p>{</span>
</span></span><span class=line><span class=cl>					<span class=nx>WindowTime</span><span class=p>:</span>  <span class=nx>agg</span><span class=p>.</span><span class=nx>WindowTime</span><span class=p>,</span>
</span></span><span class=line><span class=cl>					<span class=nx>OrderCount</span><span class=p>:</span>  <span class=nx>agg</span><span class=p>.</span><span class=nx>OrderCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>					<span class=nx>TotalAmount</span><span class=p>:</span> <span class=nx>agg</span><span class=p>.</span><span class=nx>TotalAmount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=nx>kc</span><span class=p>.</span><span class=nx>batch</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>kc</span><span class=p>.</span><span class=nx>batch</span><span class=p>,</span> <span class=o>*</span><span class=nx>_aggMap</span><span class=p>[</span><span class=nx>agg</span><span class=p>.</span><span class=nx>WindowTime</span><span class=p>])</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>kc</span><span class=p>.</span><span class=nx>batch</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=nx>kc</span><span class=p>.</span><span class=nx>batchSize</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=nx>kc</span><span class=p>.</span><span class=nf>flushBatch</span><span class=p>()</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=nx>kc</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=k>case</span> <span class=o>&lt;-</span><span class=nx>kc</span><span class=p>.</span><span class=nx>batchTicker</span><span class=p>.</span><span class=nx>C</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=nx>kc</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>kc</span><span class=p>.</span><span class=nx>batch</span><span class=p>)</span> <span class=p>&gt;</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=nx>kc</span><span class=p>.</span><span class=nf>flushBatch</span><span class=p>()</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=nx>kc</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// flushBatch æ‰¹é‡å†™å…¥ ClickHouse</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>kc</span> <span class=o>*</span><span class=nx>KafkaConsumer</span><span class=p>)</span> <span class=nf>flushBatch</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>kc</span><span class=p>.</span><span class=nx>batch</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>batch</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>kc</span><span class=p>.</span><span class=nx>clickhouse</span><span class=p>.</span><span class=nf>PrepareBatch</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>(),</span> <span class=s>&#34;INSERT INTO orders_dwd&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;failed to prepare batch: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>agg</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>kc</span><span class=p>.</span><span class=nx>batch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>err</span> <span class=p>=</span> <span class=nx>batch</span><span class=p>.</span><span class=nf>Append</span><span class=p>(</span><span class=nx>agg</span><span class=p>.</span><span class=nx>WindowTime</span><span class=p>,</span> <span class=nx>agg</span><span class=p>.</span><span class=nx>OrderCount</span><span class=p>,</span> <span class=nx>agg</span><span class=p>.</span><span class=nx>TotalAmount</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;failed to append to batch: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>continue</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>batch</span><span class=p>.</span><span class=nf>Send</span><span class=p>();</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;failed to send batch: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>kc</span><span class=p>.</span><span class=nx>batch</span> <span class=p>=</span> <span class=nx>kc</span><span class=p>.</span><span class=nx>batch</span><span class=p>[:</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>ctx</span><span class=p>,</span> <span class=nx>cancel</span> <span class=o>:=</span> <span class=nx>context</span><span class=p>.</span><span class=nf>WithCancel</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>())</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nf>cancel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>consumer</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nf>NewKafkaConsumer</span><span class=p>([]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;localhost:9092&#34;</span><span class=p>},</span> <span class=s>&#34;orders&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;failed to initialize consumer: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>consumer</span><span class=p>.</span><span class=nx>clickhouse</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>consumer</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>consumer</span><span class=p>.</span><span class=nf>Consume</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;orders&#34;</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;consumer error: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>ä»£ç è¯´æ˜</strong>ï¼š</p><ul><li><strong>Kafka æ¶ˆè´¹</strong>ï¼šä½¿ç”¨ <code>sarama</code> ä» <code>orders</code> ä¸»é¢˜è¯»å– JSON æ•°æ®ï¼Œè§£æä¸º <code>Order</code> ç»“æ„ä½“ã€‚</li><li><strong>æ—¶é—´çª—å£èšåˆ</strong>ï¼šæŒ‰åˆ†é’Ÿçª—å£ï¼ˆ<code>Truncate(time.Minute)</code>ï¼‰èšåˆè®¢å•æ•°å’Œæ€»é‡‘é¢ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­çš„ <code>map</code>ã€‚</li><li><strong>æ‰¹é‡å†™å…¥</strong>ï¼šæ¯ 10 ç§’æˆ–ç´¯ç§¯ 100 æ¡è®°å½•æ—¶ï¼Œå°†èšåˆç»“æœæ‰¹é‡å†™å…¥ ClickHouseï¼Œå‡å°‘æ•°æ®åº“å‹åŠ›ã€‚</li><li><strong>å¹¶å‘å¤„ç†</strong>ï¼šä½¿ç”¨ Goroutine å¤„ç†èšåˆå’Œå†™å…¥ï¼Œç»“åˆ <code>sync.Mutex</code> ç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚</li><li><strong>é”™è¯¯å¤„ç†</strong>ï¼šæ•è·è§£æå’Œå†™å…¥é”™è¯¯ï¼Œç¡®ä¿ç¨‹åºé²æ£’æ€§ã€‚</li></ul><h3 id=3-è¿è¡Œä¸æµ‹è¯•>3. è¿è¡Œä¸æµ‹è¯•</h3><ol><li><strong>ç¼–è¯‘ä¸è¿è¡Œ</strong>ï¼š</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go build -o dw .
</span></span><span class=line><span class=cl>./dw
</span></span></code></pre></td></tr></table></div></div><ol start=2><li><strong>æ¨¡æ‹Ÿè®¢å•æ•°æ®</strong>ï¼š
ä½¿ç”¨ Kafka ç”Ÿäº§è€…å‘é€æµ‹è¯•æ•°æ®ï¼š</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kafka-console-producer.sh --topic orders --bootstrap-server localhost:9092
</span></span><span class=line><span class=cl>&gt;<span class=o>{</span><span class=s2>&#34;order_id&#34;</span>:<span class=s2>&#34;12345&#34;</span>,<span class=s2>&#34;user_id&#34;</span>:<span class=s2>&#34;user_001&#34;</span>,<span class=s2>&#34;amount&#34;</span>:99.99,<span class=s2>&#34;timestamp&#34;</span>:<span class=s2>&#34;2025-07-01T12:00:00Z&#34;</span><span class=o>}</span>
</span></span><span class=line><span class=cl>&gt;<span class=o>{</span><span class=s2>&#34;order_id&#34;</span>:<span class=s2>&#34;12346&#34;</span>,<span class=s2>&#34;user_id&#34;</span>:<span class=s2>&#34;user_002&#34;</span>,<span class=s2>&#34;amount&#34;</span>:49.99,<span class=s2>&#34;timestamp&#34;</span>:<span class=s2>&#34;2025-07-01T12:00:30Z&#34;</span><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><ol start=3><li><strong>æŸ¥è¯¢ ClickHouse</strong>ï¼š
åœ¨ ClickHouse å®¢æˆ·ç«¯æ‰§è¡Œï¼š</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>window_time</span><span class=p>,</span><span class=w> </span><span class=n>order_count</span><span class=p>,</span><span class=w> </span><span class=n>total_amount</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=k>default</span><span class=p>.</span><span class=n>orders_dwd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>window_time</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=s1>&#39;2025-07-01 12:00:00&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>ç¤ºä¾‹è¾“å‡º</strong>ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>window_time         | order_count | total_amount
</span></span><span class=line><span class=cl>--------------------|-------------|-------------
</span></span><span class=line><span class=cl>2025-07-01 12:00:00 | 2           | 149.98
</span></span></code></pre></td></tr></table></div></div><h2 id=-æ€§èƒ½åˆ†æ>ğŸ“ˆ æ€§èƒ½åˆ†æ</h2><p><strong>æµ‹è¯•ç¯å¢ƒ</strong>ï¼šMac M1, 8GB å†…å­˜ï¼Œå• Goroutineï¼ŒClickHouse å•èŠ‚ç‚¹ã€‚</p><p><strong>æ€§èƒ½æŒ‡æ ‡</strong>ï¼š</p><div class=table-wrapper><table><thead><tr><th><strong>æŒ‡æ ‡</strong></th><th><strong>å€¼</strong></th></tr></thead><tbody><tr><td>æ•°æ®è¾“å…¥é€Ÿç‡</td><td>50 æ¡/ç§’</td></tr><tr><td>å¤„ç†å»¶è¿Ÿ</td><td>~50ms</td></tr><tr><td>ClickHouse å†™å…¥å»¶è¿Ÿ</td><td>~30msï¼ˆæ‰¹é‡ï¼‰</td></tr><tr><td>æŸ¥è¯¢å»¶è¿Ÿï¼ˆ1 åˆ†é’Ÿæ•°æ®ï¼‰</td><td>&lt;10ms</td></tr></tbody></table></div><p><strong>åˆ†æ</strong>ï¼š</p><ul><li><strong>Golang</strong>ï¼šé«˜å¹¶å‘æ¨¡å‹ï¼ˆGoroutineï¼‰é€‚åˆå®æ—¶æµå¤„ç†ï¼Œå†…å­˜å ç”¨ä½ï¼ˆ~10MBï¼‰ã€‚</li><li><strong>ClickHouse</strong>ï¼šMergeTree å¼•æ“æ”¯æŒå¿«é€Ÿæ’å…¥å’ŒæŸ¥è¯¢ï¼Œåˆ—å¼å­˜å‚¨ä¼˜åŒ– OLAP æ€§èƒ½ã€‚</li><li><strong>ç“¶é¢ˆ</strong>ï¼šæ‰¹é‡å†™å…¥ä¾èµ–å®šæ—¶å™¨å’Œæ‰¹æ¬¡å¤§å°ï¼Œéœ€ä¼˜åŒ–ä»¥æ”¯æŒæ›´é«˜ååé‡ã€‚</li></ul><p><strong>ä¼˜åŒ–å»ºè®®</strong>ï¼š</p><ol><li><strong>æ‰¹é‡å†™å…¥ä¼˜åŒ–</strong>ï¼šè°ƒæ•´ <code>batchSize</code>ï¼ˆå¦‚ 1000ï¼‰ä»¥å‡å°‘å†™å…¥é¢‘ç‡ã€‚</li><li><strong>Kafka æ¶ˆè´¹è€…ç»„</strong>ï¼šä½¿ç”¨ <code>sarama</code> çš„æ¶ˆè´¹è€…ç»„æ”¯æŒå¤šåˆ†åŒºå¹¶è¡Œå¤„ç†ã€‚</li><li><strong>ClickHouse å¼‚æ­¥å†™å…¥</strong>ï¼šä½¿ç”¨ <code>clickhouse-go</code> çš„å¼‚æ­¥ API æå‡å†™å…¥æ€§èƒ½ã€‚</li><li><strong>Exactly-Once è¯­ä¹‰</strong>ï¼šé€šè¿‡ Kafka offset æäº¤å’Œ ClickHouse äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚</li></ol><h2 id=-æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹>ğŸ›¡ï¸ æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹</h2><ol><li><p><strong>Golang é…ç½®</strong>ï¼š</p><ul><li>ä½¿ç”¨ Goroutine æ± æ§åˆ¶å¹¶å‘ï¼Œé¿å…è¿‡å¤šçš„ Goroutine å¯¼è‡´èµ„æºç«äº‰ã€‚</li><li>é…ç½® <code>sarama</code> çš„ <code>ConsumerGroup</code> ä»¥æ”¯æŒé«˜ååé‡å’Œæ•…éšœæ¢å¤ã€‚</li></ul></li><li><p><strong>ClickHouse ä¼˜åŒ–</strong>ï¼š</p><ul><li>ä½¿ç”¨ MergeTree å¼•æ“ï¼Œè®¾ç½® <code>window_time</code> ä¸ºä¸»é”®ä»¥ä¼˜åŒ–æŸ¥è¯¢ã€‚</li><li>å¯ç”¨æ‰¹é‡å†™å…¥ï¼ˆ<code>PrepareBatch</code>ï¼‰ï¼Œè®¾ç½®åˆç†æ‰¹æ¬¡å¤§å°ï¼ˆå¦‚ 1000ï¼‰ã€‚</li></ul></li><li><p><strong>ç›‘æ§ä¸è°ƒè¯•</strong>ï¼š</p><ul><li>ä½¿ç”¨ <code>prometheus</code> ç›‘æ§ Kafka æ¶ˆè´¹å»¶è¿Ÿå’Œ ClickHouse å†™å…¥æ€§èƒ½ã€‚</li><li>è®°å½•æ—¥å¿—ï¼ˆ<code>log</code> åŒ…ï¼‰ä»¥è¿½è¸ªè§£æå’Œå†™å…¥é”™è¯¯ã€‚</li></ul></li><li><p><strong>ç”Ÿäº§æ³¨æ„äº‹é¡¹</strong>ï¼š</p><ul><li>éƒ¨ç½² ClickHouse é›†ç¾¤ä»¥æ”¯æŒé«˜å¯ç”¨æ€§å’Œåˆ†å¸ƒå¼æŸ¥è¯¢ã€‚</li><li>é…ç½® Kafka æ¶ˆè´¹è€…ç»„ä»¥å®ç°å¤šå®ä¾‹å¹¶è¡Œå¤„ç†ã€‚</li><li>å®šæœŸæ¸…ç† ClickHouse ä¸´æ—¶è¡¨å’Œ Kafka è¿‡æœŸæ•°æ®ã€‚</li></ul></li></ol><h2 id=-æ€»ç»“>ğŸ§  æ€»ç»“</h2><p>é€šè¿‡ Golang å’Œ ClickHouseï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªæœ€å°åŒ–çš„å®æ—¶æ•°æ®ä»“åº“ï¼Œä» Kafka æ¶ˆè´¹è®¢å•æ•°æ®ï¼Œæ‰§è¡Œå®æ—¶ ETLï¼Œå¹¶å­˜å‚¨åˆ° ClickHouse æ”¯æŒå¿«é€ŸæŸ¥è¯¢ã€‚Golang çš„é«˜å¹¶å‘æ€§å’Œ ClickHouse çš„ OLAP æ€§èƒ½ç›¸ç»“åˆï¼Œé€‚åˆæ„å»ºä½å»¶è¿Ÿã€é«˜ååçš„å®æ—¶åˆ†æç³»ç»Ÿã€‚æœ¬ç¤ºä¾‹å±•ç¤ºäº†åŸºæœ¬æ¶æ„ï¼Œç”Ÿäº§ç¯å¢ƒä¸­å¯é€šè¿‡ä¼˜åŒ–æ‰¹é‡å†™å…¥ã€æ¶ˆè´¹è€…ç»„å’Œäº‹åŠ¡æ”¯æŒè¿›ä¸€æ­¥æå‡æ€§èƒ½ã€‚</p><p>å¸Œæœ›æœ¬æ–‡çš„æ­¥éª¤å’Œä»£ç èƒ½å¸®åŠ©ä½ å¿«é€Ÿä¸Šæ‰‹ Golang å’Œ ClickHouseï¼Œæ„å»ºé«˜æ•ˆçš„å®æ—¶æ•°æ®ä»“åº“ï¼</p><p><strong>å‚è€ƒèµ„æº</strong>ï¼š</p><ul><li><a class=link href=https://github.com/ClickHouse/clickhouse-go target=_blank rel=noopener>ClickHouse Go å®¢æˆ·ç«¯</a></li><li><a class=link href=https://github.com/Shopify/sarama target=_blank rel=noopener>Sarama Kafka å®¢æˆ·ç«¯</a></li><li><a class=link href=https://clickhouse.com/docs/en/ target=_blank rel=noopener>ClickHouse æ–‡æ¡£</a></li></ul></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><script src=https://utteranc.es/client.js repo=60ke/blogs issue-term=pathname crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>let utterancesLoaded=!1;function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;utterancesLoaded=!0,setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{if(!utterancesLoaded)return;setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 LookForAdmin</section><section class=powerby>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>