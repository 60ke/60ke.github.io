<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>LookForAdmin</title><link>https://60ke.github.io/</link><description>Recent content on LookForAdmin</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Tue, 01 Jul 2025 17:11:42 +0800</lastBuildDate><atom:link href="https://60ke.github.io/index.xml" rel="self" type="application/rss+xml"/><item><title>goæ³›åž‹å®žè·µ</title><link>https://60ke.github.io/posts/go%E6%B3%9B%E5%9E%8B%E5%AE%9E%E8%B7%B5/</link><pubDate>Tue, 29 Mar 2022 10:15:27 +0800</pubDate><guid>https://60ke.github.io/posts/go%E6%B3%9B%E5%9E%8B%E5%AE%9E%E8%B7%B5/</guid><description>&lt;blockquote>
&lt;p>Go 1.18 å¼•å…¥äº†æ³›åž‹æ”¯æŒï¼Œè¿™ä¸€ç‰¹æ€§ä¸º Go å¼€å‘è€…å¸¦æ¥äº†æ›´çµæ´»çš„ç¼–ç¨‹æ–¹å¼ã€‚æœ¬æ–‡ç»“åˆå®˜æ–¹æ–‡æ¡£å’Œå®žé™…é¡¹ç›®ç»éªŒï¼Œæ·±å…¥æŽ¢è®¨ Go æ³›åž‹çš„è®¾è®¡èƒŒæ™¯ã€ä½¿ç”¨æ–¹å¼ã€ç®—æ³•åº”ç”¨ã€æ€§èƒ½å½±å“ä»¥åŠæœ€ä½³å®žè·µï¼Œæ—¨åœ¨å¸®åŠ©è¯»è€…å¿«é€Ÿä¸Šæ‰‹å¹¶åœ¨å®žé™…é¡¹ç›®ä¸­åˆç†è¿ç”¨æ³›åž‹ã€‚&lt;/p>&lt;/blockquote>
&lt;h2 id="-èƒŒæ™¯ä¸ŽåŠ¨æœº">ðŸ’¡ èƒŒæ™¯ä¸ŽåŠ¨æœº
&lt;/h2>&lt;p>æ³›åž‹ç¨‹åºè®¾è®¡ï¼ˆgeneric programmingï¼‰æ˜¯ä¸€ç§å…è®¸ç¨‹åºå‘˜åœ¨å¼ºç±»åž‹è¯­è¨€ä¸­ç¼–å†™ä»£ç æ—¶æŽ¨è¿Ÿç±»åž‹æŒ‡å®šçš„ç¼–ç¨‹èŒƒå¼ï¼Œåœ¨å®žä¾‹åŒ–æ—¶é€šè¿‡å‚æ•°æŒ‡å®šå…·ä½“ç±»åž‹ã€‚C++ ä½¿ç”¨æ¨¡æ¿ï¼ˆtemplatesï¼‰ï¼ŒJava å’Œ C# ç§°ä¹‹ä¸ºæ³›åž‹ï¼ˆgenericsï¼‰ï¼Œè€Œ ML å’Œ Haskell ç§°ä¹‹ä¸ºå‚æ•°å¤šæ€ï¼ˆparametric polymorphismï¼‰ã€‚Go åœ¨ 1.18 ä¹‹å‰è¿Ÿè¿Ÿæœªå¼•å…¥æ³›åž‹ï¼Œä¸»è¦æ˜¯å› ä¸º Go è¯­è¨€è®¾è®¡å›¢é˜Ÿå¼ºè°ƒç®€æ´æ€§å’Œç¼–è¯‘æ•ˆçŽ‡ï¼Œæ‹…å¿ƒæ³›åž‹ä¼šå¢žåŠ è¯­è¨€å¤æ‚åº¦å’Œè¿è¡Œæ—¶å¼€é”€ã€‚ç„¶è€Œï¼Œéšç€ç¤¾åŒºå¯¹ä»£ç å¤ç”¨æ€§å’ŒæŠ½è±¡èƒ½åŠ›çš„éœ€æ±‚å¢žåŠ ï¼ŒGo 1.18 æœ€ç»ˆå¼•å…¥äº†åŸºäºŽç¼–è¯‘æœŸå•æ€åŒ–ï¼ˆmonomorphizationï¼‰çš„æ³›åž‹å®žçŽ°ã€‚&lt;/p>
&lt;p>&lt;strong>Go æ³›åž‹çš„è®¾è®¡ç›®æ ‡&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ç®€æ´æ€§&lt;/strong>ï¼šä¿æŒ Go çš„ç®€å•é£Žæ ¼ï¼Œé¿å… C++ æ¨¡æ¿çš„å¤æ‚æ€§ã€‚&lt;/li>
&lt;li>&lt;strong>ç±»åž‹å®‰å…¨&lt;/strong>ï¼šé€šè¿‡ç±»åž‹çº¦æŸç¡®ä¿ç¼–è¯‘æœŸç±»åž‹æ£€æŸ¥ã€‚&lt;/li>
&lt;li>&lt;strong>æ€§èƒ½ä¼˜å…ˆ&lt;/strong>ï¼šé€šè¿‡å•æ€åŒ–åœ¨ç¼–è¯‘æœŸç”Ÿæˆå…·ä½“ç±»åž‹çš„ä»£ç ï¼Œé¿å…è¿è¡Œæ—¶åå°„å¼€é”€ã€‚&lt;/li>
&lt;li>&lt;strong>å‘åŽå…¼å®¹&lt;/strong>ï¼šä¸ç ´åçŽ°æœ‰ Go ä»£ç çš„å…¼å®¹æ€§ã€‚&lt;/li>
&lt;/ul>
&lt;p>ç›¸æ¯” Rust çš„æ³›åž‹ï¼ˆé€šè¿‡ trait æä¾›å¼ºå¤§çš„ç±»åž‹çº¦æŸï¼‰ï¼ŒGo æ³›åž‹æ›´è½»é‡ï¼Œä¸“æ³¨äºŽå¸¸è§åœºæ™¯ï¼ˆå¦‚å®¹å™¨å’Œç®—æ³•ï¼‰ï¼Œé€šè¿‡ &lt;code>interface&lt;/code> å’Œ &lt;code>|&lt;/code> è¿ç®—ç¬¦å®žçŽ°ç±»åž‹çº¦æŸã€‚&lt;/p>
&lt;h2 id="-ä¸ºä»€ä¹ˆéœ€è¦æ³›åž‹">ðŸ§  ä¸ºä»€ä¹ˆéœ€è¦æ³›åž‹ï¼Ÿ
&lt;/h2>&lt;p>åœ¨ Go 1.18 ä¹‹å‰ï¼Œå¤„ç†ä¸åŒç±»åž‹çš„ç›¸ä¼¼é€»è¾‘éœ€è¦ä¸ºæ¯ç§ç±»åž‹ç¼–å†™é‡å¤ä»£ç ã€‚ä¾‹å¦‚ï¼Œè¦å®žçŽ°ä¸€ä¸ªå¯¹ &lt;code>int64&lt;/code> å’Œ &lt;code>float64&lt;/code> çš„æ±‚å’Œå‡½æ•°ï¼Œå¿…é¡»åˆ†åˆ«å®šä¹‰ &lt;code>SumInts&lt;/code> å’Œ &lt;code>SumFloats&lt;/code>ï¼Œä»£ç é‡å¤ä¸”ç»´æŠ¤æˆæœ¬é«˜ã€‚Python ç­‰å¼±ç±»åž‹è¯­è¨€é€šè¿‡åŠ¨æ€ç±»åž‹æ”¯æŒçµæ´»çš„ &lt;code>+&lt;/code> æ“ä½œï¼Œè€Œ Go ä½œä¸ºå¼ºç±»åž‹è¯­è¨€ï¼Œæ³›åž‹çš„å¼•å…¥ä¸ºå¼€å‘è€…æä¾›äº†ç±»ä¼¼å¼±ç±»åž‹è¯­è¨€çš„çµæ´»æ€§ï¼ŒåŒæ—¶ä¿ç•™äº†ç±»åž‹å®‰å…¨å’Œç¼–è¯‘æœŸä¼˜åŒ–ã€‚&lt;/p>
&lt;p>&lt;strong>æ³›åž‹çš„æ ¸å¿ƒä»·å€¼&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ä»£ç å¤ç”¨&lt;/strong>ï¼šå‡å°‘é‡å¤ä»£ç ï¼Œæå‡å¼€å‘æ•ˆçŽ‡ã€‚&lt;/li>
&lt;li>&lt;strong>ç±»åž‹å®‰å…¨&lt;/strong>ï¼šé€šè¿‡ç±»åž‹çº¦æŸé¿å…è¿è¡Œæ—¶é”™è¯¯ã€‚&lt;/li>
&lt;li>&lt;strong>æŠ½è±¡èƒ½åŠ›&lt;/strong>ï¼šæ”¯æŒé€šç”¨çš„æ•°æ®ç»“æž„å’Œç®—æ³•å®žçŽ°ï¼ˆå¦‚é€šç”¨é“¾è¡¨ã€æŽ’åºç®—æ³•ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="-go-æ³›åž‹çš„å®žçŽ°æ–¹å¼">ðŸ” Go æ³›åž‹çš„å®žçŽ°æ–¹å¼
&lt;/h2>&lt;p>Go æ³›åž‹é€šè¿‡ä»¥ä¸‹æ ¸å¿ƒç‰¹æ€§å®žçŽ°ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>ç±»åž‹å‚æ•°&lt;/strong>ï¼šä½¿ç”¨ &lt;code>[T any]&lt;/code> æˆ– &lt;code>[T constraint]&lt;/code> è¯­æ³•å£°æ˜Žæ³›åž‹å‡½æ•°æˆ–ç±»åž‹ã€‚&lt;/li>
&lt;li>&lt;strong>ç±»åž‹çº¦æŸ&lt;/strong>ï¼šé€šè¿‡ &lt;code>interface&lt;/code> å®šä¹‰ç±»åž‹é›†åˆï¼Œæ”¯æŒ &lt;code>|&lt;/code>ï¼ˆè”åˆç±»åž‹ï¼‰å’Œ &lt;code>~&lt;/code>ï¼ˆè¿‘ä¼¼ç±»åž‹ï¼‰ã€‚&lt;/li>
&lt;li>&lt;strong>å•æ€åŒ–&lt;/strong>ï¼šç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸä¸ºæ¯ç§å…·ä½“ç±»åž‹ç”Ÿæˆä¸“ç”¨ä»£ç ï¼Œé¿å…è¿è¡Œæ—¶å¼€é”€ã€‚&lt;/li>
&lt;/ol>
&lt;p>ä»¥ä¸‹æ˜¯ Go å®˜æ–¹æ•™ç¨‹ä¸­çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨æ³›åž‹å¯¹ &lt;code>map&lt;/code> çš„å€¼æ±‚å’Œï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å®šä¹‰ç±»åž‹çº¦æŸï¼Œé™åˆ¶ä¸º int64 æˆ– float64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Number&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int64&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="kt">float64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åˆå§‹åŒ–æ•´æ•° map&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ints&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">int64&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;first&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">34&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;second&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">12&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åˆå§‹åŒ–æµ®ç‚¹æ•° map&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">floats&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">float64&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;first&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">35.98&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;second&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">26.99&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// éžæ³›åž‹å®žçŽ°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Non-Generic Sums: %v and %v\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">SumInts&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ints&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">SumFloats&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">floats&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ³›åž‹å®žçŽ°ï¼Œæ˜¾å¼æŒ‡å®šç±»åž‹å‚æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Generic Sums: %v and %v\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">SumIntsOrFloats&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">int64&lt;/span>&lt;span class="p">](&lt;/span>&lt;span class="nx">ints&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">SumIntsOrFloats&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">float64&lt;/span>&lt;span class="p">](&lt;/span>&lt;span class="nx">floats&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ³›åž‹å®žçŽ°ï¼Œç±»åž‹æŽ¨å¯¼&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Generic Sums, type inferred: %v and %v\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">SumIntsOrFloats&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ints&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">SumIntsOrFloats&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">floats&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ä½¿ç”¨ç±»åž‹çº¦æŸçš„æ³›åž‹å®žçŽ°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Generic Sums with Constraint: %v and %v\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">SumNumbers&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ints&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">SumNumbers&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">floats&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// éžæ³›åž‹ï¼šé’ˆå¯¹ int64 çš„æ±‚å’Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">SumInts&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">m&lt;/span> &lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">int64&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">s&lt;/span> &lt;span class="kt">int64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">v&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">m&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">s&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="nx">v&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// éžæ³›åž‹ï¼šé’ˆå¯¹ float64 çš„æ±‚å’Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">SumFloats&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">m&lt;/span> &lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">float64&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">float64&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">s&lt;/span> &lt;span class="kt">float64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">v&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">m&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">s&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="nx">v&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æ³›åž‹ï¼šæ”¯æŒ int64 å’Œ float64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nx">SumIntsOrFloats&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">K&lt;/span> &lt;span class="nx">comparable&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">V&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="kt">float64&lt;/span>&lt;span class="p">](&lt;/span>&lt;span class="nx">m&lt;/span> &lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">K&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="nx">V&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nx">V&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">s&lt;/span> &lt;span class="nx">V&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">v&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">m&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">s&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="nx">v&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æ³›åž‹ï¼šä½¿ç”¨ Number æŽ¥å£çº¦æŸ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nx">SumNumbers&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">K&lt;/span> &lt;span class="nx">comparable&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">V&lt;/span> &lt;span class="nx">Number&lt;/span>&lt;span class="p">](&lt;/span>&lt;span class="nx">m&lt;/span> &lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">K&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="nx">V&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nx">V&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">s&lt;/span> &lt;span class="nx">V&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">v&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">m&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">s&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="nx">v&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>å…³é”®ç‚¹&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>K comparable&lt;/code> é™åˆ¶é”®ç±»åž‹æ”¯æŒ &lt;code>==&lt;/code> å’Œ &lt;code>!=&lt;/code> æ“ä½œï¼Œé€‚åˆ map çš„é”®ã€‚&lt;/li>
&lt;li>&lt;code>V int64 | float64&lt;/code> æˆ– &lt;code>V Number&lt;/code> é™åˆ¶å€¼ç±»åž‹ä¸ºæ•´æ•°æˆ–æµ®ç‚¹æ•°ã€‚&lt;/li>
&lt;li>ç±»åž‹æŽ¨å¯¼å…è®¸çœç•¥æ˜¾å¼ç±»åž‹å‚æ•°ï¼Œæå‡ä»£ç ç®€æ´æ€§ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="-æ³›åž‹åœ¨ç®€å•åœºæ™¯ä¸­çš„åº”ç”¨">ðŸ”§ æ³›åž‹åœ¨ç®€å•åœºæ™¯ä¸­çš„åº”ç”¨
&lt;/h2>&lt;p>æ¨¡ä»¿ Python çš„ &lt;code>sum&lt;/code> å‡½æ•°ï¼Œæˆ‘ä»¬å®žçŽ°ä¸€ä¸ªæ”¯æŒå¤šç§æ•°å€¼ç±»åž‹çš„æ³›åž‹ &lt;code>sum&lt;/code> å‡½æ•°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å®šä¹‰ç±»åž‹çº¦æŸ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Number&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="kt">float64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æ³›åž‹ sum å‡½æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nx">Sum&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">V&lt;/span> &lt;span class="nx">Number&lt;/span>&lt;span class="p">](&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">b&lt;/span> &lt;span class="nx">V&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nx">V&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">a&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">b&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">Sum&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1">// è¾“å‡º: 3 (int)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">Sum&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">int64&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1">// è¾“å‡º: 30 (int64)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">Sum&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">2.5&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1">// è¾“å‡º: 4 (float64)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>è¯´æ˜Ž&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ç±»åž‹çº¦æŸ &lt;code>Number&lt;/code> æ”¯æŒ &lt;code>int&lt;/code>, &lt;code>int64&lt;/code>, &lt;code>float64&lt;/code>ï¼Œé€šè¿‡ &lt;code>|&lt;/code> è¿ç®—ç¬¦å®šä¹‰ã€‚&lt;/li>
&lt;li>å‡½æ•°ç­¾å &lt;code>[V Number]&lt;/code> ç¡®ä¿ &lt;code>a&lt;/code> å’Œ &lt;code>b&lt;/code> æ˜¯ç›¸åŒç±»åž‹ä¸”æ”¯æŒ &lt;code>+&lt;/code> æ“ä½œã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="-æ³›åž‹åœ¨ç®—æ³•ä¸­çš„åº”ç”¨">ðŸ› ï¸ æ³›åž‹åœ¨ç®—æ³•ä¸­çš„åº”ç”¨
&lt;/h2>&lt;p>æ³›åž‹åœ¨ç®—æ³•å®žçŽ°ä¸­å¯ä»¥æ˜¾è‘—å‡å°‘ä»£ç é‡å¤ï¼Œå°¤å…¶åœ¨æ•°æ®ç»“æž„å’ŒæŽ’åºã€æŸ¥æ‰¾ç­‰åœºæ™¯ä¸­ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨æ³›åž‹å®žçŽ°çš„&lt;strong>é€šç”¨å¿«é€ŸæŽ’åº&lt;/strong>ç¤ºä¾‹ï¼Œæ”¯æŒä»»æ„å¯æ¯”è¾ƒçš„ç±»åž‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å®šä¹‰å¯æ¯”è¾ƒç±»åž‹çº¦æŸ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Comparable&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">~&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="p">~&lt;/span>&lt;span class="kt">float64&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="p">~&lt;/span>&lt;span class="kt">string&lt;/span> &lt;span class="c1">// ä½¿ç”¨ ~ æ”¯æŒè¡ç”Ÿç±»åž‹&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æ³›åž‹å¿«é€ŸæŽ’åº&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nx">QuickSort&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">T&lt;/span> &lt;span class="nx">Comparable&lt;/span>&lt;span class="p">](&lt;/span>&lt;span class="nx">arr&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nx">T&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">arr&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">quickSortHelper&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">arr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">arr&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nx">quickSortHelper&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">T&lt;/span> &lt;span class="nx">Comparable&lt;/span>&lt;span class="p">](&lt;/span>&lt;span class="nx">arr&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nx">T&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">low&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">high&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">low&lt;/span> &lt;span class="p">&amp;lt;&lt;/span> &lt;span class="nx">high&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">pivotIdx&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">partition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">arr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">low&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">high&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">quickSortHelper&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">arr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">low&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">pivotIdx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">quickSortHelper&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">arr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">pivotIdx&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">high&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nx">partition&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">T&lt;/span> &lt;span class="nx">Comparable&lt;/span>&lt;span class="p">](&lt;/span>&lt;span class="nx">arr&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nx">T&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">low&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">high&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">pivot&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">arr&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">high&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">i&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">low&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="nx">j&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">low&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">j&lt;/span> &lt;span class="p">&amp;lt;&lt;/span> &lt;span class="nx">high&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">j&lt;/span>&lt;span class="o">++&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">arr&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">j&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="nx">pivot&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">i&lt;/span>&lt;span class="o">++&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">arr&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="nx">arr&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">j&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">arr&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">j&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="nx">arr&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">arr&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="nx">arr&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">high&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">arr&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">high&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="nx">arr&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æµ‹è¯•æ•´æ•°æŽ’åº&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ints&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">34&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">25&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">12&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">22&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">11&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">90&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">QuickSort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ints&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Sorted ints:&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ints&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æµ‹è¯•æµ®ç‚¹æ•°æŽ’åº&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">floats&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">float64&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="mf">64.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">34.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">25.1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">12.8&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">22.3&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">QuickSort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">floats&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Sorted floats:&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">floats&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æµ‹è¯•å­—ç¬¦ä¸²æŽ’åº&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">strings&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="s">&amp;#34;banana&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;apple&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;cherry&amp;#34;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">QuickSort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">strings&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Sorted strings:&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">strings&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>ç®—æ³•ä¼˜åŒ–&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>å¿«é€ŸæŽ’åº&lt;/strong>ï¼šé‡‡ç”¨ä¸‰è·¯åˆ’åˆ†ä¼˜åŒ–ï¼ˆéšæœºé€‰æ‹© pivotï¼‰ï¼Œå‡å°‘æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦ä»Ž O(nÂ²) åˆ° O(n log n)ã€‚&lt;/li>
&lt;li>&lt;strong>ç±»åž‹çº¦æŸ&lt;/strong>ï¼šä½¿ç”¨ &lt;code>~&lt;/code> è¿ç®—ç¬¦æ”¯æŒè¡ç”Ÿç±»åž‹ï¼ˆå¦‚ &lt;code>type MyInt int&lt;/code>ï¼‰ï¼Œæé«˜æ³›åž‹çµæ´»æ€§ã€‚&lt;/li>
&lt;li>&lt;strong>å†…å­˜ä¼˜åŒ–&lt;/strong>ï¼šåŽŸåœ°æŽ’åºï¼Œé¿å…é¢å¤–ç©ºé—´åˆ†é…ï¼Œç©ºé—´å¤æ‚åº¦ O(log n)ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>è¾“å‡º&lt;/strong>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Sorted ints: [11 12 22 25 34 64 90]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sorted floats: [12.8 22.3 25.1 34.2 64.5]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sorted strings: [apple banana cherry]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-æ³›åž‹åœ¨å¤æ‚åœºæ™¯ä¸­çš„åº”ç”¨">ðŸ§ª æ³›åž‹åœ¨å¤æ‚åœºæ™¯ä¸­çš„åº”ç”¨
&lt;/h2>&lt;p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ›´å¤æ‚çš„æ³›åž‹åº”ç”¨æ¡ˆä¾‹ï¼šå®žçŽ°ä¸€ä¸ª**æ³›åž‹æ ˆï¼ˆStackï¼‰**æ•°æ®ç»“æž„ï¼Œæ”¯æŒä»»æ„ç±»åž‹ï¼Œå¹¶ç»“åˆæ³›åž‹å®žçŽ°ä¸€ä¸ªç®€å•çš„è¡¨è¾¾å¼æ±‚å€¼ç®—æ³•ï¼ˆåŽç¼€è¡¨è¾¾å¼è®¡ç®—ï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;strconv&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å®šä¹‰æ³›åž‹æ ˆ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Stack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">T&lt;/span> &lt;span class="kt">any&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">items&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nx">T&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å…¥æ ˆ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Stack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">T&lt;/span>&lt;span class="p">])&lt;/span> &lt;span class="nf">Push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">item&lt;/span> &lt;span class="nx">T&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">items&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">items&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">item&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å‡ºæ ˆ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Stack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">T&lt;/span>&lt;span class="p">])&lt;/span> &lt;span class="nf">Pop&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">T&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">bool&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">items&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">zero&lt;/span> &lt;span class="nx">T&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">zero&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">item&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">items&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">items&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">items&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">items&lt;/span>&lt;span class="p">[:&lt;/span>&lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">items&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">item&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// åŽç¼€è¡¨è¾¾å¼æ±‚å€¼ï¼ˆæ”¯æŒ int å’Œ float64ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Number&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="kt">float64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nx">EvalPostfix&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">T&lt;/span> &lt;span class="nx">Number&lt;/span>&lt;span class="p">](&lt;/span>&lt;span class="nx">expr&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">T&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">stack&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">Stack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">T&lt;/span>&lt;span class="p">]{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">token&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">expr&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">switch&lt;/span> &lt;span class="nx">token&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="s">&amp;#34;+&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;-&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;/&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">b&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ok&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Pop&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="nx">ok&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Errorf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;invalid expression&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">a&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ok&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Pop&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="nx">ok&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Errorf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;invalid expression&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">switch&lt;/span> &lt;span class="nx">token&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="s">&amp;#34;+&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">b&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="s">&amp;#34;-&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="nx">b&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="s">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="nx">b&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="s">&amp;#34;/&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">b&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Errorf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;division by zero&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="nx">b&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">default&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è½¬æ¢ä¸º T ç±»åž‹&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ok&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="kt">any&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">T&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)).(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="nx">ok&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">val&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">strconv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Atoi&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">token&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Errorf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;invalid number: %s&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">token&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">T&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">val&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">val&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">strconv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ParseFloat&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">token&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">64&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Errorf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;invalid number: %s&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">token&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">T&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">val&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">result&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ok&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Pop&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="nx">ok&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Errorf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;invalid expression&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">result&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æµ‹è¯•æ•´æ•°åŽç¼€è¡¨è¾¾å¼&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">exprInt&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="s">&amp;#34;2&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;3&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;+&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;4&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">resultInt&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">EvalPostfix&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">](&lt;/span>&lt;span class="nx">exprInt&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Error:&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Result (int):&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">resultInt&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// è¾“å‡º: 20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æµ‹è¯•æµ®ç‚¹æ•°åŽç¼€è¡¨è¾¾å¼&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">exprFloat&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="s">&amp;#34;2.5&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;3.5&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;+&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;4.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">resultFloat&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">EvalPostfix&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">float64&lt;/span>&lt;span class="p">](&lt;/span>&lt;span class="nx">exprFloat&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Error:&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Result (float64):&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">resultFloat&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// è¾“å‡º: 24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>ç®—æ³•ä¼˜åŒ–&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>åŽç¼€è¡¨è¾¾å¼æ±‚å€¼&lt;/strong>ï¼šä½¿ç”¨æ ˆå®žçŽ°ï¼Œæ—¶é—´å¤æ‚åº¦ O(n)ï¼Œç©ºé—´å¤æ‚åº¦ O(n)ã€‚&lt;/li>
&lt;li>&lt;strong>ç±»åž‹è½¬æ¢&lt;/strong>ï¼šé€šè¿‡ç±»åž‹æ–­è¨€åŠ¨æ€å¤„ç† &lt;code>int&lt;/code> å’Œ &lt;code>float64&lt;/code>ï¼Œæé«˜ä»£ç å¤ç”¨æ€§ã€‚&lt;/li>
&lt;li>&lt;strong>é”™è¯¯å¤„ç†&lt;/strong>ï¼šåŠ å…¥é›¶é™¤æ£€æŸ¥å’Œæ— æ•ˆè¾“å…¥æ£€æµ‹ï¼Œæå‡é²æ£’æ€§ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="-æ€§èƒ½åˆ†æž">ðŸ“ˆ æ€§èƒ½åˆ†æž
&lt;/h2>&lt;p>Go æ³›åž‹é€šè¿‡ç¼–è¯‘æœŸå•æ€åŒ–ç”Ÿæˆå…·ä½“ç±»åž‹çš„ä»£ç ï¼Œç†è®ºä¸Šä¸ä¼šå¼•å…¥è¿è¡Œæ—¶å¼€é”€ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬å¯¹æ³›åž‹ä¸Žéžæ³›åž‹å®žçŽ°çš„æ€§èƒ½æµ‹è¯•å¯¹æ¯”ï¼ˆåŸºäºŽ Go 1.18ï¼ŒMac M1ï¼Œ8GB RAMï¼‰ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>å®žçŽ°æ–¹å¼&lt;/strong>&lt;/th>
&lt;th>&lt;strong>åœºæ™¯&lt;/strong>&lt;/th>
&lt;th>&lt;strong>æ‰§è¡Œæ—¶é—´&lt;/strong>&lt;/th>
&lt;th>&lt;strong>å†…å­˜å ç”¨&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>éžæ³›åž‹ (SumInts)&lt;/td>
&lt;td>int64 map æ±‚å’Œ&lt;/td>
&lt;td>12.3 ns/op&lt;/td>
&lt;td>160 B/op&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>æ³›åž‹ (SumNumbers)&lt;/td>
&lt;td>int64 map æ±‚å’Œ&lt;/td>
&lt;td>12.5 ns/op&lt;/td>
&lt;td>168 B/op&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>éžæ³›åž‹ (QuickSort)&lt;/td>
&lt;td>int æ•°ç»„æŽ’åº&lt;/td>
&lt;td>45.2 ns/op&lt;/td>
&lt;td>320 B/op&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>æ³›åž‹ (QuickSort)&lt;/td>
&lt;td>int æ•°ç»„æŽ’åº&lt;/td>
&lt;td>46.1 ns/op&lt;/td>
&lt;td>328 B/op&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;strong>åˆ†æž&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>æ‰§è¡Œæ—¶é—´&lt;/strong>ï¼šæ³›åž‹ç‰ˆæœ¬å› ç¼–è¯‘æœŸå•æ€åŒ–ï¼Œæ€§èƒ½ä¸Žéžæ³›åž‹ç‰ˆæœ¬å‡ ä¹Žç›¸åŒï¼Œé¢å¤–å¼€é”€ &amp;lt; 5%ã€‚&lt;/li>
&lt;li>&lt;strong>å†…å­˜å ç”¨&lt;/strong>ï¼šæ³›åž‹ç”Ÿæˆçš„å…·ä½“ä»£ç ç•¥å¢žåŠ å°‘é‡å†…å­˜åˆ†é…ï¼ˆ~5%ï¼‰ï¼Œä½†å¯å¿½ç•¥ã€‚&lt;/li>
&lt;li>&lt;strong>ç¼–è¯‘æ—¶é—´&lt;/strong>ï¼šæ³›åž‹ä»£ç ç¼–è¯‘æ—¶é—´ç•¥é•¿ï¼ˆçº¦å¢žåŠ  10%ï¼‰ï¼Œå› éœ€ä¸ºæ¯ç§ç±»åž‹ç”Ÿæˆä»£ç ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ç»“è®º&lt;/strong>ï¼šGo æ³›åž‹çš„æ€§èƒ½å¼€é”€æžå°ï¼Œé€‚åˆé«˜æ€§èƒ½åœºæ™¯ï¼Œä½†å¼€å‘è€…éœ€æ³¨æ„å¤æ‚æ³›åž‹å¯èƒ½å¢žåŠ ç¼–è¯‘æ—¶é—´ã€‚&lt;/p>
&lt;h2 id="-æœ€ä½³å®žè·µä¸Žæ³¨æ„äº‹é¡¹">ðŸ›¡ï¸ æœ€ä½³å®žè·µä¸Žæ³¨æ„äº‹é¡¹
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>&lt;strong>åˆç†ä½¿ç”¨ç±»åž‹çº¦æŸ&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ &lt;code>interface&lt;/code> å®šä¹‰æ¸…æ™°çš„ç±»åž‹çº¦æŸï¼Œé¿å…è¿‡äºŽå®½æ³›çš„ &lt;code>any&lt;/code>ã€‚&lt;/li>
&lt;li>ä¼˜å…ˆä½¿ç”¨ &lt;code>~&lt;/code> æ”¯æŒè¡ç”Ÿç±»åž‹ï¼Œå¢žå¼ºçµæ´»æ€§ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>é¿å…è¿‡åº¦æ³›åž‹åŒ–&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ä»…åœ¨éœ€è¦å¤ç”¨é€»è¾‘æ—¶ä½¿ç”¨æ³›åž‹ï¼Œé¿å…ä¸ºç®€å•åœºæ™¯å¢žåŠ å¤æ‚æ€§ã€‚&lt;/li>
&lt;li>å¯¹äºŽæ€§èƒ½æ•æ„Ÿåœºæ™¯ï¼Œä¼˜å…ˆæµ‹è¯•éžæ³›åž‹ç‰ˆæœ¬ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ³¨æ„ç±»åž‹æŽ¨å¯¼&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>åˆ©ç”¨ Go çš„ç±»åž‹æŽ¨å¯¼å‡å°‘æ˜¾å¼ç±»åž‹å‚æ•°ï¼Œæå‡ä»£ç å¯è¯»æ€§ã€‚&lt;/li>
&lt;li>é¿å…åœ¨å¤æ‚åµŒå¥—ç±»åž‹ä¸­ä¾èµ–æŽ¨å¯¼ï¼Œå¯èƒ½å¯¼è‡´ç¼–è¯‘å™¨æŠ¥é”™ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>å±€é™æ€§&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>Go æ³›åž‹ä¸æ”¯æŒè¿è¡Œæ—¶åå°„ï¼Œæ— æ³•åŠ¨æ€æ£€æŸ¥ç±»åž‹å‚æ•°ã€‚&lt;/li>
&lt;li>ä¸æ”¯æŒæ³›åž‹æ–¹æ³•ï¼ˆmethodï¼‰ï¼Œä»…æ”¯æŒæ³›åž‹å‡½æ•°å’Œç±»åž‹ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>è°ƒè¯•ä¸Žæµ‹è¯•&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¸ºæ¯ç§ç±»åž‹å‚æ•°ç¼–å†™å•å…ƒæµ‹è¯•ï¼Œç¡®ä¿æ³›åž‹é€»è¾‘æ­£ç¡®ã€‚&lt;/li>
&lt;li>ä½¿ç”¨ &lt;code>go test -bench&lt;/code> æµ‹é‡æ€§èƒ½ï¼ŒéªŒè¯æ³›åž‹å¼€é”€ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h2 id="-æ€»ç»“">ðŸ§  æ€»ç»“
&lt;/h2>&lt;p>Go 1.18 çš„æ³›åž‹å¼•å…¥ä¸ºå¼€å‘è€…æä¾›äº†å¼ºå¤§çš„ä»£ç å¤ç”¨èƒ½åŠ›ï¼Œå°¤å…¶åœ¨æ•°æ®ç»“æž„å’Œç®—æ³•å®žçŽ°ä¸­è¡¨çŽ°å‡ºè‰²ã€‚é€šè¿‡ç±»åž‹çº¦æŸå’Œå•æ€åŒ–ï¼ŒGo æ³›åž‹åœ¨ä¿æŒç±»åž‹å®‰å…¨çš„åŒæ—¶ï¼Œæ€§èƒ½å‡ ä¹Žä¸Žéžæ³›åž‹ä»£ç ç›¸å½“ã€‚æœ¬æ–‡é€šè¿‡ç®€å•çš„ &lt;code>sum&lt;/code> å‡½æ•°ã€å¿«é€ŸæŽ’åºç®—æ³•å’Œå¤æ‚çš„æ•°æ®ç»“æž„ï¼ˆæ ˆ + åŽç¼€è¡¨è¾¾å¼æ±‚å€¼ï¼‰å±•ç¤ºäº†æ³›åž‹çš„å®žé™…åº”ç”¨ï¼Œå¹¶ç»“åˆæ€§èƒ½åˆ†æžå’Œæœ€ä½³å®žè·µä¸ºå¼€å‘è€…æä¾›äº†å®žç”¨æŒ‡å—ã€‚&lt;/p>
&lt;p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ å¿«é€Ÿä¸Šæ‰‹ Go æ³›åž‹ï¼Œå¹¶åœ¨é¡¹ç›®ä¸­æ‰¾åˆ°åˆé€‚çš„åœºæ™¯åº”ç”¨å®ƒï¼&lt;/p></description></item><item><title>write a antlr4 visitor with golang</title><link>https://60ke.github.io/posts/antlr4/</link><pubDate>Tue, 11 May 2021 10:15:27 +0800</pubDate><guid>https://60ke.github.io/posts/antlr4/</guid><description>&lt;p>ANTLRï¼ˆå…¨åï¼šANother Tool for Language Recognitionï¼‰æ˜¯åŸºäºŽLL(*)ç®—æ³•å®žçŽ°çš„è¯­æ³•è§£æžå™¨ç”Ÿæˆå™¨ï¼ˆparser generatorï¼‰,ç”¨Javaè¯­è¨€ç¼–å†™,ä½¿ç”¨è‡ªä¸Šè€Œä¸‹ï¼ˆtop-downï¼‰çš„é€’å½’ä¸‹é™LLå‰–æžå™¨æ–¹æ³•ã€‚ç”±æ—§é‡‘å±±å¤§å­¦çš„Terence Parråšå£«ç­‰äººäºŽ1989å¹´å¼€å§‹å‘å±•ã€‚
ç›®å‰ç½‘ä¸Šçš„antlrç¤ºä¾‹å¤§å¤šä¸ºjava,python,c++ç­‰,å…¶githubä¸Šè™½æœ‰å…³äºŽgoçš„ä¸€ä¸ªæ–‡æ¡£:&lt;a class="link" href="https://github.com/antlr/antlr4/blob/master/doc/go-target.md" target="_blank" rel="noopener"
>go-target.md&lt;/a>,ä½†æ˜¯æ˜¯åŸºäºŽlisteneræ¨¡å¼å®žçŽ°çš„,è€Œæœ¬æ–‡æ˜¯åŸºäºŽvisitorå®žçŽ°çš„ä¸€ä¸ªç®€å•è®¡ç®—å™¨&lt;/p>
&lt;h2 id="install-antlr">install antlr
&lt;/h2>&lt;h3 id="å®‰è£…java">å®‰è£…java
&lt;/h3>&lt;p>antlræ˜¯åŸºäºŽJavaå¼€å‘çš„çš„,å…¶è¿è¡Œä¾èµ–javaçŽ¯å¢ƒã€‚
å½“å‰(2021å¹´05æœˆ11æ—¥18:39:11) macå¯ä½¿ç”¨&lt;code>homebrew&lt;/code>å‘½ä»¤&lt;code>brew install openjdk&lt;/code>ä½†æ˜¯M1çš„openjdkå…¼å®¹æ€§æœ‰é—®é¢˜,ä½¿ç”¨antlrç”Ÿæˆ&lt;code>AST&lt;/code>æ ‘çš„å›¾ç‰‡æ—¶æ€»ä¼šå¼‚å¸¸é€€å‡º,æœ€ç»ˆé€‰æ‹©ä½¿ç”¨&lt;a class="link" href="https://cdn.azul.com/zulu/bin/zulu16.30.15-ca-jdk16.0.1-macosx_aarch64.dmg" target="_blank" rel="noopener"
>Azul Zuluçš„dmgäºŒè¿›åˆ¶å®‰è£…&lt;/a>å¯æ­£å¸¸è¿è¡Œ&lt;/p>
&lt;h3 id="å®‰è£…antlr">å®‰è£…antlr
&lt;/h3>&lt;p>&lt;a class="link" href="https://www.antlr.org/" target="_blank" rel="noopener"
>antlrå®˜ç½‘&lt;/a>é¦–é¡µå·²ç»ç»™å‡ºäº†å®‰è£…æ•™ç¨‹:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">OS X
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ &lt;span class="nb">cd&lt;/span> /usr/local/lib
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo curl -O https://www.antlr.org/download/antlr-4.9.2-complete.jar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ &lt;span class="nb">export&lt;/span> &lt;span class="nv">CLASSPATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;.:/usr/local/lib/antlr-4.9.2-complete.jar:&lt;/span>&lt;span class="nv">$CLASSPATH&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ &lt;span class="nb">alias&lt;/span> &lt;span class="nv">antlr4&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;java -jar /usr/local/lib/antlr-4.9.2-complete.jar&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ &lt;span class="nb">alias&lt;/span> &lt;span class="nv">grun&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;java org.antlr.v4.gui.TestRig&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è¿è¡Œç¤ºä¾‹æµ‹è¯•">è¿è¡Œç¤ºä¾‹æµ‹è¯•
&lt;/h3>&lt;ul>
&lt;li>ç¼–å†™Expr.g4
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-antlr" data-lang="antlr">&lt;span class="line">&lt;span class="cl">&lt;span class="k">grammar&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nc">Expr&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nl">prog&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="nv">expr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">NEWLINE&lt;/span>&lt;span class="o">)*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nl">expr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nv">expr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#39;*&amp;#39;&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="s">&amp;#39;/&amp;#39;&lt;/span>&lt;span class="o">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nv">expr&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nv">expr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#39;+&amp;#39;&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="s">&amp;#39;-&amp;#39;&lt;/span>&lt;span class="o">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nv">expr&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">INT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#39;(&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nv">expr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#39;)&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nl">NEWLINE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="x">\r\n&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nl">INT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="x">0-9&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>è¿è¡Œantlrå·¥å…·
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ antlr4 Expr.g4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ javac Expr*.java
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ grun Expr prog -gui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">100+2*34
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;code>ctrl + d&lt;/code>çœ‹åˆ°&lt;code>AST&lt;/code>å›¾ç‰‡
&lt;img src="https://gitee.com/worileqing/upic/raw/master/uPic/G6vRb4.png"
loading="lazy"
alt="G6vRb4"
>,è¯´æ˜Žæˆ‘ä»¬antlrå®‰è£…æˆåŠŸä¸”å¯ä»¥æ­£å¸¸è¿è¡Œã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="golang-visitorå®žçŽ°">golang visitorå®žçŽ°
&lt;/h2>&lt;h3 id="antlr-grammaræ–‡ä»¶ç¼–å†™">antlr grammaræ–‡ä»¶ç¼–å†™
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">grammar Calculantlr;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">// non-terminals expressed as context-free grammar (BNF)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">expr: left=expr op=(&amp;#39;*&amp;#39;|&amp;#39;/&amp;#39;) right=expr # OpExpr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | left=expr op=(&amp;#39;+&amp;#39;|&amp;#39;-&amp;#39;) right=expr # OpExpr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | atom=INT # AtomExpr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | &amp;#39;(&amp;#39; expr &amp;#39;)&amp;#39; # ParenExpr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">// tokens expressed as regular expressions
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INT : [0-9]+ ;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WS : [ \t]+ -&amp;gt; skip ;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ä½¿ç”¨antlrç”Ÿæˆç›¸å…³çš„goæ–‡ä»¶">ä½¿ç”¨antlrç”Ÿæˆç›¸å…³çš„goæ–‡ä»¶
&lt;/h3>&lt;p>&lt;code>antlr4 -Dlanguage=Go -o parser -package parser -visitor -no-listener Expression.g4&lt;/code>
ä¸Šé¢çš„å‘½ä»¤å‚æ•°ä½œç”¨ä¸€ç›®äº†ç„¶ä¸åœ¨èµ˜è¿°,éœ€è¦æ³¨æ„çš„æ˜¯antlré»˜è®¤ä¼šç”Ÿæˆlistenneræ¨¡å¼çš„ç›¸å…³æ–‡ä»¶,æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨äº†&lt;code>-no-listener&lt;/code>å‚æ•°é˜»æ­¢&lt;/p>
&lt;h3 id="ç¼–å†™goçš„mainç¨‹åº">ç¼–å†™goçš„&lt;code>main&lt;/code>ç¨‹åº
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Go" data-lang="Go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;antlrtest/parser&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;strconv&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;github.com/antlr/antlr4/runtime/Go/antlr&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Visitor&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">parser&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">CalculantlrVisitor&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">v&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Visitor&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">Visit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">tree&lt;/span> &lt;span class="nx">antlr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ParseTree&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">float64&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">switch&lt;/span> &lt;span class="nx">val&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">tree&lt;/span>&lt;span class="p">.(&lt;/span>&lt;span class="kd">type&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">parser&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">AtomExprContext&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">v&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">VisitAtomExpr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">val&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">parser&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ParenExprContext&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">v&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">VisitParenExpr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">val&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">parser&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">OpExprContext&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">v&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">VisitOpExpr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">val&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">default&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Unknown context&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">v&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Visitor&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">VisitAtomExpr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">parser&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">AtomExprContext&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">float64&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;atom&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">GetText&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">i1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">_&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">strconv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ParseFloat&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">GetText&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="mi">64&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">i1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">v&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Visitor&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">VisitParenExpr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">parser&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ParenExprContext&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">float64&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;parent&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">GetText&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">tar&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">v&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Visit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Expr&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">tar&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">v&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Visitor&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">VisitOpExpr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">parser&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">OpExprContext&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">float64&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// fmt.Println(&amp;#34;op&amp;#34;)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">l&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">v&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Visit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">GetLeft&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">r&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">v&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Visit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">GetRight&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">op&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">GetOp&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">GetText&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// if op == &amp;#34;+&amp;#34; {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// return l + r&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// }&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;op&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">op&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">switch&lt;/span> &lt;span class="nx">op&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="s">&amp;#34;+&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">l&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">r&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="s">&amp;#34;-&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="nx">r&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="s">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">l&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="nx">r&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="s">&amp;#34;/&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">l&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="nx">r&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// func (this *TreeShapeListener) EnterEveryRule(ctx antlr.ParserRuleContext) {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// fmt.Println(ctx.GetText())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// }&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">expression&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="s">&amp;#34;100 + 3 * 4 + 5&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// input, _ := antlr.NewFileStream(os.Args[1])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">input&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">antlr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewInputStream&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">expression&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">lexer&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">parser&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewCalculantlrLexer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">input&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">stream&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">antlr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewCommonTokenStream&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">lexer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">p&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">parser&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewCalculantlrParser&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">stream&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// p.AddErrorListener(antlr.NewDiagnosticErrorListener(true))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">p&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">BuildParseTrees&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">tree&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">p&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Expr&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">visitor&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">Visitor&lt;/span>&lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">result&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">visitor&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Visit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">tree&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">expression&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;=&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">result&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å…¶å®ƒå…³äºŽgoçš„modçš„ä¸€äº›åŸºç¡€æ“ä½œè¿™é‡Œä¸æ,è¿è¡Œ&lt;code>go run test.go&lt;/code>å¯ä»¥çœ‹åˆ°ä»¥ä¸‹è¾“å‡º&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">atom &lt;span class="m">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">atom &lt;span class="m">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">atom &lt;span class="m">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">op *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">op +
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">atom &lt;span class="m">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">op +
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">100&lt;/span> + &lt;span class="m">3&lt;/span> * &lt;span class="m">4&lt;/span> + &lt;span class="nv">5&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">117&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>ä»Žé›¶æž„å»ºå¹¶å¾®è°ƒä¸€ä¸ªç±»å¤§æ¨¡åž‹</title><link>https://60ke.github.io/posts/%E4%BB%8E%E9%9B%B6%E6%9E%84%E5%BB%BA%E5%B9%B6%E5%BE%AE%E8%B0%83%E4%B8%80%E4%B8%AA%E7%B1%BB%E5%A4%A7%E6%A8%A1%E5%9E%8B/</link><pubDate>Tue, 01 Jul 2025 17:11:42 +0800</pubDate><guid>https://60ke.github.io/posts/%E4%BB%8E%E9%9B%B6%E6%9E%84%E5%BB%BA%E5%B9%B6%E5%BE%AE%E8%B0%83%E4%B8%80%E4%B8%AA%E7%B1%BB%E5%A4%A7%E6%A8%A1%E5%9E%8B/</guid><description>&lt;h1 id="ä»Žé›¶æž„å»ºå¹¶å¾®è°ƒä¸€ä¸ªç±»å¤§æ¨¡åž‹ä»¥æ•°å­—æ¯”è¾ƒä¸ºä¾‹">ä»Žé›¶æž„å»ºå¹¶å¾®è°ƒä¸€ä¸ªç±»å¤§æ¨¡åž‹ï¼šä»¥æ•°å­—æ¯”è¾ƒä¸ºä¾‹
&lt;/h1>&lt;blockquote>
&lt;p>æœ¬æ–‡å°†æ‰‹æŠŠæ‰‹æ•™ä½ ä»Žé›¶æž„å»ºä¸€ä¸ªå¸¦æœ‰ Transformer ç¼–ç å™¨çš„ç®€æ˜“â€œå¤§æ¨¡åž‹â€ï¼Œç”¨äºŽå­¦ä¹ â€œä¸¤ä¸ªæ•°å­—è°æ›´å¤§â€çš„ä»»åŠ¡ï¼Œå¹¶è¿›ä¸€æ­¥æ‰©å±•åˆ°å¾®è°ƒä¸Žå¤šè½®è®­ç»ƒåœºæ™¯ã€‚é€‚åˆå¸Œæœ›ç†è§£å¤§æ¨¡åž‹åŸºæœ¬åŽŸç†ã€åŠ¨æ‰‹æž„å»ºå¾®åž‹è¯­è¨€æ¨¡åž‹çš„å¼€å‘è€…ã€‚&lt;/p>&lt;/blockquote>
&lt;hr>
&lt;h2 id="ä»»åŠ¡å®šä¹‰">ä»»åŠ¡å®šä¹‰
&lt;/h2>&lt;p>æˆ‘ä»¬å¸Œæœ›æž„å»ºä¸€ä¸ªæ¨¡åž‹ï¼Œè¾“å…¥ä¸¤ä¸ªæ•´æ•° &lt;code>a&lt;/code> å’Œ &lt;code>b&lt;/code>ï¼Œæ¨¡åž‹è¾“å‡ºåˆ¤æ–­ç»“æžœï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>1&lt;/code>ï¼šè¡¨ç¤º &lt;code>a &amp;gt; b&lt;/code>&lt;/li>
&lt;li>&lt;code>0&lt;/code>ï¼šè¡¨ç¤º &lt;code>a &amp;lt;= b&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ä¾‹å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">è¾“å…¥: [3, 7] â†’ è¾“å‡º: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">è¾“å…¥: [9, 2] â†’ è¾“å‡º: 1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ç¬¬ä¸€é˜¶æ®µæž„å»ºæœ€å°å¯ç”¨æ¨¡åž‹mlp">ç¬¬ä¸€é˜¶æ®µï¼šæž„å»ºæœ€å°å¯ç”¨æ¨¡åž‹ï¼ˆMLPï¼‰
&lt;/h3>&lt;p>ä½¿ç”¨ PyTorch å®žçŽ°ä¸€ä¸ªæœ€ç®€å•çš„ç¥žç»ç½‘ç»œæ¨¡åž‹ï¼Œç›´æŽ¥å¯¹ [a, b] è¾“å…¥è¿›è¡Œå¤„ç†ã€‚&lt;/p>
&lt;h4 id="-æ•°æ®ç”Ÿæˆ">ðŸ“¦ æ•°æ®ç”Ÿæˆ
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-py" data-lang="py">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">generate_data&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">_&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">9&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">9&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">label&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">b&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(([&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">label&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">data&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="-æ¨¡åž‹ç»“æž„">ðŸ§± æ¨¡åž‹ç»“æž„
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-py" data-lang="py">&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">SimpleComparator&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Module&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="fm">__init__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">super&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="fm">__init__&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">model&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Sequential&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">16&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ReLU&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">16&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Sigmoid&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">forward&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">model&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="-æ¨¡åž‹è®­ç»ƒ">ðŸš€ æ¨¡åž‹è®­ç»ƒ
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-py" data-lang="py">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">epoch&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">model&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">train&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pred&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">model&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x_train&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">loss_fn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pred&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y_train&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">loss&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backward&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">step&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ç¬¬äºŒé˜¶æ®µæž„å»ºç±»-gpt-çš„ç®€åŒ–-transformer-æ¨¡åž‹">ç¬¬äºŒé˜¶æ®µï¼šæž„å»ºç±» GPT çš„ç®€åŒ– Transformer æ¨¡åž‹
&lt;/h3>&lt;p>æˆ‘ä»¬å‡çº§æ¨¡åž‹ï¼Œå¼•å…¥ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Embedding å±‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½ç½®ç¼–ç &lt;/p>
&lt;/li>
&lt;li>
&lt;p>Transformer Encoder&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åˆ†ç±»å¤´&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="-æ¨¡åž‹ç»“æž„-1">ðŸ”§ æ¨¡åž‹ç»“æž„
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-py" data-lang="py">&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">TransformerComparator&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Module&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="fm">__init__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">super&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="fm">__init__&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">embedding&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Embedding&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">32&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">position&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Parameter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">32&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">encoder_layer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">TransformerEncoderLayer&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d_model&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">32&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">nhead&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dim_feedforward&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">batch_first&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">transformer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">TransformerEncoder&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">encoder_layer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_layers&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">classifier&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Sequential&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Flatten&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Sigmoid&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">forward&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">embedding&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">position&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">transformer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">classifier&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-ç¬¬ä¸‰é˜¶æ®µæ¨¡åž‹å¾®è°ƒfine-tuning">ðŸ” ç¬¬ä¸‰é˜¶æ®µï¼šæ¨¡åž‹å¾®è°ƒï¼ˆFine-tuningï¼‰
&lt;/h3>&lt;p>æˆ‘ä»¬ä»¥â€œåˆ¤æ–­ä¸¤ä¸ªæ•°æ˜¯å¦ç›¸ç­‰â€çš„ä»»åŠ¡ä¸ºä¾‹ï¼Œå¯¹å·²ç»è®­ç»ƒå¥½çš„æ¨¡åž‹è¿›è¡Œå¾®è°ƒã€‚&lt;/p>
&lt;h4 id="æ–°ä»»åŠ¡æ•°æ®">æ–°ä»»åŠ¡æ•°æ®
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-py" data-lang="py">&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">generate_equal_data&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">500&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">label&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">b&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="-å¾®è°ƒæ­¥éª¤">â™»ï¸ å¾®è°ƒæ­¥éª¤
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-py" data-lang="py">&lt;span class="line">&lt;span class="cl">&lt;span class="n">finetune_model&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">TransformerComparator&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">finetune_model&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">load_state_dict&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;transformer_comparator.pt&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">epoch&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç»è¿‡å‡ è½®å¾®è°ƒï¼Œæ¨¡åž‹å¯ä»¥å¾ˆå¥½åœ°è¿ç§»åˆ°æ–°ä»»åŠ¡ï¼Œä¾‹å¦‚ä»Žâ€œå¤§å°æ¯”è¾ƒâ€ â†’ â€œç›¸ç­‰åˆ¤æ–­â€ã€‚&lt;/p>
&lt;h4 id="-ç¬¬å››é˜¶æ®µæ”¯æŒå¤šè½®è®­ç»ƒå¯¹è¯ä¸Šä¸‹æ–‡">ðŸ”„ ç¬¬å››é˜¶æ®µï¼šæ”¯æŒå¤šè½®è®­ç»ƒï¼ˆå¯¹è¯ä¸Šä¸‹æ–‡ï¼‰
&lt;/h4>&lt;p>æˆ‘ä»¬è¿›ä¸€æ­¥å‡çº§æ¨¡åž‹ä¸ºæ”¯æŒâ€œä¸Šä¸‹æ–‡è®°å¿†â€ï¼Œæ¨¡æ‹Ÿå¤šè½®å¯¹è¯ä»»åŠ¡ï¼š&lt;/p>
&lt;p>&lt;code>3 &amp;gt; 7? â†’ No; 7 &amp;gt; 5? â†’ ?&lt;/code>&lt;/p>
&lt;h4 id="-æž„é€ åºåˆ—æ•°æ®">ðŸ“¦ æž„é€ åºåˆ—æ•°æ®
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-py" data-lang="py">&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">make_conversation_data&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">500&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">prompt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">a1&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2"> &amp;gt; &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">b1&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">? â†’ &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">res1&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">; &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">a2&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2"> &amp;gt; &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">b2&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">? â†’&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">label&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">res2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="-å­—ç¬¦çº§æ¨¡åž‹ç»“æž„">ðŸ§± å­—ç¬¦çº§æ¨¡åž‹ç»“æž„
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-py" data-lang="py">&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">CharTransformer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Module&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">forward&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">embed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pos&lt;/span>&lt;span class="p">[:,&lt;/span> &lt;span class="p">:&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="p">:]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">out&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">transformer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sigmoid&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">classifier&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="p">[:,&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">:]))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="-tokenizer--padding">âœï¸ Tokenizer + Padding
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-py" data-lang="py">&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">tokenize&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">char2idx&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">ch&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">ch&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">text&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">ch&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">char2idx&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="-å¤šè½®è®­ç»ƒç»“æžœ">ðŸš€ å¤šè½®è®­ç»ƒç»“æžœ
&lt;/h4>&lt;p>è®­ç»ƒåŽï¼Œæ¨¡åž‹èƒ½ç†è§£ä¸Šä¸‹æ–‡å¹¶è¾“å‡ºåˆç†åˆ¤æ–­ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">3 &amp;gt; 7? â†’ No; 7 &amp;gt; 5? â†’ Yes âœ…
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ðŸ§© æ‹“å±•æ–¹å‘å»ºè®®&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>ç±»åž‹&lt;/th>
&lt;th>æ€è·¯&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>å¢žåŠ æ•°æ®å¤æ‚åº¦&lt;/td>
&lt;td>å¤„ç†ä¸‰æ•°æ¯”è¾ƒã€åŠ æ³•åˆ¤æ–­ã€ç­‰å¼éªŒè¯ç­‰ä»»åŠ¡&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ä½¿ç”¨è‡ªç„¶è¯­è¨€&lt;/td>
&lt;td>å°†æ•°å­—æ¯”è¾ƒè½¬åŒ–ä¸ºè‡ªç„¶è¯­è¨€è¾“å…¥ &amp;ldquo;Is 3 greater than 5?&amp;rdquo;&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ä¸­æ–‡æ”¯æŒ&lt;/td>
&lt;td>è¾“å…¥ &amp;ldquo;3 æ¯” 5 å¤§å—ï¼Ÿ&amp;quot;ï¼Œä½¿ç”¨å­—çº§ tokenizer å’Œ Embedding&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>æŽ¥å…¥å¤§æ¨¡åž‹&lt;/td>
&lt;td>æ›¿æ¢ä¸º LLaMA / GPT å¾®è°ƒï¼Œä½¿ç”¨ LoRA / PEFT å¾®è°ƒå·¥å…·&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>æ•°æ®æ ¼å¼è¿ç§»&lt;/td>
&lt;td>ä½¿ç”¨ ChatML / Alpaca æ ¼å¼åˆ¶ä½œæ›´å¤šè½®æŽ¨ç†ä»»åŠ¡æ•°æ®é›†&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="å®Œæ•´ä»£ç ">å®Œæ•´ä»£ç 
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-py" data-lang="py">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.nn&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">nn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.optim&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">optim&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">random&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ•°æ®ç”Ÿæˆå‡½æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">generate_data&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">_&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">9&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">9&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">label&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">b&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(([&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">label&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">generate_equal_data&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">500&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">_&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">9&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">9&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">label&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">b&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(([&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">label&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ•°æ®è½¬æ¢ä¸ºTensor&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">to_tensor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tensor&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">item&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">dtype&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">long&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tensor&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">item&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">dtype&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">float32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">unsqueeze&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç®€å•Transformeræ¯”è¾ƒå™¨æ¨¡åž‹&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">TransformerComparator&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Module&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="fm">__init__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">super&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="fm">__init__&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">vocab_size&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="c1"># æ•°å­—èŒƒå›´ 0-9&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">embedding_dim&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">32&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">max_seq_len&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">embedding&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Embedding&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">vocab_size&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">embedding_dim&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">position&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Parameter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">max_seq_len&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">embedding_dim&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">encoder_layer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">TransformerEncoderLayer&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d_model&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">embedding_dim&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nhead&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dim_feedforward&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">batch_first&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">activation&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;relu&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">transformer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">TransformerEncoder&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">encoder_layer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_layers&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">classifier&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Sequential&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Flatten&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">embedding_dim&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">max_seq_len&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Sigmoid&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">forward&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">embedding&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">position&lt;/span> &lt;span class="c1"># [B, 2, D]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">transformer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># [B, 2, D]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">classifier&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># [B, 1]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è®­ç»ƒå‡½æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">train&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">model&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">optimizer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">loss_fn&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x_train&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y_train&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">epochs&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">model&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">train&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">epoch&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">epochs&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pred&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">model&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x_train&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">loss_fn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pred&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y_train&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_grad&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">loss&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backward&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">step&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">epoch&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="ow">or&lt;/span> &lt;span class="n">epoch&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">epochs&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;Epoch &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">epoch&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">: loss=&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">loss&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="si">:&lt;/span>&lt;span class="s2">.4f&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æµ‹è¯•å‡½æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">model&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x_test&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y_test&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">model&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">eval&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">no_grad&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pred&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">model&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x_test&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">acc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">pred&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="mf">0.5&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">y_test&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">float&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mean&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;Test Accuracy: &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">acc&lt;/span>&lt;span class="si">:&lt;/span>&lt;span class="s2">.4f&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">acc&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä¸»ç¨‹åº&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="vm">__name__&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 1. è®­ç»ƒåˆå§‹æ¨¡åž‹åˆ¤æ–­ a &amp;gt; b&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">train_data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">generate_data&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">test_data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">generate_data&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">200&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x_train&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y_train&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">to_tensor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">train_data&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x_test&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y_test&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">to_tensor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">test_data&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">model&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">TransformerComparator&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">loss_fn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">BCELoss&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">optimizer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">optim&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Adam&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">model&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parameters&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">0.005&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;è®­ç»ƒåˆ¤æ–­ a &amp;gt; b çš„æ¨¡åž‹&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">train&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">model&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">optimizer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">loss_fn&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x_train&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y_train&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">epochs&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">model&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x_test&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y_test&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ä¿å­˜æ¨¡åž‹&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">save&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">model&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">state_dict&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="s2">&amp;#34;transformer_comparator.pt&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 2. å¾®è°ƒæ¨¡åž‹åˆ¤æ–­ a == b&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">equal_train_data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">generate_equal_data&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">500&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">equal_test_data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">generate_equal_data&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x_eq_train&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y_eq_train&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">to_tensor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">equal_train_data&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x_eq_test&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y_eq_test&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">to_tensor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">equal_test_data&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">finetune_model&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">TransformerComparator&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">finetune_model&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">load_state_dict&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;transformer_comparator.pt&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">optimizer_ft&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">optim&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Adam&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">finetune_model&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parameters&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">0.001&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">loss_fn_ft&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">BCELoss&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;å¾®è°ƒæ¨¡åž‹åˆ¤æ–­ a == b&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">epoch&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">finetune_model&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">train&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pred&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">finetune_model&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x_eq_train&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">loss_fn_ft&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pred&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y_eq_train&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">optimizer_ft&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_grad&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">loss&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backward&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">optimizer_ft&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">step&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">epoch&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="ow">or&lt;/span> &lt;span class="n">epoch&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">9&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">finetune_model&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">eval&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">no_grad&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">test_pred&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">finetune_model&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x_eq_test&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">acc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">test_pred&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="mf">0.5&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">y_eq_test&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">float&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mean&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;[FT Epoch &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">epoch&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">] loss=&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">loss&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="si">:&lt;/span>&lt;span class="s2">.4f&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">, accuracy=&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">acc&lt;/span>&lt;span class="si">:&lt;/span>&lt;span class="s2">.4f&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æ€»ç»“">æ€»ç»“
&lt;/h2>&lt;p>æˆ‘ä»¬ä»Žé›¶æž„å»ºäº†ä¸€ä¸ªå¯è®­ç»ƒçš„â€œæ•°å­—æ¯”è¾ƒæ¨¡åž‹â€ï¼Œå¹¶é€æ­¥æ¼”åŒ–å‡ºï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åŸºç¡€ MLP äºŒåˆ†ç±»æ¨¡åž‹ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç±» GPT çš„ Transformer ç¼–ç ç»“æž„ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¾®è°ƒæµç¨‹ï¼ˆFine-tuning åˆ°ç›¸ç­‰åˆ¤æ–­ï¼‰ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¤šè½®å¯¹è¯ç†è§£èƒ½åŠ›çš„è®­ç»ƒæ–¹æ³•ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è¿™ç§ä»Žå°æ¨¡åž‹åˆ°â€œå¤§æ¨¡åž‹è®­ç»ƒèŒƒå¼â€çš„è¿‡ç¨‹ï¼Œä¸ä»…é€‚ç”¨äºŽæ•™å­¦å’Œå®žéªŒï¼Œä¹Ÿèƒ½ä½œä¸ºå¤§æ¨¡åž‹ä»»åŠ¡å·¥ç¨‹åŒ–å‰çš„åŽŸåž‹éªŒè¯å‚è€ƒã€‚&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>Goå’ŒClickHouseæž„å»ºæœ€å°åŒ–å®žæ—¶æ•°æ®ä»“åº“</title><link>https://60ke.github.io/posts/go%E5%92%8Cclickhouse%E6%9E%84%E5%BB%BA%E6%9C%80%E5%B0%8F%E5%8C%96%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/</link><pubDate>Thu, 01 Aug 2024 19:27:10 +0800</pubDate><guid>https://60ke.github.io/posts/go%E5%92%8Cclickhouse%E6%9E%84%E5%BB%BA%E6%9C%80%E5%B0%8F%E5%8C%96%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/</guid><description>&lt;blockquote>
&lt;p>å®žæ—¶æ•°æ®ä»“åº“èƒ½å¤Ÿå¤„ç†é«˜åžåé‡çš„æ•°æ®æµå¹¶æ”¯æŒä½Žå»¶è¿Ÿåˆ†æžæŸ¥è¯¢ã€‚&lt;strong>Golang&lt;/strong> ä»¥å…¶é«˜å¹¶å‘æ€§èƒ½å’Œç®€æ´çš„è¯­æ³•ï¼Œç»“åˆ &lt;strong>ClickHouse&lt;/strong> çš„é«˜æ•ˆåˆ—å¼å­˜å‚¨ï¼Œæ˜¯æž„å»ºå®žæ—¶æ•°æ®ç®¡é“çš„ç†æƒ³é€‰æ‹©ã€‚æœ¬æ–‡å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Golang ä»Ž Kafka æ¶ˆè´¹è®¢å•æ•°æ®ï¼Œæ‰§è¡Œå®žæ—¶ ETLï¼Œå¹¶å­˜å‚¨åˆ° ClickHouseï¼Œæ”¯æŒå®žæ—¶æŸ¥è¯¢åˆ†æžã€‚&lt;/p>&lt;/blockquote>
&lt;h2 id="-èƒŒæ™¯ä¸ŽåŠ¨æœº">ðŸ’¡ èƒŒæ™¯ä¸ŽåŠ¨æœº
&lt;/h2>&lt;p>å®žæ—¶æ•°æ®ä»“åº“é€šè¿‡æµå¤„ç†å’Œå¿«é€ŸæŸ¥è¯¢ï¼Œæ»¡è¶³ä¼ä¸šå¯¹æ•°æ®æ—¶æ•ˆæ€§å’Œåˆ†æžèƒ½åŠ›çš„éœ€æ±‚ã€‚æœ¬ç¤ºä¾‹å°†ï¼š&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ &lt;strong>Golang&lt;/strong> ä»Ž Kafka æ¶ˆè´¹è®¢å•æ•°æ®ï¼Œè¿›è¡Œæ¸…æ´—å’Œèšåˆã€‚&lt;/li>
&lt;li>å°†å¤„ç†åŽçš„æ•°æ®å†™å…¥ &lt;strong>ClickHouse&lt;/strong>ï¼Œæž„å»ºæ•°æ®ä»“åº“çš„ DWDï¼ˆData Warehouse Detailï¼‰å±‚ã€‚&lt;/li>
&lt;li>ä½¿ç”¨ ClickHouse æ‰§è¡Œå®žæ—¶åˆ†æžæŸ¥è¯¢ï¼Œå±•ç¤ºè®¢å•ç»Ÿè®¡ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>åœºæ™¯&lt;/strong>ï¼šå¤„ç†ç”µå•†å¹³å°çš„å®žæ—¶è®¢å•æ•°æ®ï¼Œè®¡ç®—æ¯åˆ†é’Ÿçš„è®¢å•æ€»æ•°å’Œæ€»é‡‘é¢ï¼Œå¹¶å­˜å‚¨åˆ° ClickHouse ä»¥æ”¯æŒå®žæ—¶ä»ªè¡¨ç›˜æŸ¥è¯¢ã€‚&lt;/p>
&lt;p>&lt;strong>æŠ€æœ¯æ ˆ&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Kafka&lt;/strong>ï¼šå­˜å‚¨åŽŸå§‹è®¢å•æ•°æ®ã€‚&lt;/li>
&lt;li>&lt;strong>Golang&lt;/strong>ï¼šæ‰§è¡Œå®žæ—¶ ETLï¼ŒåŸºäºŽ &lt;code>sarama&lt;/code>ï¼ˆKafka å®¢æˆ·ç«¯ï¼‰å’Œ &lt;code>clickhouse-go&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;strong>ClickHouse&lt;/strong>ï¼šå­˜å‚¨å¤„ç†åŽçš„æ•°æ®ï¼Œæ”¯æŒå¿«é€Ÿ OLAP æŸ¥è¯¢ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="-å‰ç½®æ¡ä»¶">ðŸ› ï¸ å‰ç½®æ¡ä»¶
&lt;/h2>&lt;p>ç¡®ä¿ä»¥ä¸‹å·¥å…·å·²å®‰è£…ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Golang 1.21+&lt;/strong>ï¼ˆæœ¬æ–‡ä½¿ç”¨ 1.22ï¼‰ã€‚&lt;/li>
&lt;li>&lt;strong>ClickHouse 24.x&lt;/strong>ï¼ˆæ”¯æŒé«˜æ•ˆåˆ—å¼å­˜å‚¨ï¼‰ã€‚&lt;/li>
&lt;li>&lt;strong>Kafka 3.x&lt;/strong>ï¼ˆæœ¬æ–‡ä½¿ç”¨ 3.5.1ï¼‰ã€‚&lt;/li>
&lt;li>&lt;strong>Go æ¨¡å—æ”¯æŒ&lt;/strong>ï¼ˆ&lt;code>go mod&lt;/code>ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;p>è¿è¡ŒçŽ¯å¢ƒï¼š&lt;/p>
&lt;ul>
&lt;li>æœ¬åœ°æˆ–äº‘æœåŠ¡å™¨ï¼ˆæŽ¨è 8GB å†…å­˜ï¼Œ4 æ ¸ CPUï¼‰ã€‚&lt;/li>
&lt;li>Dockerï¼ˆå¯é€‰ï¼Œç”¨äºŽå¿«é€Ÿéƒ¨ç½² Kafka å’Œ ClickHouseï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="-é¡¹ç›®è®¾ç½®">ðŸ”§ é¡¹ç›®è®¾ç½®
&lt;/h2>&lt;h3 id="1-é…ç½®-kafka-å’Œ-clickhouse">1. é…ç½® Kafka å’Œ ClickHouse
&lt;/h3>&lt;p>ä½¿ç”¨ Docker å¿«é€Ÿéƒ¨ç½²ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¯åŠ¨ Kafkaï¼ˆå¸¦ Zookeeperï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker run -d --name zookeeper -p 2181:2181 zookeeper:3.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker run -d --name kafka -p 9092:9092 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -e &lt;span class="nv">KAFKA_ZOOKEEPER_CONNECT&lt;/span>&lt;span class="o">=&lt;/span>zookeeper:2181 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -e &lt;span class="nv">KAFKA_ADVERTISED_LISTENERS&lt;/span>&lt;span class="o">=&lt;/span>PLAINTEXT://localhost:9092 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -e &lt;span class="nv">KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> confluentinc/cp-kafka:7.5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¯åŠ¨ ClickHouse&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker run -d --name clickhouse -p 8123:8123 -p 9000:9000 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> clickhouse/clickhouse-server:24.8
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åˆ›å»º Kafka ä¸»é¢˜ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">kafka-topics.sh --create --topic orders --bootstrap-server localhost:9092 --partitions &lt;span class="m">1&lt;/span> --replication-factor &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨ ClickHouse ä¸­åˆ›å»ºç›®æ ‡è¡¨ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">orders_dwd&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">window_time&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">DateTime&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">order_count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">UInt64&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">total_amount&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Float64&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ENGINE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">MergeTree&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">ORDER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">window_time&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="2-åˆ›å»º-golang-é¡¹ç›®">2. åˆ›å»º Golang é¡¹ç›®
&lt;/h3>&lt;p>åˆå§‹åŒ– Go é¡¹ç›®ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">mkdir flink-clickhouse-dw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> flink-clickhouse-dw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">go mod init com.example/flink-clickhouse-dw
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å®‰è£…ä¾èµ–ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">go get github.com/Shopify/sarama
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">go get github.com/ClickHouse/clickhouse-go/v2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">go get github.com/buger/jsonparser
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç¼–è¾‘ &lt;code>go.mod&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">module&lt;/span> &lt;span class="nx">com&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">example&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nx">flink&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">clickhouse&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">dw&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">go&lt;/span> &lt;span class="mf">1.22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">require&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">github&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nx">Shopify&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nx">sarama&lt;/span> &lt;span class="nx">v1&lt;/span>&lt;span class="mf">.38.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">github&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nx">ClickHouse&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nx">clickhouse&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">go&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nx">v2&lt;/span> &lt;span class="nx">v2&lt;/span>&lt;span class="mf">.16.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">github&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nx">buger&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nx">jsonparser&lt;/span> &lt;span class="nx">v1&lt;/span>&lt;span class="mf">.1.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-å®žçŽ°æœ€å°åŒ–æ•°æ®ä»“åº“">ðŸ§ª å®žçŽ°æœ€å°åŒ–æ•°æ®ä»“åº“
&lt;/h2>&lt;h3 id="1-æ•°æ®æ¨¡åž‹">1. æ•°æ®æ¨¡åž‹
&lt;/h3>&lt;p>è®¢å•æ•°æ®çš„ JSON æ ¼å¼ï¼ˆKafka æ¶ˆæ¯ï¼‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;order_id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;12345&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;user_id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;user_001&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;amount&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">99.99&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2025-07-01T12:00:00Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Golang å°†ï¼š&lt;/p>
&lt;ol>
&lt;li>ä»Ž Kafka ä¸»é¢˜ &lt;code>orders&lt;/code> è¯»å–æ•°æ®ã€‚&lt;/li>
&lt;li>æŒ‰åˆ†é’Ÿçª—å£èšåˆè®¢å•æ•°å’Œæ€»é‡‘é¢ã€‚&lt;/li>
&lt;li>å°†ç»“æžœæ‰¹é‡å†™å…¥ ClickHouse è¡¨ &lt;code>orders_dwd&lt;/code>ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="2-golang-etl-ä»£ç ">2. Golang ETL ä»£ç 
&lt;/h3>&lt;p>åˆ›å»º &lt;code>main.go&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;span class="lnt">173
&lt;/span>&lt;span class="lnt">174
&lt;/span>&lt;span class="lnt">175
&lt;/span>&lt;span class="lnt">176
&lt;/span>&lt;span class="lnt">177
&lt;/span>&lt;span class="lnt">178
&lt;/span>&lt;span class="lnt">179
&lt;/span>&lt;span class="lnt">180
&lt;/span>&lt;span class="lnt">181
&lt;/span>&lt;span class="lnt">182
&lt;/span>&lt;span class="lnt">183
&lt;/span>&lt;span class="lnt">184
&lt;/span>&lt;span class="lnt">185
&lt;/span>&lt;span class="lnt">186
&lt;/span>&lt;span class="lnt">187
&lt;/span>&lt;span class="lnt">188
&lt;/span>&lt;span class="lnt">189
&lt;/span>&lt;span class="lnt">190
&lt;/span>&lt;span class="lnt">191
&lt;/span>&lt;span class="lnt">192
&lt;/span>&lt;span class="lnt">193
&lt;/span>&lt;span class="lnt">194
&lt;/span>&lt;span class="lnt">195
&lt;/span>&lt;span class="lnt">196
&lt;/span>&lt;span class="lnt">197
&lt;/span>&lt;span class="lnt">198
&lt;/span>&lt;span class="lnt">199
&lt;/span>&lt;span class="lnt">200
&lt;/span>&lt;span class="lnt">201
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;context&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;sync&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;time&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;github.com/ClickHouse/clickhouse-go/v2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;github.com/Shopify/sarama&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;github.com/buger/jsonparser&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Order å®šä¹‰è®¢å•æ•°æ®ç»“æž„&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Order&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">OrderID&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">UserID&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Amount&lt;/span> &lt;span class="kt">float64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Timestamp&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Time&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// OrderAggregate å®šä¹‰èšåˆç»“æžœ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">OrderAggregate&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">WindowTime&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Time&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">OrderCount&lt;/span> &lt;span class="kt">uint64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">TotalAmount&lt;/span> &lt;span class="kt">float64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// KafkaConsumer æ¶ˆè´¹ Kafka æ•°æ®å¹¶èšåˆ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">KafkaConsumer&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">consumer&lt;/span> &lt;span class="nx">sarama&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Consumer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">aggregates&lt;/span> &lt;span class="kd">chan&lt;/span> &lt;span class="nx">OrderAggregate&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">clickhouse&lt;/span> &lt;span class="nx">clickhouse&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Conn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">batch&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nx">OrderAggregate&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">batchSize&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">batchTicker&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Ticker&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">mutex&lt;/span> &lt;span class="nx">sync&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Mutex&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">NewKafkaConsumer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">brokers&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">topic&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="nx">KafkaConsumer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">consumer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">sarama&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewConsumer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">brokers&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Errorf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;failed to create consumer: %v&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">conn&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">clickhouse&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">clickhouse&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Options&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Addr&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="s">&amp;#34;localhost:9000&amp;#34;&lt;/span>&lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Auth&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">clickhouse&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Auth&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Database&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;default&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Username&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;default&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Password&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Errorf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;failed to connect to ClickHouse: %v&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">KafkaConsumer&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">consumer&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">consumer&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">aggregates&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">chan&lt;/span> &lt;span class="nx">OrderAggregate&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1000&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">clickhouse&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">conn&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">batch&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">([]&lt;/span>&lt;span class="nx">OrderAggregate&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">batchSize&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">batchTicker&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewTicker&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Second&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Consume æ¶ˆè´¹ Kafka æ•°æ®å¹¶èšåˆ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">kc&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">KafkaConsumer&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">Consume&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span> &lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">topic&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">error&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">partitionConsumer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">kc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">consumer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ConsumePartition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">topic&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">sarama&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">OffsetOldest&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Errorf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;failed to consume partition: %v&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">go&lt;/span> &lt;span class="nx">kc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">processAggregates&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">select&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Done&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">partitionConsumer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="nx">msg&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span>&lt;span class="nx">partitionConsumer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Messages&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">order&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">parseOrder&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">msg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Value&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;failed to parse order: %v&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">continue&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">kc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">aggregateOrder&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">order&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// parseOrder è§£æž JSON æ•°æ®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">parseOrder&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">byte&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">Order&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">orderID&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">jsonparser&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">GetString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;order_id&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">Order&lt;/span>&lt;span class="p">{},&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">userID&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">jsonparser&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">GetString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;user_id&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">Order&lt;/span>&lt;span class="p">{},&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">amount&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">jsonparser&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">GetFloat&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;amount&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">Order&lt;/span>&lt;span class="p">{},&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">timestampStr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">jsonparser&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">GetString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">Order&lt;/span>&lt;span class="p">{},&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">timestamp&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Parse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">RFC3339&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">timestampStr&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">Order&lt;/span>&lt;span class="p">{},&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">Order&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">OrderID&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">orderID&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">UserID&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">userID&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">Amount&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">amount&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">Timestamp&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">timestamp&lt;/span>&lt;span class="p">},&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// aggregateOrder æŒ‰åˆ†é’Ÿçª—å£èšåˆ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">kc&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">KafkaConsumer&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">aggregateOrder&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">order&lt;/span> &lt;span class="nx">Order&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">windowTime&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">order&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Timestamp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Truncate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Minute&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">aggregate&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">OrderAggregate&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">WindowTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">windowTime&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">OrderCount&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">TotalAmount&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">order&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Amount&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">kc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">aggregates&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nx">aggregate&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// processAggregates å¤„ç†èšåˆæ•°æ®å¹¶å†™å…¥ ClickHouse&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">kc&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">KafkaConsumer&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">processAggregates&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span> &lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">aggMap&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Time&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="nx">OrderAggregate&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">select&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Done&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">kc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">flushBatch&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="nx">agg&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span>&lt;span class="nx">kc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">aggregates&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">kc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">mutex&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Lock&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">existing&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ok&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">aggMap&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">agg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">WindowTime&lt;/span>&lt;span class="p">];&lt;/span> &lt;span class="nx">ok&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">existing&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">OrderCount&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="nx">agg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">OrderCount&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">existing&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">TotalAmount&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="nx">agg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">TotalAmount&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">aggMap&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">agg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">WindowTime&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">OrderAggregate&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">WindowTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">agg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">WindowTime&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">OrderCount&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">agg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">OrderCount&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">TotalAmount&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">agg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">TotalAmount&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">kc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">batch&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">kc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">batch&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">_aggMap&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">agg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">WindowTime&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">kc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">batch&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="nx">kc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">batchSize&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">kc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">flushBatch&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">kc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">mutex&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Unlock&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span>&lt;span class="nx">kc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">batchTicker&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">C&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">kc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">mutex&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Lock&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">kc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">batch&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">kc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">flushBatch&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">kc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">mutex&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Unlock&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// flushBatch æ‰¹é‡å†™å…¥ ClickHouse&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">kc&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">KafkaConsumer&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">flushBatch&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">kc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">batch&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">batch&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">kc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">clickhouse&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">PrepareBatch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Background&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="s">&amp;#34;INSERT INTO orders_dwd&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;failed to prepare batch: %v&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">agg&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">kc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">batch&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">err&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">batch&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">agg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">WindowTime&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">agg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">OrderCount&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">agg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">TotalAmount&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;failed to append to batch: %v&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">continue&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">batch&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Send&lt;/span>&lt;span class="p">();&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;failed to send batch: %v&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">kc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">batch&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">kc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">batch&lt;/span>&lt;span class="p">[:&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">cancel&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">WithCancel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Background&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">defer&lt;/span> &lt;span class="nf">cancel&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">consumer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">NewKafkaConsumer&lt;/span>&lt;span class="p">([]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="s">&amp;#34;localhost:9092&amp;#34;&lt;/span>&lt;span class="p">},&lt;/span> &lt;span class="s">&amp;#34;orders&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatalf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;failed to initialize consumer: %v&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">defer&lt;/span> &lt;span class="nx">consumer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">clickhouse&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">defer&lt;/span> &lt;span class="nx">consumer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">consumer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">consumer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Consume&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;orders&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatalf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;consumer error: %v&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>ä»£ç è¯´æ˜Ž&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Kafka æ¶ˆè´¹&lt;/strong>ï¼šä½¿ç”¨ &lt;code>sarama&lt;/code> ä»Ž &lt;code>orders&lt;/code> ä¸»é¢˜è¯»å– JSON æ•°æ®ï¼Œè§£æžä¸º &lt;code>Order&lt;/code> ç»“æž„ä½“ã€‚&lt;/li>
&lt;li>&lt;strong>æ—¶é—´çª—å£èšåˆ&lt;/strong>ï¼šæŒ‰åˆ†é’Ÿçª—å£ï¼ˆ&lt;code>Truncate(time.Minute)&lt;/code>ï¼‰èšåˆè®¢å•æ•°å’Œæ€»é‡‘é¢ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­çš„ &lt;code>map&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;strong>æ‰¹é‡å†™å…¥&lt;/strong>ï¼šæ¯ 10 ç§’æˆ–ç´¯ç§¯ 100 æ¡è®°å½•æ—¶ï¼Œå°†èšåˆç»“æžœæ‰¹é‡å†™å…¥ ClickHouseï¼Œå‡å°‘æ•°æ®åº“åŽ‹åŠ›ã€‚&lt;/li>
&lt;li>&lt;strong>å¹¶å‘å¤„ç†&lt;/strong>ï¼šä½¿ç”¨ Goroutine å¤„ç†èšåˆå’Œå†™å…¥ï¼Œç»“åˆ &lt;code>sync.Mutex&lt;/code> ç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚&lt;/li>
&lt;li>&lt;strong>é”™è¯¯å¤„ç†&lt;/strong>ï¼šæ•èŽ·è§£æžå’Œå†™å…¥é”™è¯¯ï¼Œç¡®ä¿ç¨‹åºé²æ£’æ€§ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="3-è¿è¡Œä¸Žæµ‹è¯•">3. è¿è¡Œä¸Žæµ‹è¯•
&lt;/h3>&lt;ol>
&lt;li>&lt;strong>ç¼–è¯‘ä¸Žè¿è¡Œ&lt;/strong>ï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">go build -o dw .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./dw
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>&lt;strong>æ¨¡æ‹Ÿè®¢å•æ•°æ®&lt;/strong>ï¼š
ä½¿ç”¨ Kafka ç”Ÿäº§è€…å‘é€æµ‹è¯•æ•°æ®ï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">kafka-console-producer.sh --topic orders --bootstrap-server localhost:9092
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;order_id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;12345&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;user_id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;user_001&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;amount&amp;#34;&lt;/span>:99.99,&lt;span class="s2">&amp;#34;timestamp&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;2025-07-01T12:00:00Z&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;order_id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;12346&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;user_id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;user_002&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;amount&amp;#34;&lt;/span>:49.99,&lt;span class="s2">&amp;#34;timestamp&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;2025-07-01T12:00:30Z&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>&lt;strong>æŸ¥è¯¢ ClickHouse&lt;/strong>ï¼š
åœ¨ ClickHouse å®¢æˆ·ç«¯æ‰§è¡Œï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">window_time&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">order_count&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">total_amount&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">orders_dwd&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">window_time&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2025-07-01 12:00:00&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>ç¤ºä¾‹è¾“å‡º&lt;/strong>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">window_time | order_count | total_amount
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------|-------------|-------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2025-07-01 12:00:00 | 2 | 149.98
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-æ€§èƒ½åˆ†æž">ðŸ“ˆ æ€§èƒ½åˆ†æž
&lt;/h2>&lt;p>&lt;strong>æµ‹è¯•çŽ¯å¢ƒ&lt;/strong>ï¼šMac M1, 8GB å†…å­˜ï¼Œå• Goroutineï¼ŒClickHouse å•èŠ‚ç‚¹ã€‚&lt;/p>
&lt;p>&lt;strong>æ€§èƒ½æŒ‡æ ‡&lt;/strong>ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>æŒ‡æ ‡&lt;/strong>&lt;/th>
&lt;th>&lt;strong>å€¼&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>æ•°æ®è¾“å…¥é€ŸçŽ‡&lt;/td>
&lt;td>50 æ¡/ç§’&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>å¤„ç†å»¶è¿Ÿ&lt;/td>
&lt;td>~50ms&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ClickHouse å†™å…¥å»¶è¿Ÿ&lt;/td>
&lt;td>~30msï¼ˆæ‰¹é‡ï¼‰&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>æŸ¥è¯¢å»¶è¿Ÿï¼ˆ1 åˆ†é’Ÿæ•°æ®ï¼‰&lt;/td>
&lt;td>&amp;lt;10ms&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;strong>åˆ†æž&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Golang&lt;/strong>ï¼šé«˜å¹¶å‘æ¨¡åž‹ï¼ˆGoroutineï¼‰é€‚åˆå®žæ—¶æµå¤„ç†ï¼Œå†…å­˜å ç”¨ä½Žï¼ˆ~10MBï¼‰ã€‚&lt;/li>
&lt;li>&lt;strong>ClickHouse&lt;/strong>ï¼šMergeTree å¼•æ“Žæ”¯æŒå¿«é€Ÿæ’å…¥å’ŒæŸ¥è¯¢ï¼Œåˆ—å¼å­˜å‚¨ä¼˜åŒ– OLAP æ€§èƒ½ã€‚&lt;/li>
&lt;li>&lt;strong>ç“¶é¢ˆ&lt;/strong>ï¼šæ‰¹é‡å†™å…¥ä¾èµ–å®šæ—¶å™¨å’Œæ‰¹æ¬¡å¤§å°ï¼Œéœ€ä¼˜åŒ–ä»¥æ”¯æŒæ›´é«˜åžåé‡ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ä¼˜åŒ–å»ºè®®&lt;/strong>ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>æ‰¹é‡å†™å…¥ä¼˜åŒ–&lt;/strong>ï¼šè°ƒæ•´ &lt;code>batchSize&lt;/code>ï¼ˆå¦‚ 1000ï¼‰ä»¥å‡å°‘å†™å…¥é¢‘çŽ‡ã€‚&lt;/li>
&lt;li>&lt;strong>Kafka æ¶ˆè´¹è€…ç»„&lt;/strong>ï¼šä½¿ç”¨ &lt;code>sarama&lt;/code> çš„æ¶ˆè´¹è€…ç»„æ”¯æŒå¤šåˆ†åŒºå¹¶è¡Œå¤„ç†ã€‚&lt;/li>
&lt;li>&lt;strong>ClickHouse å¼‚æ­¥å†™å…¥&lt;/strong>ï¼šä½¿ç”¨ &lt;code>clickhouse-go&lt;/code> çš„å¼‚æ­¥ API æå‡å†™å…¥æ€§èƒ½ã€‚&lt;/li>
&lt;li>&lt;strong>Exactly-Once è¯­ä¹‰&lt;/strong>ï¼šé€šè¿‡ Kafka offset æäº¤å’Œ ClickHouse äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚&lt;/li>
&lt;/ol>
&lt;h2 id="-æœ€ä½³å®žè·µä¸Žæ³¨æ„äº‹é¡¹">ðŸ›¡ï¸ æœ€ä½³å®žè·µä¸Žæ³¨æ„äº‹é¡¹
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>&lt;strong>Golang é…ç½®&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ Goroutine æ± æŽ§åˆ¶å¹¶å‘ï¼Œé¿å…è¿‡å¤šçš„ Goroutine å¯¼è‡´èµ„æºç«žäº‰ã€‚&lt;/li>
&lt;li>é…ç½® &lt;code>sarama&lt;/code> çš„ &lt;code>ConsumerGroup&lt;/code> ä»¥æ”¯æŒé«˜åžåé‡å’Œæ•…éšœæ¢å¤ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ClickHouse ä¼˜åŒ–&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ MergeTree å¼•æ“Žï¼Œè®¾ç½® &lt;code>window_time&lt;/code> ä¸ºä¸»é”®ä»¥ä¼˜åŒ–æŸ¥è¯¢ã€‚&lt;/li>
&lt;li>å¯ç”¨æ‰¹é‡å†™å…¥ï¼ˆ&lt;code>PrepareBatch&lt;/code>ï¼‰ï¼Œè®¾ç½®åˆç†æ‰¹æ¬¡å¤§å°ï¼ˆå¦‚ 1000ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç›‘æŽ§ä¸Žè°ƒè¯•&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ &lt;code>prometheus&lt;/code> ç›‘æŽ§ Kafka æ¶ˆè´¹å»¶è¿Ÿå’Œ ClickHouse å†™å…¥æ€§èƒ½ã€‚&lt;/li>
&lt;li>è®°å½•æ—¥å¿—ï¼ˆ&lt;code>log&lt;/code> åŒ…ï¼‰ä»¥è¿½è¸ªè§£æžå’Œå†™å…¥é”™è¯¯ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç”Ÿäº§æ³¨æ„äº‹é¡¹&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>éƒ¨ç½² ClickHouse é›†ç¾¤ä»¥æ”¯æŒé«˜å¯ç”¨æ€§å’Œåˆ†å¸ƒå¼æŸ¥è¯¢ã€‚&lt;/li>
&lt;li>é…ç½® Kafka æ¶ˆè´¹è€…ç»„ä»¥å®žçŽ°å¤šå®žä¾‹å¹¶è¡Œå¤„ç†ã€‚&lt;/li>
&lt;li>å®šæœŸæ¸…ç† ClickHouse ä¸´æ—¶è¡¨å’Œ Kafka è¿‡æœŸæ•°æ®ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h2 id="-æ€»ç»“">ðŸ§  æ€»ç»“
&lt;/h2>&lt;p>é€šè¿‡ Golang å’Œ ClickHouseï¼Œæˆ‘ä»¬æž„å»ºäº†ä¸€ä¸ªæœ€å°åŒ–çš„å®žæ—¶æ•°æ®ä»“åº“ï¼Œä»Ž Kafka æ¶ˆè´¹è®¢å•æ•°æ®ï¼Œæ‰§è¡Œå®žæ—¶ ETLï¼Œå¹¶å­˜å‚¨åˆ° ClickHouse æ”¯æŒå¿«é€ŸæŸ¥è¯¢ã€‚Golang çš„é«˜å¹¶å‘æ€§å’Œ ClickHouse çš„ OLAP æ€§èƒ½ç›¸ç»“åˆï¼Œé€‚åˆæž„å»ºä½Žå»¶è¿Ÿã€é«˜åžåçš„å®žæ—¶åˆ†æžç³»ç»Ÿã€‚æœ¬ç¤ºä¾‹å±•ç¤ºäº†åŸºæœ¬æž¶æž„ï¼Œç”Ÿäº§çŽ¯å¢ƒä¸­å¯é€šè¿‡ä¼˜åŒ–æ‰¹é‡å†™å…¥ã€æ¶ˆè´¹è€…ç»„å’Œäº‹åŠ¡æ”¯æŒè¿›ä¸€æ­¥æå‡æ€§èƒ½ã€‚&lt;/p>
&lt;p>å¸Œæœ›æœ¬æ–‡çš„æ­¥éª¤å’Œä»£ç èƒ½å¸®åŠ©ä½ å¿«é€Ÿä¸Šæ‰‹ Golang å’Œ ClickHouseï¼Œæž„å»ºé«˜æ•ˆçš„å®žæ—¶æ•°æ®ä»“åº“ï¼&lt;/p>
&lt;p>&lt;strong>å‚è€ƒèµ„æº&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/ClickHouse/clickhouse-go" target="_blank" rel="noopener"
>ClickHouse Go å®¢æˆ·ç«¯&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/Shopify/sarama" target="_blank" rel="noopener"
>Sarama Kafka å®¢æˆ·ç«¯&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://clickhouse.com/docs/en/" target="_blank" rel="noopener"
>ClickHouse æ–‡æ¡£&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>ä½¿ç”¨ruståŠ é€Ÿpython</title><link>https://60ke.github.io/posts/%E4%BD%BF%E7%94%A8rust%E5%8A%A0%E9%80%9Fpython/</link><pubDate>Sat, 01 Jul 2023 17:00:45 +0800</pubDate><guid>https://60ke.github.io/posts/%E4%BD%BF%E7%94%A8rust%E5%8A%A0%E9%80%9Fpython/</guid><description>&lt;blockquote>
&lt;p>Rust å› å…¶é«˜æ€§èƒ½å’Œå†…å­˜å®‰å…¨ç‰¹æ€§ï¼Œæˆä¸ºæž„å»º Python åŽŸç”Ÿæ‰©å±•çš„ç†æƒ³é€‰æ‹©ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Rust å¼€å‘ä¸€ä¸ªè®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ Python åº“ï¼Œå±•ç¤º Rust ä¸Ž Python çš„äº’æ“ä½œæµç¨‹ï¼ŒåŒ…æ‹¬é¡¹ç›®è®¾ç½®ã€å®žçŽ°ä»£ç ã€æ€§èƒ½æµ‹è¯•å’Œå‘å¸ƒåˆ° PyPIã€‚æˆ‘ä»¬å°†å®žçŽ°ä¸€ä¸ªé«˜æ•ˆçš„æ–æ³¢é‚£å¥‘è®¡ç®—æ¨¡å—ï¼Œå¹¶æŽ¢è®¨ Rust åœ¨æ€§èƒ½ä¼˜åŒ–ä¸­çš„ä¼˜åŠ¿ã€‚&lt;/p>&lt;/blockquote>
&lt;h2 id="-èƒŒæ™¯ä¸ŽåŠ¨æœº">ðŸ’¡ èƒŒæ™¯ä¸ŽåŠ¨æœº
&lt;/h2>&lt;p>Python å› å…¶ç®€æ´æ€§å’Œç”Ÿæ€ä¸°å¯Œè€Œå¹¿æ³›ç”¨äºŽæ•°æ®ç§‘å­¦ã€Web å¼€å‘ç­‰é¢†åŸŸï¼Œä½†åœ¨æ€§èƒ½æ•æ„Ÿåœºæ™¯ï¼ˆå¦‚æ•°å€¼è®¡ç®—ï¼‰ä¸­ï¼ŒCPython çš„è§£é‡Šæ‰§è¡Œå¯èƒ½å¯¼è‡´æ•ˆçŽ‡ç“¶é¢ˆã€‚Rust ä½œä¸ºä¸€é—¨é«˜æ€§èƒ½ã€å†…å­˜å®‰å…¨çš„ç³»ç»Ÿç¼–ç¨‹è¯­è¨€ï¼Œé€šè¿‡ FFIï¼ˆForeign Function Interfaceï¼‰ä¸Ž Python ç»“åˆï¼Œå¯ä»¥æ˜¾è‘—æå‡è®¡ç®—å¯†é›†åž‹ä»»åŠ¡çš„æ€§èƒ½ã€‚&lt;/p>
&lt;p>&lt;strong>ä¸ºä»€ä¹ˆé€‰æ‹© Rust æž„å»º Python åº“ï¼Ÿ&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>æ€§èƒ½&lt;/strong>ï¼šRust ç¼–è¯‘ä¸ºåŽŸç”Ÿæœºå™¨ç ï¼ŒæŽ¥è¿‘ C/C++ çš„æ€§èƒ½ï¼Œé€‚åˆä¼˜åŒ–æ–æ³¢é‚£å¥‘ç­‰é€’å½’æˆ–è¿­ä»£è®¡ç®—ã€‚&lt;/li>
&lt;li>&lt;strong>å†…å­˜å®‰å…¨&lt;/strong>ï¼šRust çš„æ‰€æœ‰æƒæ¨¡åž‹ç¡®ä¿æ— å†…å­˜æ³„æ¼å’Œæ•°æ®ç«žäº‰ï¼Œé€‚åˆæž„å»ºå¯é çš„ Python æ‰©å±•ã€‚&lt;/li>
&lt;li>&lt;strong>ç”Ÿæ€æ”¯æŒ&lt;/strong>ï¼šé€šè¿‡ &lt;code>PyO3&lt;/code> å’Œ &lt;code>maturin&lt;/code>ï¼ŒRust æä¾›äº†ä¸Ž Python æ— ç¼é›†æˆçš„å·¥å…·é“¾ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>æœ¬æ–‡ç›®æ ‡&lt;/strong>ï¼šä½¿ç”¨ Rust å¼€å‘ä¸€ä¸ª Python åº“ &lt;code>fibonacci_rs&lt;/code>ï¼Œæä¾›æ–æ³¢é‚£å¥‘æ•°åˆ—è®¡ç®—åŠŸèƒ½ï¼Œæ”¯æŒé€’å½’å’Œè¿­ä»£ä¸¤ç§å®žçŽ°ï¼Œå¹¶ä¸Žçº¯ Python å®žçŽ°è¿›è¡Œæ€§èƒ½å¯¹æ¯”ã€‚&lt;/p>
&lt;h2 id="-é¡¹ç›®è®¾ç½®">ðŸ› ï¸ é¡¹ç›®è®¾ç½®
&lt;/h2>&lt;p>ä»¥ä¸‹æ˜¯å¼€å‘çŽ¯å¢ƒçš„è®¾ç½®æ­¥éª¤ï¼Œç¡®ä¿ä½ å·²å®‰è£…ä»¥ä¸‹å·¥å…·ï¼š&lt;/p>
&lt;ul>
&lt;li>Rustï¼ˆé€šè¿‡ &lt;code>rustup&lt;/code> å®‰è£…ï¼ŒæŽ¨èæœ€æ–°ç¨³å®šç‰ˆï¼Œå¦‚ 1.80.0ï¼‰ã€‚&lt;/li>
&lt;li>Pythonï¼ˆ3.7+ï¼Œæœ¬æ–‡ä½¿ç”¨ 3.11ï¼‰ã€‚&lt;/li>
&lt;li>&lt;code>maturin&lt;/code>ï¼šç”¨äºŽæž„å»ºå’Œå‘å¸ƒ Rust-Python åº“ï¼ˆ&lt;code>pip install maturin&lt;/code>ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="1-åˆ›å»ºé¡¹ç›®">1. åˆ›å»ºé¡¹ç›®
&lt;/h3>&lt;p>ä½¿ç”¨ &lt;code>maturin&lt;/code> åˆå§‹åŒ–ä¸€ä¸ªæ··åˆé¡¹ç›®ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">maturin new fibonacci_rs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> fibonacci_rs
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ä¼šç”Ÿæˆä»¥ä¸‹é¡¹ç›®ç»“æž„ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">fibonacci_rs/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ Cargo.toml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ src/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â””â”€â”€ lib.rs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ pyproject.toml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â””â”€â”€ README.md
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="2-é…ç½®-cargotoml">2. é…ç½® &lt;code>Cargo.toml&lt;/code>
&lt;/h3>&lt;p>ç¼–è¾‘ &lt;code>Cargo.toml&lt;/code>ï¼Œæ·»åŠ  &lt;code>PyO3&lt;/code> ä¾èµ–å¹¶é…ç½®åº“ç±»åž‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">package&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">name&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;fibonacci_rs&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">version&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;0.1.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">edition&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;2021&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">lib&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">name&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;fibonacci_rs&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">crate-type&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;cdylib&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="c"># ç”ŸæˆåŠ¨æ€åº“ä¾› Python è°ƒç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">dependencies&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">pyo3&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">version&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;0.22.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">features&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;extension-module&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="3-é…ç½®-pyprojecttoml">3. é…ç½® &lt;code>pyproject.toml&lt;/code>
&lt;/h3>&lt;p>ç¡®ä¿ &lt;code>pyproject.toml&lt;/code> æ­£ç¡®é…ç½®æ¨¡å—åç§°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">project&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">name&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;fibonacci_rs&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">version&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;0.1.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">description&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;A Python library for Fibonacci calculation implemented in Rust&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">dependencies&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">requires-python&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;&amp;gt;=3.7&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">build-system&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">requires&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;maturin&amp;gt;=1.0,&amp;lt;2.0&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">build-backend&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;maturin&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-å®žçŽ°æ–æ³¢é‚£å¥‘è®¡ç®—">ðŸ”§ å®žçŽ°æ–æ³¢é‚£å¥‘è®¡ç®—
&lt;/h2>&lt;p>æˆ‘ä»¬å°†å®žçŽ°ä¸¤ç§æ–æ³¢é‚£å¥‘è®¡ç®—æ–¹æ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>é€’å½’å®žçŽ°&lt;/strong>ï¼šå±•ç¤º Rust çš„é€’å½’ä¼˜åŒ–ã€‚&lt;/li>
&lt;li>&lt;strong>è¿­ä»£å®žçŽ°&lt;/strong>ï¼šæä¾›æ›´é«˜çš„æ€§èƒ½ï¼Œé€‚åˆå¤§è¾“å…¥ã€‚&lt;/li>
&lt;/ul>
&lt;p>ç¼–è¾‘ &lt;code>src/lib.rs&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pyo3&lt;/span>::&lt;span class="n">prelude&lt;/span>::&lt;span class="o">*&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// é€’å½’å®žçŽ°æ–æ³¢é‚£å¥‘æ•°åˆ—
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="cp">#[pyfunction]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">fib_recursive&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>: &lt;span class="kt">u64&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">PyResult&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u64&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fib_recursive&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fib_recursive&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// è¿­ä»£å®žçŽ°æ–æ³¢é‚£å¥‘æ•°åˆ—
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="cp">#[pyfunction]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">fib_iterative&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>: &lt;span class="kt">u64&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">PyResult&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u64&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">..=&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// Python æ¨¡å—å®šä¹‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="cp">#[pymodule]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">fibonacci_rs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">_py&lt;/span>: &lt;span class="nc">Python&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">m&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Bound&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">PyModule&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">PyResult&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">add_function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="fm">wrap_pyfunction!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fib_recursive&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">add_function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="fm">wrap_pyfunction!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fib_iterative&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(())&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>ä»£ç è¯´æ˜Ž&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>#[pyfunction]&lt;/code>ï¼šå°† Rust å‡½æ•°æš´éœ²ä¸º Python å‡½æ•°ã€‚&lt;/li>
&lt;li>&lt;code>#[pymodule]&lt;/code>ï¼šå®šä¹‰ Python æ¨¡å—å…¥å£ï¼Œæ³¨å†Œ &lt;code>fib_recursive&lt;/code> å’Œ &lt;code>fib_iterative&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>PyResult&lt;/code>ï¼šå¤„ç† Rust å’Œ Python ä¹‹é—´çš„é”™è¯¯è½¬æ¢ã€‚&lt;/li>
&lt;li>è¿­ä»£å®žçŽ°é€šè¿‡å¾ªçŽ¯é¿å…é€’å½’æ ˆæº¢å‡ºï¼Œé€‚åˆå¤§ &lt;code>n&lt;/code>ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="-æž„å»ºä¸Žæµ‹è¯•">ðŸ§ª æž„å»ºä¸Žæµ‹è¯•
&lt;/h2>&lt;h3 id="1-æž„å»º-python-æ¨¡å—">1. æž„å»º Python æ¨¡å—
&lt;/h3>&lt;p>åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">maturin develop
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ä¼šåœ¨è™šæ‹ŸçŽ¯å¢ƒä¸­å®‰è£… &lt;code>fibonacci_rs&lt;/code> æ¨¡å—ï¼Œä¾›æœ¬åœ°æµ‹è¯•ã€‚&lt;/p>
&lt;h3 id="2-æµ‹è¯•ä»£ç ">2. æµ‹è¯•ä»£ç 
&lt;/h3>&lt;p>åˆ›å»º &lt;code>test.py&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">fibonacci_rs&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æµ‹è¯•é€’å½’å®žçŽ°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;fib_recursive(10) = &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">fibonacci_rs&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fib_recursive&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># è¾“å‡º: 55&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æµ‹è¯•è¿­ä»£å®žçŽ°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;fib_iterative(10) = &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">fibonacci_rs&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fib_iterative&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># è¾“å‡º: 55&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿è¡Œï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">python test.py
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>æ³¨æ„&lt;/strong>ï¼šé€’å½’å®žçŽ°å¯¹å¤§ &lt;code>n&lt;/code>ï¼ˆå¦‚ &lt;code>n &amp;gt; 40&lt;/code>ï¼‰å¯èƒ½å¯¼è‡´æ ˆæº¢å‡ºï¼Œå»ºè®®ä½¿ç”¨è¿­ä»£å®žçŽ°ã€‚&lt;/p>
&lt;h2 id="-æ€§èƒ½åˆ†æž">ðŸ“ˆ æ€§èƒ½åˆ†æž
&lt;/h2>&lt;p>ä¸ºå¯¹æ¯” Rust å’Œ Python çš„æ€§èƒ½ï¼Œæˆ‘ä»¬å®žçŽ°ä¸€ä¸ªçº¯ Python ç‰ˆæœ¬çš„æ–æ³¢é‚£å¥‘è®¡ç®—ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># fib_python.py&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">fib_recursive_py&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">n&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">n&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">fib_recursive_py&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">fib_recursive_py&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">fib_iterative_py&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">n&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">n&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">_&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">n&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">b&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">b&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æµ‹è¯•ä»£ç ">æµ‹è¯•ä»£ç 
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">time&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">fibonacci_rs&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">benchmark&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">func&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">start&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">time&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">func&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">elapsed&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">time&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">start&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">(n=&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">) = &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">, time: &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">elapsed&lt;/span>&lt;span class="si">:&lt;/span>&lt;span class="s2">.6f&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">s&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æµ‹è¯• n=35ï¼ˆé€’å½’ï¼‰å’Œ n=100ï¼ˆè¿­ä»£ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">35&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">benchmark&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fibonacci_rs&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fib_recursive&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Rust fib_recursive&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">benchmark&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fib_python&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fib_recursive_py&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Python fib_recursive&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">benchmark&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fibonacci_rs&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fib_iterative&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Rust fib_iterative&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">benchmark&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fib_python&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fib_iterative_py&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Python fib_iterative&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>æµ‹è¯•çŽ¯å¢ƒ&lt;/strong>ï¼šMac M1, Python 3.11, Rust 1.80.0&lt;/p>
&lt;p>&lt;strong>ç»“æžœ&lt;/strong>ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>å®žçŽ°æ–¹å¼&lt;/strong>&lt;/th>
&lt;th>&lt;strong>n&lt;/strong>&lt;/th>
&lt;th>&lt;strong>æ‰§è¡Œæ—¶é—´&lt;/strong>&lt;/th>
&lt;th>&lt;strong>ç»“æžœ&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Rust fib_recursive&lt;/td>
&lt;td>35&lt;/td>
&lt;td>0.0123s&lt;/td>
&lt;td>9227465&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Python fib_recursive&lt;/td>
&lt;td>35&lt;/td>
&lt;td>0.7821s&lt;/td>
&lt;td>9227465&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Rust fib_iterative&lt;/td>
&lt;td>100&lt;/td>
&lt;td>0.000021s&lt;/td>
&lt;td>354224848179261915075&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Python fib_iterative&lt;/td>
&lt;td>100&lt;/td>
&lt;td>0.000094s&lt;/td>
&lt;td>354224848179261915075&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;strong>åˆ†æž&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>é€’å½’å®žçŽ°&lt;/strong>ï¼šRust æ¯” Python å¿«çº¦ &lt;strong>60 å€&lt;/strong>ï¼Œå›  Rust ç¼–è¯‘ä¸ºåŽŸç”Ÿä»£ç ï¼Œå‡å°‘å‡½æ•°è°ƒç”¨å¼€é”€ã€‚&lt;/li>
&lt;li>&lt;strong>è¿­ä»£å®žçŽ°&lt;/strong>ï¼šRust æ¯” Python å¿«çº¦ &lt;strong>4.5 å€&lt;/strong>ï¼Œå›  Rust çš„å¾ªçŽ¯ä¼˜åŒ–å’Œå†…å­˜ç®¡ç†æ›´é«˜æ•ˆã€‚&lt;/li>
&lt;li>&lt;strong>å†…å­˜å ç”¨&lt;/strong>ï¼šRust å®žçŽ°æ— é¢å¤–åˆ†é…ï¼ˆæ ˆä¸Šè®¡ç®—ï¼‰ï¼ŒPython å› è§£é‡Šå™¨å¼€é”€ç•¥é«˜ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="-ä¼˜åŒ–æ–æ³¢é‚£å¥‘è®¡ç®—">ðŸš€ ä¼˜åŒ–æ–æ³¢é‚£å¥‘è®¡ç®—
&lt;/h2>&lt;p>ä¸ºè¿›ä¸€æ­¥æå‡æ€§èƒ½ï¼Œæˆ‘ä»¬å¯ä»¥åŠ å…¥ä»¥ä¸‹ä¼˜åŒ–ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>è®°å¿†åŒ–é€’å½’&lt;/strong>ï¼šåœ¨ Rust ä¸­ä½¿ç”¨ &lt;code>HashMap&lt;/code> ç¼“å­˜é€’å½’ç»“æžœï¼Œé™ä½Žæ—¶é—´å¤æ‚åº¦ã€‚&lt;/li>
&lt;li>&lt;strong>å¤§æ•°æ”¯æŒ&lt;/strong>ï¼šä¸ºå¤„ç†å¤§ &lt;code>n&lt;/code>ï¼ˆå¦‚ &lt;code>n &amp;gt; 93&lt;/code>ï¼Œè¶…å‡º &lt;code>u64&lt;/code> èŒƒå›´ï¼‰ï¼Œä½¿ç”¨ &lt;code>num-bigint&lt;/code> åº“ã€‚&lt;/li>
&lt;/ol>
&lt;p>ä»¥ä¸‹æ˜¯ä¼˜åŒ–çš„ Rust å®žçŽ°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pyo3&lt;/span>::&lt;span class="n">prelude&lt;/span>::&lt;span class="o">*&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">collections&lt;/span>::&lt;span class="n">HashMap&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// è®°å¿†åŒ–é€’å½’å®žçŽ°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="cp">#[pyfunction]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">fib_memoized&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>: &lt;span class="kt">u64&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cache&lt;/span>: &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&amp;amp;&lt;/span>&lt;span class="n">Bound&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">PyDict&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">PyResult&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u64&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cache_map&lt;/span>: &lt;span class="nc">HashMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u64&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">u64&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dict&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dict&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">extract&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u64&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">extract&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u64&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">collect&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">PyResult&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">None&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashMap&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">fib_inner&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>: &lt;span class="kt">u64&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cache&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u64&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">u64&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">u64&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fib_inner&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fib_inner&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fib_inner&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cache_map&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// æ›´æ–°æ¨¡å—å®šä¹‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="cp">#[pymodule]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">fibonacci_rs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">_py&lt;/span>: &lt;span class="nc">Python&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">m&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Bound&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">PyModule&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">PyResult&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">add_function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="fm">wrap_pyfunction!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fib_recursive&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">add_function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="fm">wrap_pyfunction!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fib_iterative&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">add_function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="fm">wrap_pyfunction!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fib_memoized&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(())&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>æµ‹è¯•ä»£ç &lt;/strong>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">fibonacci_rs&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æµ‹è¯•è®°å¿†åŒ–é€’å½’&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;fib_memoized(50) = &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">fibonacci_rs&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fib_memoized&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">50&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{})&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># è¾“å‡º: 12586269025&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>æ€§èƒ½æµ‹è¯•&lt;/strong>ï¼ˆn=50ï¼‰ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>å®žçŽ°æ–¹å¼&lt;/strong>&lt;/th>
&lt;th>&lt;strong>æ‰§è¡Œæ—¶é—´&lt;/strong>&lt;/th>
&lt;th>&lt;strong>ç»“æžœ&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Rust fib_memoized&lt;/td>
&lt;td>0.000042s&lt;/td>
&lt;td>12586269025&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Rust fib_recursive&lt;/td>
&lt;td>1.2345s&lt;/td>
&lt;td>12586269025&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Python fib_recursive&lt;/td>
&lt;td>78.321s&lt;/td>
&lt;td>12586269025&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;strong>ä¼˜åŒ–æ•ˆæžœ&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>è®°å¿†åŒ–é€’å½’å°†æ—¶é—´å¤æ‚åº¦ä»Ž O(2^n) é™è‡³ O(n)ï¼Œæ€§èƒ½æå‡æ•°åƒå€ã€‚&lt;/li>
&lt;li>ç¼“å­˜é€šè¿‡ Python å­—å…¸ä¼ é€’ï¼Œä¿æŒæŽ¥å£çµæ´»æ€§ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="-å‘å¸ƒåˆ°-pypi">ðŸ“¦ å‘å¸ƒåˆ° PyPI
&lt;/h2>&lt;ol>
&lt;li>&lt;strong>æž„å»º wheel æ–‡ä»¶&lt;/strong>ï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">maturin build --release
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>&lt;strong>å‘å¸ƒåˆ° PyPI&lt;/strong>ï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">maturin publish --username &amp;lt;your-pypi-username&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>æ³¨æ„&lt;/strong>ï¼šç¡®ä¿æœ‰ PyPI è´¦æˆ·å’Œ API tokenï¼Œ&lt;code>wheel&lt;/code> æ–‡ä»¶ä¼šè‡ªåŠ¨é€‚é…å¤šå¹³å°ï¼ˆå¦‚ Linuxã€macOSã€Windowsï¼‰ã€‚&lt;/p>
&lt;h2 id="-æœ€ä½³å®žè·µä¸Žæ³¨æ„äº‹é¡¹">ðŸ›¡ï¸ æœ€ä½³å®žè·µä¸Žæ³¨æ„äº‹é¡¹
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>&lt;strong>é€‰æ‹©åˆé€‚çš„åœºæ™¯&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ Rust ä¼˜åŒ–è®¡ç®—å¯†é›†åž‹ä»»åŠ¡ï¼ˆå¦‚æ•°å€¼è®¡ç®—ã€åŠ å¯†ï¼‰ã€‚&lt;/li>
&lt;li>å¯¹äºŽ I/O å¯†é›†åž‹ä»»åŠ¡ï¼ŒPython åŽŸç”Ÿå®žçŽ°å¯èƒ½æ›´ç®€å•ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>é”™è¯¯å¤„ç†&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ &lt;code>PyResult&lt;/code> ç¡®ä¿ Rust é”™è¯¯è½¬æ¢ä¸º Python å¼‚å¸¸ã€‚&lt;/li>
&lt;li>éªŒè¯è¾“å…¥å‚æ•°ï¼ˆå¦‚ &lt;code>n&lt;/code> éžè´Ÿï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ€§èƒ½ä¼˜åŒ–&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¼˜å…ˆä½¿ç”¨è¿­ä»£å®žçŽ°ï¼Œé¿å…é€’å½’æ ˆæº¢å‡ºã€‚&lt;/li>
&lt;li>å¯¹äºŽå¤§æ•°è®¡ç®—ï¼Œé›†æˆ &lt;code>num-bigint&lt;/code> æˆ– &lt;code>gmp&lt;/code>ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>è·¨å¹³å°æ”¯æŒ&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ &lt;code>maturin&lt;/code> çš„ &lt;code>--manylinux&lt;/code> é€‰é¡¹ç¡®ä¿ Linux å…¼å®¹æ€§ã€‚&lt;/li>
&lt;li>æµ‹è¯•å¤š Python ç‰ˆæœ¬ï¼ˆ3.7-3.12ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æµ‹è¯•ä¸Žè°ƒè¯•&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ç¼–å†™å•å…ƒæµ‹è¯•ï¼ˆå¦‚ &lt;code>pytest&lt;/code>ï¼‰ï¼Œè¦†ç›–è¾¹ç•Œæƒ…å†µï¼ˆå¦‚ &lt;code>n=0&lt;/code>, &lt;code>n=93&lt;/code>ï¼‰ã€‚&lt;/li>
&lt;li>ä½¿ç”¨ &lt;code>cargo test&lt;/code> æµ‹è¯• Rust é€»è¾‘ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h2 id="-æ€»ç»“">ðŸ§  æ€»ç»“
&lt;/h2>&lt;p>é€šè¿‡ &lt;code>PyO3&lt;/code> å’Œ &lt;code>maturin&lt;/code>ï¼Œæˆ‘ä»¬æˆåŠŸä½¿ç”¨ Rust æž„å»ºäº†ä¸€ä¸ªé«˜æ•ˆçš„ Python æ–æ³¢é‚£å¥‘è®¡ç®—åº“ &lt;code>fibonacci_rs&lt;/code>ï¼Œæä¾›äº†é€’å½’ã€è¿­ä»£å’Œè®°å¿†åŒ–ä¸‰ç§å®žçŽ°ã€‚æ€§èƒ½æµ‹è¯•è¡¨æ˜Žï¼ŒRust ç‰ˆæœ¬æ¯”çº¯ Python å®žçŽ°å¿« 4-60 å€ï¼Œç‰¹åˆ«é€‚åˆé«˜æ€§èƒ½è®¡ç®—åœºæ™¯ã€‚ç»“åˆè®°å¿†åŒ–ç­‰ä¼˜åŒ–ï¼ŒRust å¯ä»¥åœ¨ä¿æŒ Python ç”Ÿæ€ä¾¿åˆ©æ€§çš„åŒæ—¶ï¼Œæä¾›æŽ¥è¿‘ C çš„æ€§èƒ½ã€‚&lt;/p>
&lt;p>å¸Œæœ›æœ¬æ–‡çš„æ­¥éª¤å’Œæ¡ˆä¾‹èƒ½å¸®åŠ©ä½ åœ¨é¡¹ç›®ä¸­ç»“åˆ Rust å’Œ Pythonï¼Œæž„å»ºé«˜æ€§èƒ½çš„åŽŸç”Ÿæ‰©å±•åº“ï¼&lt;/p></description></item><item><title>å¦‚ä½•æž„å»ºä¸€ä¸ªæ”¯æŒåƒä¸‡çº§äº¤æ˜“é‡çš„æ•°æ®ä¸­å°ç³»ç»Ÿ</title><link>https://60ke.github.io/posts/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%94%AF%E6%8C%81%E5%8D%83%E4%B8%87%E7%BA%A7%E4%BA%A4%E6%98%93%E9%87%8F%E7%9A%84%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/</link><pubDate>Sat, 01 Jul 2023 15:11:47 +0800</pubDate><guid>https://60ke.github.io/posts/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%94%AF%E6%8C%81%E5%8D%83%E4%B8%87%E7%BA%A7%E4%BA%A4%E6%98%93%E9%87%8F%E7%9A%84%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/</guid><description>&lt;h1 id="å¦‚ä½•æž„å»ºä¸€ä¸ªæ”¯æŒåƒä¸‡çº§äº¤æ˜“é‡çš„æ•°æ®ä¸­å°ç³»ç»Ÿ">å¦‚ä½•æž„å»ºä¸€ä¸ªæ”¯æŒåƒä¸‡çº§äº¤æ˜“é‡çš„æ•°æ®ä¸­å°ç³»ç»Ÿ
&lt;/h1>&lt;blockquote>
&lt;p>éšç€ä¼ä¸šä¸šåŠ¡å¤æ‚åº¦å¢žé•¿ï¼Œäº¤æ˜“ã€è®¢å•ã€è´¦æˆ·ã€èµ„é‡‘ç­‰æ•°æ®æ¥æºæ—¥ç›Šå¤šæ ·åŒ–ï¼Œå¦‚ä½•é«˜æ•ˆæ±‡èšè¿™äº›é«˜é¢‘æ•°æ®ã€ç»Ÿä¸€å»ºæ¨¡ã€æ”¯æŒå¤šç»´æŸ¥è¯¢ï¼Œå¹¶åœ¨æ€§èƒ½ã€ä¸€è‡´æ€§ä¸Žæ‰©å±•æ€§ä¹‹é—´å–å¾—å¹³è¡¡ï¼Œæ˜¯æ•°æ®ä¸­å°è®¾è®¡çš„æ ¸å¿ƒæŒ‘æˆ˜ã€‚&lt;/p>
&lt;p>æœ¬æ–‡ç»“åˆå®žé™…é¡¹ç›®ç»éªŒï¼Œåˆ†äº«æˆ‘ä»¬å¦‚ä½•æž„å»ºä¸€ä¸ªæ”¯æŒ&lt;strong>åƒä¸‡çº§æ—¥äº¤æ˜“é‡&lt;/strong>çš„æ•°æ®ä¸­å°ç³»ç»Ÿï¼Œæ¶µç›–éœ€æ±‚åˆ†æžã€æŠ€æœ¯å®žçŽ°ã€ç®—æ³•ä¼˜åŒ–ã€æ€§èƒ½ä¼˜åŒ–ã€ç¨³å®šæ€§ä¿éšœã€æˆæœ¬æŽ§åˆ¶ä¸Žæœªæ¥æ¼”è¿›æ–¹å‘ï¼Œå¸Œæœ›ä¸ºè¯»è€…æä¾›å®žç”¨å‚è€ƒã€‚&lt;/p>&lt;/blockquote>
&lt;hr>
&lt;h2 id="-ä¸šåŠ¡éœ€æ±‚ä¸Žåœºæ™¯åˆ†æž">ðŸ’¡ ä¸šåŠ¡éœ€æ±‚ä¸Žåœºæ™¯åˆ†æž
&lt;/h2>&lt;p>åœ¨è®¾è®¡æ•°æ®ä¸­å°ä¹‹å‰ï¼Œæ˜Žç¡®ä¸šåŠ¡éœ€æ±‚å’Œåœºæ™¯è‡³å…³é‡è¦ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬é¡¹ç›®ä¸­é¢ä¸´çš„å…¸åž‹åœºæ™¯åŠå…¶æŠ€æœ¯è¦æ±‚ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>åœºæ™¯&lt;/strong>&lt;/th>
&lt;th>&lt;strong>éœ€æ±‚&lt;/strong>&lt;/th>
&lt;th>&lt;strong>æŠ€æœ¯æŒ‘æˆ˜&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;strong>é«˜é¢‘æ”¯ä»˜å¤„ç†&lt;/strong>&lt;/td>
&lt;td>äºšç§’çº§æŸ¥è¯¢å“åº”ï¼Œå¼ºä¸€è‡´æ€§&lt;/td>
&lt;td>é«˜å¹¶å‘å†™å…¥ï¼Œä½Žå»¶è¿ŸæŸ¥è¯¢&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>è´¢åŠ¡å¯¹è´¦&lt;/strong>&lt;/td>
&lt;td>å¼ºä¸€è‡´æ€§ï¼Œæ•°æ®å¯è¿½æº¯&lt;/td>
&lt;td>æ•°æ®å®Œæ•´æ€§ï¼Œå®¡è®¡æ—¥å¿—ç®¡ç†&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>è¿è¥çœ‹æ¿&lt;/strong>&lt;/td>
&lt;td>å¤šç»´åº¦èšåˆï¼Œæ”¯æŒåˆ†é’Ÿçº§åˆ·æ–°&lt;/td>
&lt;td>é«˜æ€§èƒ½ OLAP æŸ¥è¯¢ï¼Œç¼“å­˜ä¼˜åŒ–&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>è·¨å¢ƒç»“ç®—&lt;/strong>&lt;/td>
&lt;td>å¤šå¸ç§æ”¯æŒï¼Œå›½é™…åŒ–æ—¶é—´æ ¼å¼&lt;/td>
&lt;td>æ±‡çŽ‡è½¬æ¢ç²¾åº¦ï¼Œåˆè§„æ€§ï¼ˆå¦‚ GDPRï¼‰&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>é£ŽæŽ§åˆ†æž&lt;/strong>&lt;/td>
&lt;td>å®žæ—¶å¼‚å¸¸æ£€æµ‹ï¼Œç§’çº§å“åº”&lt;/td>
&lt;td>æµå¼è®¡ç®—ï¼Œå®žæ—¶æœºå™¨å­¦ä¹ æ”¯æŒ&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;strong>ä¼˜å…ˆçº§&lt;/strong>ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>å®žæ—¶æ€§&lt;/strong>ï¼šæ”¯ä»˜å’Œé£ŽæŽ§åœºæ™¯è¦æ±‚äºšç§’çº§å“åº”ã€‚&lt;/li>
&lt;li>&lt;strong>ä¸€è‡´æ€§&lt;/strong>ï¼šè´¢åŠ¡å¯¹è´¦è¦æ±‚å¼ºä¸€è‡´æ€§ï¼Œè¿è¥çœ‹æ¿å¯æŽ¥å—æœ€ç»ˆä¸€è‡´æ€§ã€‚&lt;/li>
&lt;li>&lt;strong>æ‰©å±•æ€§&lt;/strong>ï¼šæ”¯æŒæ•°æ®é‡å¢žé•¿ï¼ˆå¦‚äº¿çº§äº¤æ˜“ï¼‰å’Œæ–°åœºæ™¯ï¼ˆå¦‚å¤šäº‘éƒ¨ç½²ï¼‰ã€‚&lt;/li>
&lt;/ol>
&lt;p>è¿™äº›éœ€æ±‚å†³å®šäº†æ•°æ®ä¸­å°éœ€è¦åŒæ—¶æ”¯æŒå®žæ—¶ä¸Žç¦»çº¿è®¡ç®—ã€å¼ºä¸€è‡´æ€§ä¸Žé«˜æ€§èƒ½æŸ¥è¯¢ï¼Œå¹¶å…·å¤‡è‰¯å¥½çš„æ‰©å±•æ€§å’Œåˆè§„æ€§ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®ä¸­å°">ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®ä¸­å°ï¼Ÿ
&lt;/h2>&lt;p>åœ¨ä¸€ä¸ªå…¸åž‹çš„å¤§åž‹ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œäº¤æ˜“æ•°æ®åˆ†æ•£åœ¨å¤šä¸ªç³»ç»Ÿæˆ–å¾®æœåŠ¡ä¸­ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ç”¨æˆ·ä¸‹å•&lt;/strong>ï¼šå­˜å‚¨åœ¨ç”µå•†ç³»ç»Ÿï¼›&lt;/li>
&lt;li>&lt;strong>æ”¯ä»˜è®°å½•&lt;/strong>ï¼šç”±æ”¯ä»˜ç½‘å…³æœåŠ¡ç®¡ç†ï¼›&lt;/li>
&lt;li>&lt;strong>ç»“ç®—æ•°æ®&lt;/strong>ï¼šå½’å±žèµ„é‡‘ç³»ç»Ÿï¼›&lt;/li>
&lt;li>&lt;strong>é€€æ¬¾è®°å½•&lt;/strong>ï¼šç”±å”®åŽç³»ç»Ÿå¤„ç†ã€‚&lt;/li>
&lt;/ul>
&lt;p>å¦‚æžœå„ä¸šåŠ¡å›¢é˜Ÿç‹¬ç«‹é‡‡é›†ã€å­˜å‚¨å’Œè®¡ç®—æ•°æ®ï¼Œä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>é‡å¤å¼€å‘&lt;/strong>ï¼šä¸åŒå›¢é˜Ÿé‡å¤å®žçŽ°æ•°æ®å¤„ç†é€»è¾‘ï¼Œèµ„æºæµªè´¹ï¼›&lt;/li>
&lt;li>&lt;strong>å£å¾„ä¸ä¸€è‡´&lt;/strong>ï¼šåŒä¸€æŒ‡æ ‡å®šä¹‰ä¸åŒï¼Œå¯¼è‡´æ•°æ®å†²çªï¼›&lt;/li>
&lt;li>&lt;strong>æŸ¥è¯¢æ€§èƒ½å·®&lt;/strong>ï¼šåˆ†æ•£æ•°æ®éš¾ä»¥é«˜æ•ˆæ•´åˆï¼ŒæŸ¥è¯¢å“åº”æ…¢ï¼›&lt;/li>
&lt;li>&lt;strong>æ•°æ®æ··ä¹±&lt;/strong>ï¼šç¼ºä¹ç»Ÿä¸€ç®¡ç†ï¼Œå®Œæ•´æ€§å’Œä¸€è‡´æ€§éš¾ä»¥ä¿éšœã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>æ•°æ®ä¸­å°çš„æ ¸å¿ƒä»·å€¼&lt;/strong>åœ¨äºŽï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>å¤šæºæ•°æ®ç»Ÿä¸€&lt;/strong>ï¼šæ±‡èšåˆ†æ•£çš„äº¤æ˜“æ•°æ®ï¼›&lt;/li>
&lt;li>&lt;strong>æ ‡å‡†åŒ–å»ºæ¨¡&lt;/strong>ï¼šæä¾›ä¸€è‡´çš„æ•°æ®å®šä¹‰å’Œç»“æž„ï¼›&lt;/li>
&lt;li>&lt;strong>æ··åˆè®¡ç®—&lt;/strong>ï¼šæ”¯æŒå®žæ—¶æŸ¥è¯¢å’Œç¦»çº¿åˆ†æžï¼›&lt;/li>
&lt;li>&lt;strong>ä¸šåŠ¡èµ‹èƒ½&lt;/strong>ï¼šæ»¡è¶³è´¦åŠ¡åˆ†æžã€èµ„é‡‘è¿½è¸ªã€æŠ¥è¡¨ç”Ÿæˆã€å®¡è®¡å›žæŸ¥ç­‰å¤šåœºæ™¯éœ€æ±‚ã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="-ç³»ç»Ÿæ€»ä½“æž¶æž„è®¾è®¡">ðŸ§± ç³»ç»Ÿæ€»ä½“æž¶æž„è®¾è®¡
&lt;/h2>&lt;p>ä»¥ä¸‹æ˜¯æ•°æ®ä¸­å°çš„æž¶æž„ç¤ºæ„å›¾ï¼Œå±•ç¤ºæ•°æ®æµè½¬å’Œæ¨¡å—åä½œï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">flowchart TD
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> A[äº¤æ˜“ç³»ç»Ÿ] --&amp;gt;|Kafka| B[æ•°æ®é‡‡é›†å±‚]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> C[æ”¯ä»˜ç³»ç»Ÿ] --&amp;gt;|Kafka| B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> D[é€€æ¬¾ç³»ç»Ÿ] --&amp;gt;|HTTP API| B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> E[ç»“ç®—ç³»ç»Ÿ] --&amp;gt;|Binlog| B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> B --&amp;gt; F[æ•°æ®å¤„ç†å±‚]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> F --&amp;gt; G[æ ‡å‡†åŒ–äº¤æ˜“æ¨¡åž‹]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> F --&amp;gt; H[èšåˆæŒ‡æ ‡è®¡ç®—]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> F --&amp;gt; I[å¼‚å¸¸æ•°æ®ä¿®å¤]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> G --&amp;gt; J[MySQL åˆ†åº“åˆ†è¡¨]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> H --&amp;gt; K[ClickHouse åˆ†å¸ƒå¼é›†ç¾¤]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> I --&amp;gt; L[å®¡è®¡æ—¥å¿—è¡¨]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> subgraph å­˜å‚¨å±‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> J
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> K
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> L
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> M[Redis é›†ç¾¤]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> J --&amp;gt; N[æŽ¥å£æœåŠ¡å±‚]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> K --&amp;gt; N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> L --&amp;gt; N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> M --&amp;gt; N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> N --&amp;gt; O1[æŠ¥è¡¨æŸ¥è¯¢ API]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> N --&amp;gt; O2[èµ„é‡‘è¿½è¸ª API]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> N --&amp;gt; O3[è¿è¥çœ‹æ¿ API]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> N --&amp;gt; P[å¤šç§Ÿæˆ·æƒé™æ ¡éªŒæ¨¡å—]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> subgraph è¿ç»´ç›‘æŽ§
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Q[ä»»åŠ¡è°ƒåº¦ä¸­å¿ƒ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> R[Prometheus + Grafana]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> S[æ•…éšœæ¢å¤ä¸Žå‘Šè­¦]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> F --&amp;gt; Q
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> N --&amp;gt; R
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Q --&amp;gt; S
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ä¸»è¦æ¨¡å—è¯´æ˜Ž">ä¸»è¦æ¨¡å—è¯´æ˜Ž
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>æ¨¡å—&lt;/strong>&lt;/th>
&lt;th>&lt;strong>ä½œç”¨&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;strong>æ•°æ®é‡‡é›†å±‚&lt;/strong>&lt;/td>
&lt;td>é€šè¿‡ Kafkaã€Binlogã€HTTP ç­‰æ–¹å¼ä»Žå¤šç³»ç»Ÿé‡‡é›†æ•°æ®&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>æ•°æ®å¤„ç†å±‚&lt;/strong>&lt;/td>
&lt;td>è´Ÿè´£æ ‡å‡†åŒ–å»ºæ¨¡ã€èšåˆè®¡ç®—ã€å¼‚å¸¸æ•°æ®ä¿®æ­£&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>å­˜å‚¨å±‚&lt;/strong>&lt;/td>
&lt;td>MySQL åˆ†åº“åˆ†è¡¨ + ClickHouse åˆ†å¸ƒå¼é›†ç¾¤ + Redis é›†ç¾¤&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>æŽ¥å£æœåŠ¡å±‚&lt;/strong>&lt;/td>
&lt;td>æä¾› REST / gRPC æŽ¥å£ï¼Œä¾›ä¸šåŠ¡ç³»ç»ŸæŸ¥è¯¢&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>ä»»åŠ¡è°ƒåº¦å±‚&lt;/strong>&lt;/td>
&lt;td>æ”¯æŒ T+0ã€T+1 æŠ¥è¡¨ç”Ÿæˆã€æ•°æ®å¯¹è´¦å’Œå¼‚å¸¸å¤„ç†ä»»åŠ¡&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;hr>
&lt;h2 id="-å…³é”®æŠ€æœ¯å®žçŽ°ç»†èŠ‚">ðŸ”§ å…³é”®æŠ€æœ¯å®žçŽ°ç»†èŠ‚
&lt;/h2>&lt;h3 id="1-å¤šæºäº¤æ˜“æ•°æ®æŽ¥å…¥">1ï¸âƒ£ å¤šæºäº¤æ˜“æ•°æ®æŽ¥å…¥
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>Kafka ä¸»é€šé“&lt;/strong>ï¼šå„ç³»ç»Ÿé€šè¿‡ Kafka çš„ &lt;code>trade-topic&lt;/code> æŠ•é€’äº‹ä»¶ï¼Œå•åˆ†åŒºæ”¯æŒé«˜åžåé‡ï¼ˆ&amp;gt;10ä¸‡ QPSï¼‰ã€‚ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åˆ†é…åˆ†åŒºé”®ï¼ˆåŸºäºŽ &lt;code>user_id&lt;/code>ï¼‰ï¼Œç¡®ä¿æ•°æ®å‡åŒ€åˆ†å¸ƒï¼Œé˜²æ­¢çƒ­ç‚¹åˆ†åŒºã€‚&lt;/li>
&lt;li>&lt;strong>è¡¥å……æ–¹å¼&lt;/strong>ï¼šç¬¬ä¸‰æ–¹ç»“ç®—å¹³å°æ•°æ®é€šè¿‡ Airflow è°ƒåº¦çš„å®šæ—¶ä»»åŠ¡æ‹‰å–ï¼Œæˆ–é€šè¿‡ HTTP API å¼‚æ­¥å¯¹æŽ¥ã€‚&lt;/li>
&lt;li>&lt;strong>ä¸€è‡´æ€§ä¿éšœ&lt;/strong>ï¼šKafka æ¶ˆè´¹è€…ä½¿ç”¨äº‹åŠ¡æäº¤ï¼Œç¡®ä¿æ¶ˆæ¯æ¶ˆè´¹å¹‚ç­‰æ€§ï¼›å¯¹äºŽ Binlogï¼Œé‡‡ç”¨ Canal è§£æž MySQL æ—¥å¿—ï¼Œç»“åˆæ—¶é—´æˆ³æŽ’åºç®—æ³•ï¼ˆåŸºäºŽäº‹ä»¶æ—¶é—´ï¼‰ç¡®ä¿æ•°æ®é¡ºåºä¸€è‡´ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ç®—æ³•ä¼˜åŒ–&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ä¸€è‡´æ€§å“ˆå¸Œ&lt;/strong>ï¼šåœ¨ Kafka åˆ†åŒºåˆ†é…ä¸­ï¼Œä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å‡å°‘æ•°æ®è¿ç§»æˆæœ¬ï¼Œæ”¯æŒåŠ¨æ€æ‰©å®¹ï¼ˆä»Ž 16 åˆ†åŒºæ‰©å±•åˆ° 64 åˆ†åŒºï¼‰ã€‚&lt;/li>
&lt;li>&lt;strong>å¸ƒéš†è¿‡æ»¤å™¨&lt;/strong>ï¼šåœ¨æ¶ˆè´¹è€…ç«¯ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨å¿«é€Ÿæ£€æµ‹é‡å¤æ¶ˆæ¯ï¼Œé™ä½Žé‡å¤å¤„ç†æ¦‚çŽ‡ï¼ˆè¯¯åˆ¤çŽ‡ &amp;lt; 0.01%ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="2-æ ‡å‡†åŒ–äº¤æ˜“å»ºæ¨¡">2ï¸âƒ£ æ ‡å‡†åŒ–äº¤æ˜“å»ºæ¨¡
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>ç»Ÿä¸€æ¨¡åž‹&lt;/strong>ï¼šå°†è®¢å•ã€é€€æ¬¾ã€è½¬è´¦ç­‰äº¤æ˜“ç±»åž‹æ˜ å°„ä¸ºâ€œäº¤æ˜“äº‹ä»¶ + è´¦æˆ·å˜åŒ–â€æ¨¡åž‹ï¼Œæ ¸å¿ƒå­—æ®µåŒ…æ‹¬ï¼š
&lt;ul>
&lt;li>äº¤æ˜“ IDï¼ˆå…¨å±€å”¯ä¸€ï¼ŒUUID v4 ç”Ÿæˆï¼‰&lt;/li>
&lt;li>è´¦æˆ· ID&lt;/li>
&lt;li>äº¤æ˜“æ—¶é—´ï¼ˆæ”¯æŒ UTC å’Œæœ¬åœ°åŒ–æ ¼å¼ï¼‰&lt;/li>
&lt;li>äº¤æ˜“é‡‘é¢ï¼ˆæ”¯æŒå¤šå¸ç§ï¼Œç²¾åº¦åˆ° 6 ä½å°æ•°ï¼‰&lt;/li>
&lt;li>äº¤æ˜“æ–¹å‘ï¼ˆæ”¶å…¥/æ”¯å‡ºï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>å›½é™…åŒ–æ”¯æŒ&lt;/strong>ï¼šé‡‘é¢å­—æ®µå­˜å‚¨åŽŸå§‹å¸ç§å’Œæ±‡çŽ‡æ¢ç®—åŽçš„ç»Ÿä¸€å¸ç§ï¼ˆå¦‚ USDï¼‰ï¼›æ—¶é—´å­—æ®µæ”¯æŒå¤šæ—¶åŒºæ ¼å¼ï¼Œé‡‡ç”¨ ISO 8601 æ ‡å‡†ã€‚&lt;/li>
&lt;li>&lt;strong>åˆè§„æ€§&lt;/strong>ï¼šæ•æ„Ÿå­—æ®µï¼ˆå¦‚è´¦æˆ· IDï¼‰ä½¿ç”¨ AES-256 åŠ å¯†å­˜å‚¨ï¼Œå®¡è®¡æ—¥å¿—ä¿ç•™ 7 å¹´ï¼Œç¬¦åˆ GDPR å’Œé‡‘èžç›‘ç®¡è¦æ±‚ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="3-æ•°æ®æ¸…æ´—ä¸Žåˆå¹¶ç­–ç•¥">3ï¸âƒ£ æ•°æ®æ¸…æ´—ä¸Žåˆå¹¶ç­–ç•¥
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>äº‹ä»¶æ—¶é—´æŽ’åº&lt;/strong>ï¼šä»¥äº‹ä»¶æ—¶é—´ä¸ºä¸»è½´ï¼Œä½¿ç”¨å½’å¹¶æŽ’åºç®—æ³•ï¼ˆMerge Sortï¼‰åˆå¹¶å¤šæºæ•°æ®æµï¼Œç¡®ä¿èµ„é‡‘æµè½¬é“¾æ¡çš„é€»è¾‘ä¸€è‡´æ€§ï¼Œæ—¶é—´å¤æ‚åº¦ O(n log n)ã€‚&lt;/li>
&lt;li>&lt;strong>å¼‚å¸¸å¤„ç†&lt;/strong>ï¼šé‡‘é¢ç¼ºå¤±ã€é‡å¤äº¤æ˜“ç­‰å¼‚å¸¸æ•°æ®è¿›å…¥å®¡è®¡è¡¨ã€‚é‡‡ç”¨åŸºäºŽè§„åˆ™çš„å¼‚å¸¸æ£€æµ‹ç®—æ³•ï¼ˆç»“åˆé˜ˆå€¼å’Œæ¨¡å¼åŒ¹é…ï¼‰è¯†åˆ«é—®é¢˜æ•°æ®ï¼Œæ”¯æŒäººå·¥ä¿®æ­£æˆ–è‡ªåŠ¨å›žè¡¥ï¼ˆåŸºäºŽ Saga æ¨¡å¼ï¼‰ã€‚&lt;/li>
&lt;li>&lt;strong>èšåˆæ”¯æŒ&lt;/strong>ï¼šç”ŸæˆæŒ‰å¤©ã€æŒ‰æœˆã€æŒ‰è´¦æˆ·ç»´åº¦çš„èšåˆè¡¨ï¼Œå­˜å‚¨åœ¨ ClickHouseï¼Œä½¿ç”¨ HyperLogLog ç®—æ³•è¿›è¡Œè¿‘ä¼¼è®¡æ•°ï¼Œå‡å°‘å­˜å‚¨å’Œè®¡ç®—å¼€é”€ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ç®—æ³•ä¼˜åŒ–&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>HyperLogLog&lt;/strong>ï¼šåœ¨èšåˆè®¡ç®—ä¸­ï¼Œä½¿ç”¨ HyperLogLog ç®—æ³•ä¼°ç®—å”¯ä¸€äº¤æ˜“æ•°ï¼Œè¯¯å·® &amp;lt; 1%ï¼Œå†…å­˜å ç”¨é™ä½Ž 80%ã€‚&lt;/li>
&lt;li>&lt;strong>æ»‘åŠ¨çª—å£&lt;/strong>ï¼šå¯¹äºŽå®žæ—¶å¼‚å¸¸æ£€æµ‹ï¼Œä½¿ç”¨æ»‘åŠ¨çª—å£ç®—æ³•ï¼ˆæ—¶é—´çª—å£ 5 åˆ†é’Ÿï¼‰åˆ†æžé«˜é¢‘äº¤æ˜“è¡Œä¸ºï¼Œé™ä½Žè¯¯æŠ¥çŽ‡ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="4-åˆ†åº“åˆ†è¡¨ä¸Žæ‰©å±•æ€§">4ï¸âƒ£ åˆ†åº“åˆ†è¡¨ä¸Žæ‰©å±•æ€§
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>åˆ†è¡¨è§„åˆ™&lt;/strong>ï¼šä¸»äº¤æ˜“è¡¨æŒ‰ &lt;code>user_id % 256&lt;/code> åˆ†è¡¨ï¼Œä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ”¯æŒåŠ¨æ€æ‰©å®¹ï¼Œå‡å°‘æ•°æ®è¿ç§»æˆæœ¬ã€‚&lt;/li>
&lt;li>&lt;strong>ç´¢å¼•ä¼˜åŒ–&lt;/strong>ï¼šå»ºç«‹è”åˆç´¢å¼•ï¼ˆ&lt;code>user_id + äº¤æ˜“æ—¶é—´&lt;/code>ï¼‰ï¼Œé‡‡ç”¨ B+ æ ‘ç´¢å¼•ç»“æž„ï¼Œæ”¯æŒé«˜æ•ˆåˆ†é¡µå’Œè·³é¡µæŸ¥è¯¢ã€‚&lt;/li>
&lt;li>&lt;strong>æ‰©å±•æ€§è®¾è®¡&lt;/strong>ï¼š
&lt;ul>
&lt;li>MySQLï¼šé€šè¿‡ ProxySQL å®žçŽ°è¯»å†™åˆ†ç¦»ï¼Œæ”¯æŒåŠ¨æ€æ–°å¢žåˆ†ç‰‡ã€‚&lt;/li>
&lt;li>ClickHouseï¼šé‡‡ç”¨åˆ†å¸ƒå¼é›†ç¾¤ï¼ˆ3 åˆ†ç‰‡ + 2 å‰¯æœ¬ï¼‰ï¼Œæ”¯æŒäº¿çº§æ•°æ®é‡ã€‚&lt;/li>
&lt;li>Redisï¼šä½¿ç”¨é›†ç¾¤æ¨¡å¼ï¼Œè‡ªåŠ¨åˆ†ç‰‡ï¼Œé˜²æ­¢å•ç‚¹ç“¶é¢ˆã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ç®—æ³•ä¼˜åŒ–&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ä¸€è‡´æ€§å“ˆå¸Œ&lt;/strong>ï¼šåˆ†åº“åˆ†è¡¨åŠ¨æ€æ‰©å®¹æ—¶ï¼Œä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æœ€å°åŒ–æ•°æ®è¿ç§»ï¼Œè¿ç§»é‡ä»Žå…¨é‡è¿ç§»é™è‡³ &amp;lt; 10%ã€‚&lt;/li>
&lt;li>&lt;strong>å‰ç¼€ç´¢å¼•&lt;/strong>ï¼šåœ¨ MySQL è”åˆç´¢å¼•ä¸­ï¼Œé’ˆå¯¹é«˜é€‰æ‹©æ€§å­—æ®µï¼ˆå¦‚ &lt;code>user_id&lt;/code>ï¼‰ä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼Œå‡å°‘ç´¢å¼•å­˜å‚¨ç©ºé—´ 30%ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="5-ç¼“å­˜ä¸Žå»¶è¿Ÿèšåˆ">5ï¸âƒ£ ç¼“å­˜ä¸Žå»¶è¿Ÿèšåˆ
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>ç¼“å­˜è®¾è®¡&lt;/strong>ï¼šé«˜é¢‘æŸ¥è¯¢ï¼ˆå¦‚è´¦æˆ·ä½™é¢ã€æœ€è¿‘ 30 å¤©æµæ°´ï¼‰å­˜å‚¨åœ¨ Redis é›†ç¾¤ï¼ˆHash ç»“æž„ï¼‰ï¼ŒTTL è®¾ç½®ä¸º 24 å°æ—¶ã€‚ä½¿ç”¨ LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ç®—æ³•ç®¡ç†ç¼“å­˜æ·˜æ±°ã€‚&lt;/li>
&lt;li>&lt;strong>èšåˆè°ƒåº¦&lt;/strong>ï¼šT+0 æ•°æ®æ¯å°æ—¶æ›´æ–°ï¼ŒT+1 æ•°æ®æ¬¡æ—¥å…¨é‡åˆ·æ–°ï¼Œä½¿ç”¨ Airflow è°ƒåº¦ç¦»çº¿ä»»åŠ¡ã€‚èšåˆè®¡ç®—é‡‡ç”¨ MapReduce æ¨¡åž‹ï¼Œåˆ†å¸ƒå¼å¤„ç†å¤šç»´åº¦ç»Ÿè®¡ã€‚&lt;/li>
&lt;li>&lt;strong>ç»“æžœå­˜å‚¨&lt;/strong>ï¼šå¤šç»´èšåˆç»“æžœå†™å…¥ ClickHouseï¼Œæ”¯æŒ BI çœ‹æ¿å’ŒæŠ¥è¡¨å¯¼å‡ºï¼ˆCSV/Excelï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ç®—æ³•ä¼˜åŒ–&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>LRU ç¼“å­˜&lt;/strong>ï¼šRedis ä½¿ç”¨ LRU ç®—æ³•ç®¡ç†ç¼“å­˜ï¼Œå‘½ä¸­çŽ‡æå‡è‡³ 95%ï¼Œå‡å°‘æ•°æ®åº“åŽ‹åŠ›ã€‚&lt;/li>
&lt;li>&lt;strong>è¿‘ä¼¼èšåˆ&lt;/strong>ï¼šåœ¨ ClickHouse ä¸­ï¼Œä½¿ç”¨ HyperLogLog å’Œ QuantileTDigest ç®—æ³•è¿›è¡Œè¿‘ä¼¼èšåˆï¼Œè®¡ç®—é€Ÿåº¦æå‡ 3 å€ï¼Œå­˜å‚¨ç©ºé—´èŠ‚çœ 50%ã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="-æ€§èƒ½ä¼˜åŒ–å®žè·µ">âš™ï¸ æ€§èƒ½ä¼˜åŒ–å®žè·µ
&lt;/h2>&lt;p>é’ˆå¯¹åƒä¸‡çº§äº¤æ˜“é‡çš„æ€§èƒ½æŒ‘æˆ˜ï¼Œæˆ‘ä»¬å®žæ–½äº†ä»¥ä¸‹ä¼˜åŒ–ï¼Œç»“åˆå…·ä½“ç®—æ³•æå‡æ•ˆçŽ‡ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>é—®é¢˜&lt;/strong>&lt;/th>
&lt;th>&lt;strong>è§£å†³æ–¹æ¡ˆ&lt;/strong>&lt;/th>
&lt;th>&lt;strong>ç®—æ³•/ä¼˜åŒ–&lt;/strong>&lt;/th>
&lt;th>&lt;strong>æ•ˆæžœ&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;strong>ä¸»è¡¨æ•°æ®é‡å¤§ï¼Œæ…¢ SQL å¤š&lt;/strong>&lt;/td>
&lt;td>åˆ†åŒºè¡¨ + è”åˆç´¢å¼• + æŸ¥è¯¢é‡å†™ï¼ˆå¦‚å€’æŽ’é¡µï¼‰&lt;/td>
&lt;td>B+ æ ‘ç´¢å¼• + æŸ¥è¯¢ä¼˜åŒ–å™¨&lt;/td>
&lt;td>æŸ¥è¯¢å“åº”ä»Ž 10s é™è‡³ 1s ä»¥å†…&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>åŒä¸€è´¦å·é«˜é¢‘è®¿é—®&lt;/strong>&lt;/td>
&lt;td>Redis é›†ç¾¤ç¼“å­˜ï¼ˆHash ç»“æž„ï¼‰ + ç¼“å­˜é¢„çƒ­&lt;/td>
&lt;td>LRU ç®—æ³• + å¸ƒéš†è¿‡æ»¤å™¨&lt;/td>
&lt;td>ç¼“å­˜å‘½ä¸­çŽ‡ &amp;gt; 95%&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>å¤šç§Ÿæˆ·æƒé™åˆ‡æ¢&lt;/strong>&lt;/td>
&lt;td>ç§Ÿæˆ· ID ä¸‹æŽ¨åˆ° SQL + RBAC æƒé™æ ¡éªŒ&lt;/td>
&lt;td>å“ˆå¸Œè¡¨æƒé™æ ¡éªŒ&lt;/td>
&lt;td>æ•°æ®éš”ç¦»ï¼Œå“åº”æ—¶é—´ &amp;lt; 150ms&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>èšåˆä»»åŠ¡å½±å“åœ¨çº¿æŸ¥è¯¢&lt;/strong>&lt;/td>
&lt;td>ç¦»çº¿ä»»åŠ¡ä¼˜å…ˆçº§éš”ç¦» + å¼‚æ­¥ä»»åŠ¡é“¾ï¼ˆAirflowï¼‰&lt;/td>
&lt;td>MapReduce åˆ†å¸ƒå¼è®¡ç®—&lt;/td>
&lt;td>åœ¨çº¿æŸ¥è¯¢ç¨³å®šï¼Œå»¶è¿Ÿ &amp;lt; 150ms&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>å¼‚å¸¸äº¤æ˜“æ£€æµ‹å»¶è¿Ÿ&lt;/strong>&lt;/td>
&lt;td>å®žæ—¶æµå¼å¤„ç†ï¼ˆFlinkï¼‰ + æ»‘åŠ¨çª—å£å¼‚å¸¸æ£€æµ‹&lt;/td>
&lt;td>æ»‘åŠ¨çª—å£ + åŸºäºŽè§„åˆ™çš„å¼‚å¸¸æ£€æµ‹ â„“&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;strong>æ€§èƒ½æˆæžœ&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>æ—¥äº¤æ˜“å¤„ç†èƒ½åŠ›&lt;/strong>ï¼š&amp;gt; 1.2 äº¿æ¡ï¼Œå†™å…¥å»¶è¿Ÿ 3~5 ç§’ã€‚&lt;/li>
&lt;li>&lt;strong>æŸ¥è¯¢æ€§èƒ½&lt;/strong>ï¼šæŽ¥å£å¹³å‡å“åº”æ—¶é—´ &amp;lt; 150msï¼Œ95% è¯·æ±‚å‘½ä¸­ç¼“å­˜ã€‚&lt;/li>
&lt;li>&lt;strong>å¼‚å¸¸æ£€æµ‹&lt;/strong>ï¼šå®žæ—¶é£ŽæŽ§åœºæ™¯ä¸‹ï¼Œå¼‚å¸¸äº¤æ˜“æ£€æµ‹å»¶è¿Ÿ &amp;lt; 1 ç§’ï¼Œè¯¯æŠ¥çŽ‡ &amp;lt; 0.5%ã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="-ç¨³å®šæ€§ä¸Žå®‰å…¨ä¿éšœ">ðŸ” ç¨³å®šæ€§ä¸Žå®‰å…¨ä¿éšœ
&lt;/h2>&lt;h3 id="ç¨³å®šæ€§ä¿éšœ">ç¨³å®šæ€§ä¿éšœ
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>ä»»åŠ¡ç›‘æŽ§&lt;/strong>ï¼šETL å’Œèšåˆä»»åŠ¡ç”± Airflow è°ƒåº¦ï¼Œç›‘æŽ§æ‰§è¡Œæ—¶é—´ã€æˆåŠŸçŽ‡ï¼Œå¼‚å¸¸è§¦å‘å‘Šè­¦ã€‚&lt;/li>
&lt;li>&lt;strong>é“¾è·¯ç›‘æŽ§&lt;/strong>ï¼šPrometheus + Grafana è¦†ç›–æ•°æ®é‡‡é›†ã€å¤„ç†ã€å­˜å‚¨ã€æŸ¥è¯¢å…¨é“¾è·¯ï¼Œå®žæ—¶ç›‘æŽ§ QPSã€å»¶è¿Ÿã€é”™è¯¯çŽ‡ã€‚&lt;/li>
&lt;li>&lt;strong>æ•…éšœæ¢å¤&lt;/strong>ï¼š
&lt;ul>
&lt;li>MySQL ä¸»ä»Žåˆ‡æ¢ï¼ˆ&amp;lt; 30 ç§’ï¼‰ï¼Œæ”¯æŒè·¨åŒºåŸŸå®¹ç¾ã€‚&lt;/li>
&lt;li>Kafka å’Œ ClickHouse å‰¯æœ¬æœºåˆ¶ï¼Œç¡®ä¿æ•°æ®é«˜å¯ç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>SLA ä¿éšœ&lt;/strong>ï¼šç³»ç»Ÿå¯ç”¨æ€§è¾¾ 99.99%ï¼ŒæŸ¥è¯¢å“åº”æ—¶é—´ç›®æ ‡ &amp;lt; 200msã€‚&lt;/li>
&lt;li>&lt;strong>æµé‡å³°å€¼åº”å¯¹&lt;/strong>ï¼šé€šè¿‡ Nginx é™æµã€ç†”æ–­æœºåˆ¶å’Œé™çº§ç­–ç•¥ï¼ˆå¦‚åªè¯»ç¼“å­˜ï¼‰ï¼Œåº”å¯¹çªå‘æµé‡ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="å®‰å…¨æ€§è®¾è®¡">å®‰å…¨æ€§è®¾è®¡
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>æƒé™æŽ§åˆ¶&lt;/strong>ï¼šåŸºäºŽ RBAC æ¨¡åž‹ï¼Œç§Ÿæˆ· ID ä¸‹æŽ¨åˆ° SQL å±‚ï¼Œä½¿ç”¨å“ˆå¸Œè¡¨å¿«é€Ÿæ ¡éªŒæƒé™ï¼Œé˜²æ­¢è¶Šæƒè®¿é—®ã€‚&lt;/li>
&lt;li>&lt;strong>æ•°æ®åŠ å¯†&lt;/strong>ï¼šæ•æ„Ÿæ•°æ®ï¼ˆå¦‚è´¦æˆ· IDã€é‡‘é¢ï¼‰ä½¿ç”¨ AES-256 åŠ å¯†å­˜å‚¨ã€‚&lt;/li>
&lt;li>&lt;strong>åˆè§„æ€§&lt;/strong>ï¼šå®¡è®¡æ—¥å¿—ä¿ç•™ 7 å¹´ï¼Œæ»¡è¶³ GDPR å’Œé‡‘èžç›‘ç®¡è¦æ±‚ï¼›æ”¯æŒæ•°æ®åŒ¿ååŒ–å¤„ç†ã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="-æˆæœ¬ä¼˜åŒ–">ðŸ’° æˆæœ¬ä¼˜åŒ–
&lt;/h2>&lt;p>ä¸ºå¹³è¡¡æ€§èƒ½ä¸Žæˆæœ¬ï¼Œæˆ‘ä»¬é‡‡å–ä»¥ä¸‹æŽªæ–½ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>å†·çƒ­åˆ†ç¦»&lt;/strong>ï¼š
&lt;ul>
&lt;li>çƒ­æ•°æ®ï¼ˆæœ€è¿‘ 30 å¤©ï¼‰ï¼šå­˜ Redis å’Œ ClickHouseã€‚&lt;/li>
&lt;li>æ¸©æ•°æ®ï¼ˆ1 å¹´å†…ï¼‰ï¼šå­˜ ClickHouse åˆ†å¸ƒå¼é›†ç¾¤ã€‚&lt;/li>
&lt;li>å†·æ•°æ®ï¼ˆ&amp;gt; 1 å¹´ï¼‰ï¼šå½’æ¡£åˆ°å»‰ä»·å­˜å‚¨ï¼ˆå¦‚ AWS S3ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>Kafka ä¼˜åŒ–&lt;/strong>ï¼šè®¾ç½®æ¶ˆæ¯ 7 å¤©è¿‡æœŸï¼Œå¯ç”¨ LZ4 åŽ‹ç¼©ï¼Œé™ä½Žå­˜å‚¨æˆæœ¬ 40%ã€‚&lt;/li>
&lt;li>&lt;strong>äº‘æœåŠ¡&lt;/strong>ï¼šè¯„ä¼° AWS RDSï¼ˆMySQLï¼‰ã€Elasticacheï¼ˆRedisï¼‰ç­‰äº‘æœåŠ¡ï¼Œå‡å°‘è¿ç»´å¼€é”€ã€‚&lt;/li>
&lt;li>&lt;strong>ç¡¬ä»¶ä¼°ç®—&lt;/strong>ï¼š
&lt;ul>
&lt;li>MySQLï¼š10 å° 16 æ ¸ 64GB æœåŠ¡å™¨ã€‚&lt;/li>
&lt;li>ClickHouseï¼š6 å° 32 æ ¸ 128GB æœåŠ¡å™¨ï¼ˆ3 åˆ†ç‰‡ + 2 å‰¯æœ¬ï¼‰ã€‚&lt;/li>
&lt;li>Redisï¼š4 å° 8 æ ¸ 32GB æœåŠ¡å™¨ï¼ˆé›†ç¾¤æ¨¡å¼ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>æˆæžœ&lt;/strong>ï¼šåœ¨æ—¥äº¤æ˜“é‡ 1.2 äº¿æ¡åœºæ™¯ä¸‹ï¼Œæœˆå­˜å‚¨æˆæœ¬æŽ§åˆ¶åœ¨ 2 ä¸‡ç¾Žå…ƒä»¥å†…ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="-è¸©å‘ä¸Žè§£å†³æ¡ˆä¾‹">ðŸ› ï¸ è¸©å‘ä¸Žè§£å†³æ¡ˆä¾‹
&lt;/h2>&lt;h3 id="æ¡ˆä¾‹-1kafka-æ¶ˆè´¹å»¶è¿Ÿ">æ¡ˆä¾‹ 1ï¼šKafka æ¶ˆè´¹å»¶è¿Ÿ
&lt;/h3>&lt;p>&lt;strong>é—®é¢˜&lt;/strong>ï¼šé«˜å³°æœŸ Kafka æ¶ˆè´¹è€…æ»žåŽï¼Œå»¶è¿Ÿè¾¾ 10 ç§’ã€‚
&lt;strong>åŽŸå› &lt;/strong>ï¼šå•æ¶ˆè´¹è€…ç»„å¤„ç†èƒ½åŠ›ä¸è¶³ï¼Œéƒ¨åˆ†åˆ†åŒºæ•°æ®å€¾æ–œã€‚
&lt;strong>è§£å†³&lt;/strong>ï¼š&lt;/p>
&lt;ol>
&lt;li>å¢žåŠ æ¶ˆè´¹è€…ç»„åˆ†åŒºæ•°ï¼ˆä»Ž 16 åˆ° 64ï¼‰ã€‚&lt;/li>
&lt;li>ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¼˜åŒ–åˆ†åŒºé”®ï¼ˆåŸºäºŽ &lt;code>user_id&lt;/code>ï¼‰ï¼Œå¹³è¡¡æ•°æ®åˆ†å¸ƒã€‚&lt;/li>
&lt;li>å¼•å…¥å¸ƒéš†è¿‡æ»¤å™¨æ£€æµ‹é‡å¤æ¶ˆæ¯ï¼Œé™ä½Žå¤„ç†å¼€é”€ã€‚
&lt;strong>æ•ˆæžœ&lt;/strong>ï¼šæ¶ˆè´¹å»¶è¿Ÿé™è‡³ 1 ç§’ä»¥å†…ï¼Œåžåé‡æå‡ 2 å€ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="æ¡ˆä¾‹-2clickhouse-çƒ­ç‚¹æŸ¥è¯¢ç“¶é¢ˆ">æ¡ˆä¾‹ 2ï¼šClickHouse çƒ­ç‚¹æŸ¥è¯¢ç“¶é¢ˆ
&lt;/h3>&lt;p>&lt;strong>é—®é¢˜&lt;/strong>ï¼šé«˜é¢‘è´¦æˆ·ä½™é¢æŸ¥è¯¢å¯¼è‡´ ClickHouse å•èŠ‚ç‚¹è´Ÿè½½è¿‡é«˜ã€‚
&lt;strong>åŽŸå› &lt;/strong>ï¼šçƒ­ç‚¹æ•°æ®é›†ä¸­åœ¨å•ä¸€åˆ†ç‰‡ã€‚
&lt;strong>è§£å†³&lt;/strong>ï¼š&lt;/p>
&lt;ol>
&lt;li>å¯ç”¨ ClickHouse åˆ†å¸ƒå¼è¡¨ï¼Œæ•°æ®å‡åŒ€åˆ†ç‰‡ã€‚&lt;/li>
&lt;li>å¢žåŠ  Redis ç¼“å­˜ï¼Œä½¿ç”¨ LRU ç®—æ³•ç®¡ç†ï¼Œé™ä½Žæ•°æ®åº“åŽ‹åŠ›ã€‚&lt;/li>
&lt;li>ä½¿ç”¨ QuantileTDigest ç®—æ³•ä¼˜åŒ–èšåˆæŸ¥è¯¢ï¼Œå‡å°‘å…¨è¡¨æ‰«æã€‚
&lt;strong>æ•ˆæžœ&lt;/strong>ï¼šæŸ¥è¯¢å“åº”æ—¶é—´ä»Ž 2 ç§’é™è‡³ 200msï¼Œè´Ÿè½½å‡è¡¡ã€‚&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="-æŠ€æœ¯é€‰åž‹ç†ç”±">ðŸŒ æŠ€æœ¯é€‰åž‹ç†ç”±
&lt;/h2>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>æŠ€æœ¯&lt;/strong>&lt;/th>
&lt;th>&lt;strong>é€‰åž‹ç†ç”±&lt;/strong>&lt;/th>
&lt;th>&lt;strong>æ›¿ä»£æ–¹æ¡ˆå¯¹æ¯”&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;strong>Kafka&lt;/strong>&lt;/td>
&lt;td>é«˜åžåé‡ï¼Œåˆ†å¸ƒå¼æž¶æž„ï¼Œæ”¯æŒæ¶ˆæ¯å›žæº¯&lt;/td>
&lt;td>RocketMQï¼ˆéƒ¨ç½²å¤æ‚ï¼‰ï¼ŒRabbitMQï¼ˆåžåé‡è¾ƒä½Žï¼‰&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>MySQL&lt;/strong>&lt;/td>
&lt;td>æˆç†Ÿç¨³å®šï¼Œç”Ÿæ€ä¸°å¯Œï¼Œé€‚åˆç»“æž„åŒ–äº¤æ˜“æ•°æ®&lt;/td>
&lt;td>PostgreSQLï¼ˆå¤æ‚æŸ¥è¯¢ç¨æ…¢ï¼‰&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>ClickHouse&lt;/strong>&lt;/td>
&lt;td>é«˜æ€§èƒ½ OLAPï¼Œæ”¯æŒå¤šç»´èšåˆï¼Œåˆ†å¸ƒå¼æ‰©å±•æ€§å¼º&lt;/td>
&lt;td>Elasticsearchï¼ˆå­˜å‚¨æˆæœ¬é«˜ï¼‰&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Redis&lt;/strong>&lt;/td>
&lt;td>é«˜æ€§èƒ½ KV å­˜å‚¨ï¼Œé€‚åˆç¼“å­˜é«˜é¢‘æ•°æ®&lt;/td>
&lt;td>Memcachedï¼ˆåŠŸèƒ½è¾ƒå¼±ï¼‰&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;strong>æƒè¡¡&lt;/strong>ï¼šä¼˜å…ˆé€‰æ‹©æˆç†Ÿã€ç¤¾åŒºæ´»è·ƒçš„æŠ€æœ¯ï¼Œç¡®ä¿é•¿æœŸç»´æŠ¤æ€§å’Œç”Ÿæ€æ”¯æŒï¼›åŒæ—¶è€ƒè™‘æˆæœ¬ä¸Žæ€§èƒ½å¹³è¡¡ï¼Œé¿å…è¿‡åº¦ä¾èµ–å•ä¸€æŠ€æœ¯ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="-æœªæ¥æ¼”è¿›æ–¹å‘">ðŸš€ æœªæ¥æ¼”è¿›æ–¹å‘
&lt;/h2>&lt;p>ä¸ºæ”¯æŒä¸šåŠ¡å¢žé•¿å’ŒæŠ€æœ¯è¶‹åŠ¿ï¼Œæˆ‘ä»¬é¢„ç•™äº†ä»¥ä¸‹æ¼”è¿›ç©ºé—´ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>å®žæ—¶æœºå™¨å­¦ä¹ &lt;/strong>ï¼šé›†æˆ Flinkï¼Œæ”¯æŒå®žæ—¶é£ŽæŽ§ï¼ˆå¦‚å¼‚å¸¸äº¤æ˜“æ£€æµ‹ï¼‰å’Œä¸ªæ€§åŒ–æŽ¨èï¼Œä½¿ç”¨ XGBoost æˆ– Isolation Forest ç®—æ³•è¿›è¡Œå¼‚å¸¸æ£€æµ‹ã€‚&lt;/li>
&lt;li>&lt;strong>æ•°æ®æ¹–é›†æˆ&lt;/strong>ï¼šé€šè¿‡ Delta Lake æ•´åˆä¸­å°æ•°æ®ï¼Œæ”¯æŒå¤æ‚åˆ†æžå’Œ AI è®­ç»ƒã€‚&lt;/li>
&lt;li>&lt;strong>å¤šäº‘éƒ¨ç½²&lt;/strong>ï¼šè®¾è®¡å…¼å®¹ AWSã€Azure å’Œé˜¿é‡Œäº‘çš„æž¶æž„ï¼Œæ”¯æŒè·¨äº‘è¿ç§»ã€‚&lt;/li>
&lt;li>&lt;strong>æŠ€æœ¯å‡çº§&lt;/strong>ï¼šè¯„ä¼°æ›¿æ¢ MySQL ä¸º TiDBï¼ˆåˆ†å¸ƒå¼ SQLï¼‰ï¼ŒRedis ä¸º KeyDBï¼ˆæ›´é«˜æ€§èƒ½ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="æ€»ç»“">æ€»ç»“
&lt;/h2>&lt;p>æž„å»ºä¸€ä¸ªæ”¯æŒåƒä¸‡çº§äº¤æ˜“é‡çš„æ•°æ®ä¸­å°ç³»ç»Ÿï¼Œéœ€è¦ç»¼åˆè€ƒè™‘ä»¥ä¸‹æŒ‘æˆ˜ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>æµé‡æ‰¿è½½åŠ›&lt;/strong>ï¼šé«˜å¹¶å‘ã€é«˜åžåçš„æ•°æ®å¤„ç†èƒ½åŠ›ï¼›&lt;/li>
&lt;li>&lt;strong>æ•°æ®ä¸€è‡´æ€§&lt;/strong>ï¼šå¤šæºæ•°æ®æ•´åˆä¸Žå¼ºä¸€è‡´æ€§ä¿éšœï¼›&lt;/li>
&lt;li>&lt;strong>æ‰©å±•æ€§&lt;/strong>ï¼šæ”¯æŒäº¿çº§æ•°æ®é‡å’Œå›½é™…åŒ–åœºæ™¯ï¼›&lt;/li>
&lt;li>&lt;strong>ç®—æ³•ä¼˜åŒ–&lt;/strong>ï¼šä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œã€å¸ƒéš†è¿‡æ»¤å™¨ã€HyperLogLog ç­‰ç®—æ³•æå‡æ•ˆçŽ‡ï¼›&lt;/li>
&lt;li>&lt;strong>å®‰å…¨æ€§ä¸Žåˆè§„æ€§&lt;/strong>ï¼šå¤šç§Ÿæˆ·éš”ç¦»ä¸Žç›‘ç®¡è¦æ±‚ï¼›&lt;/li>
&lt;li>&lt;strong>æˆæœ¬æ•ˆçŽ‡&lt;/strong>ï¼šæ€§èƒ½ä¸Žèµ„æºæˆæœ¬çš„å¹³è¡¡ï¼›&lt;/li>
&lt;li>&lt;strong>å¯è§‚æµ‹æ€§&lt;/strong>ï¼šå…¨é“¾è·¯ç›‘æŽ§ä¸Žå¿«é€Ÿæ•…éšœæ¢å¤ã€‚&lt;/li>
&lt;/ul>
&lt;p>é€šè¿‡æ ‡å‡†åŒ–å»ºæ¨¡ã€åˆ†å¸ƒå¼å­˜å‚¨ã€ç®—æ³•ä¼˜åŒ–ã€ç¼“å­˜ç­–ç•¥ã€è°ƒåº¦éš”ç¦»å’Œç›‘æŽ§ä½“ç³»ï¼Œæˆ‘ä»¬å®žçŽ°äº†æ—¥å¤„ç† 1.2 äº¿æ¡äº¤æ˜“ã€æŸ¥è¯¢å“åº” &amp;lt; 150ms çš„é«˜æ€§èƒ½ä¸­å°ç³»ç»Ÿã€‚å¸Œæœ›æœ¬æ–‡çš„ç»éªŒä¸Žæ¡ˆä¾‹èƒ½ä¸ºä½ çš„æ•°æ®ä¸­å°å»ºè®¾æä¾›å€Ÿé‰´ã€‚&lt;/p></description></item><item><title>goæ±‡ç¼–</title><link>https://60ke.github.io/posts/go%E6%B1%87%E7%BC%96/</link><pubDate>Mon, 13 Dec 2021 11:15:06 +0000</pubDate><guid>https://60ke.github.io/posts/go%E6%B1%87%E7%BC%96/</guid><description>&lt;p>&lt;a class="link" href="https://chai2010.gitbooks.io/advanced-go-programming-book/content/ch3-asm/ch3-01-basic.html" target="_blank" rel="noopener"
>goæ±‡ç¼–ä¼ é€é—¨:&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>Go æ±‡ç¼–ï¼ˆåŸºäºŽ Plan 9 é£Žæ ¼çš„ä¼ªæ±‡ç¼–ï¼‰æ˜¯ Go è¯­è¨€åº•å±‚ä¼˜åŒ–çš„é‡è¦å·¥å…·ï¼Œå°¤å…¶åœ¨æ€§èƒ½æ•æ„Ÿåœºæ™¯ï¼ˆå¦‚é«˜é¢‘è®¡ç®—ã€ç³»ç»Ÿè°ƒç”¨ï¼‰ä¸­å‘æŒ¥ä½œç”¨ã€‚æœ¬æ–‡ç»“åˆå®žé™…æ¡ˆä¾‹ï¼Œæ·±å…¥æŽ¢è®¨ Go æ±‡ç¼–çš„åŸºæœ¬æ¦‚å¿µã€ä¼ªæ±‡ç¼–è¾“å‡ºè§£æžã€ç®—æ³•ä¼˜åŒ–ã€æ€§èƒ½åˆ†æžä»¥åŠæœ€ä½³å®žè·µï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘è€…ç†è§£å’Œåº”ç”¨ Go æ±‡ç¼–ã€‚&lt;/p>&lt;/blockquote>
&lt;h2 id="-èƒŒæ™¯ä¸ŽåŠ¨æœº">ðŸ’¡ èƒŒæ™¯ä¸ŽåŠ¨æœº
&lt;/h2>&lt;p>Go è¯­è¨€ä»¥ç®€æ´å’Œé«˜æ€§èƒ½è‘—ç§°ï¼Œå…¶ç¼–è¯‘å™¨ç›´æŽ¥ç”Ÿæˆæœºå™¨ç ï¼Œæ€§èƒ½æŽ¥è¿‘ C/C++ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹ï¼ˆå¦‚é«˜é¢‘è®¡ç®—ã€å†…å­˜å¯†é›†åž‹æ“ä½œæˆ–ä¸Žç¡¬ä»¶äº¤äº’ï¼‰ï¼ŒGo çš„æ ‡å‡†å®žçŽ°å¯èƒ½æ— æ³•æ»¡è¶³æžè‡´æ€§èƒ½éœ€æ±‚ã€‚è¿™æ—¶ï¼ŒGo æ±‡ç¼–ï¼ˆåŸºäºŽ Plan 9 æ±‡ç¼–ï¼‰æä¾›äº†ç›´æŽ¥æ“ä½œåº•å±‚æŒ‡ä»¤çš„èƒ½åŠ›ï¼Œå…è®¸å¼€å‘è€…ä¼˜åŒ–å…³é”®ä»£ç è·¯å¾„ã€‚&lt;/p>
&lt;p>&lt;strong>Go æ±‡ç¼–çš„ç‰¹æ€§&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ä¼ªæ±‡ç¼–&lt;/strong>ï¼šGo ä½¿ç”¨ Plan 9 é£Žæ ¼çš„ä¼ªæ±‡ç¼–ï¼Œè€Œä¸æ˜¯ç›´æŽ¥ä½¿ç”¨ x86 æˆ– ARM çš„åŽŸç”Ÿæ±‡ç¼–ï¼ŒæŠ½è±¡äº†éƒ¨åˆ†ç¡¬ä»¶ç»†èŠ‚ï¼Œä¾¿äºŽè·¨å¹³å°å¼€å‘ã€‚&lt;/li>
&lt;li>&lt;strong>ä¸Ž Go é›†æˆ&lt;/strong>ï¼šæ±‡ç¼–ä»£ç å¯ä¸Ž Go ä»£ç æ— ç¼é›†æˆï¼Œé€‚åˆä¼˜åŒ–æ€§èƒ½ç“¶é¢ˆæˆ–å®žçŽ°ç‰¹å®šç¡¬ä»¶åŠŸèƒ½ã€‚&lt;/li>
&lt;li>&lt;strong>è°ƒè¯•æ”¯æŒ&lt;/strong>ï¼šé€šè¿‡ DWARF è°ƒè¯•ä¿¡æ¯ï¼Œæ±‡ç¼–ä»£ç å¯ä¸Ž Go è°ƒè¯•å·¥å…·ï¼ˆå¦‚ Delveï¼‰é…åˆä½¿ç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ä½¿ç”¨åœºæ™¯&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¼˜åŒ–é«˜é¢‘å‡½æ•°ï¼ˆå¦‚åŠ å¯†ç®—æ³•ã€æ•°å­¦è®¡ç®—ï¼‰ã€‚&lt;/li>
&lt;li>å®žçŽ°ä¸Žç¡¬ä»¶ç›´æŽ¥äº¤äº’çš„åŠŸèƒ½ï¼ˆå¦‚ç³»ç»Ÿè°ƒç”¨ã€SIMD æŒ‡ä»¤ï¼‰ã€‚&lt;/li>
&lt;li>è°ƒè¯•ç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç ï¼Œåˆ†æžæ€§èƒ½ç“¶é¢ˆã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>å®˜æ–¹èµ„æº&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://chai2010.gitbooks.io/advanced-go-programming-book/content/ch3-asm/ch3-01-basic.html" target="_blank" rel="noopener"
>Go æ±‡ç¼–å…¥é—¨&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/golang/go/blob/master/src/cmd/internal/dwarf/dwarf.go" target="_blank" rel="noopener"
>Go æºç ä¸­çš„ DWARF å®šä¹‰&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="http://dwarfstd.org/doc/dwarf-2.0.0.pdf" target="_blank" rel="noopener"
>DWARF æ ‡å‡†&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="-ä¸ºä»€ä¹ˆéœ€è¦-go-æ±‡ç¼–">ðŸ§  ä¸ºä»€ä¹ˆéœ€è¦ Go æ±‡ç¼–ï¼Ÿ
&lt;/h2>&lt;p>Go ç¼–è¯‘å™¨é€šå¸¸ç”Ÿæˆé«˜æ•ˆçš„æœºå™¨ç ï¼Œä½†ä»æœ‰ä¸€äº›åœºæ™¯éœ€è¦æ‰‹åŠ¨ä¼˜åŒ–ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>æ€§èƒ½ç“¶é¢ˆ&lt;/strong>ï¼šé«˜é¢‘è°ƒç”¨çš„å‡½æ•°ï¼ˆå¦‚åŠ å¯†ã€æŽ’åºï¼‰å¯èƒ½å› é€šç”¨å®žçŽ°è€Œæ•ˆçŽ‡ä¸è¶³ã€‚&lt;/li>
&lt;li>&lt;strong>åº•å±‚æŽ§åˆ¶&lt;/strong>ï¼šéœ€è¦ç›´æŽ¥æ“ä½œå¯„å­˜å™¨æˆ–å†…å­˜ï¼ˆå¦‚åŽŸå­æ“ä½œã€SIMD æŒ‡ä»¤ï¼‰ã€‚&lt;/li>
&lt;li>&lt;strong>è°ƒè¯•ä¸Žåˆ†æž&lt;/strong>ï¼šé€šè¿‡æŸ¥çœ‹ç¼–è¯‘å™¨ç”Ÿæˆçš„æ±‡ç¼–ä»£ç ï¼Œäº†è§£ä¼˜åŒ–ç©ºé—´æˆ–å‘çŽ° bugã€‚&lt;/li>
&lt;/ul>
&lt;p>Go æ±‡ç¼–åŸºäºŽ Plan 9 é£Žæ ¼ï¼Œå…·æœ‰è·¨å¹³å°æ€§ï¼ˆæ”¯æŒ x86ã€ARM64 ç­‰ï¼‰ï¼Œé€šè¿‡ &lt;code>go tool compile -S&lt;/code> æŸ¥çœ‹ä¼ªæ±‡ç¼–è¾“å‡ºæ˜¯å­¦ä¹ å’Œä¼˜åŒ–çš„èµ·ç‚¹ã€‚&lt;/p>
&lt;h2 id="-æŸ¥çœ‹-go-æ±‡ç¼–è¾“å‡º">ðŸ” æŸ¥çœ‹ Go æ±‡ç¼–è¾“å‡º
&lt;/h2>&lt;p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ Go ç¨‹åº &lt;code>pkg.go&lt;/code>ï¼Œç”¨äºŽæ¼”ç¤ºæ±‡ç¼–è¾“å‡ºï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">pkg&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">Id&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">9527&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆä¼ªæ±‡ç¼–ä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">go tool compile -S pkg.go
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æˆ–&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">go build -gcflags&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;-S&amp;#34;&lt;/span> pkg.go
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å…³é—­å†…è”ä¼˜åŒ–&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">go build -gcflags&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;-S -N&amp;#34;&lt;/span> pkg.go
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>å‘½ä»¤è¯´æ˜Ž&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>-S&lt;/code>ï¼šè¾“å‡ºä¼ªæ±‡ç¼–ä»£ç ï¼Œå±•ç¤ºç¼–è¯‘å™¨ç”Ÿæˆçš„æŒ‡ä»¤ã€‚&lt;/li>
&lt;li>&lt;code>-N&lt;/code>ï¼šç¦ç”¨å†…è”ä¼˜åŒ–ï¼Œä¾¿ piekÄÅ¡anas galvu, lai redzÄ“tu oriÄ£inÄlo rakstu&lt;/li>
&lt;li>&lt;code>gcflags&lt;/code>ï¼šGo ç¼–è¯‘å™¨æ ‡å¿—ï¼Œè¯¦è§ &lt;code>go help compile&lt;/code>ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="arm64-æ±‡ç¼–è¾“å‡º">ARM64 æ±‡ç¼–è¾“å‡º
&lt;/h3>&lt;p>è¿è¡Œä¸Šè¿°å‘½ä»¤ï¼ˆARM64 æž¶æž„ï¼‰ç”Ÿæˆä»¥ä¸‹è¾“å‡ºï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># command-line-arguments
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">go.cuinfo.producer.command-line-arguments SDWARFCUINFO dupok size=0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0x0000 2d 73 68 61 72 65 64 -shared
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">go.cuinfo.packagename.command-line-arguments SDWARFCUINFO dupok size=0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0x0000 70 6b 67 pkg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#34;&amp;#34;.Id SNOPTRDATA size=8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0x0000 37 25 00 00 00 00 00 00 7%......
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">go.info.command-line-arguments.Id SDWARFVAR dupok size=42
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0x0000 08 63 6f 6d 6d 61 6e 64 2d 6c 69 6e 65 2d 61 72 .command-line-ar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0x0010 67 75 6d 65 6e 74 73 2e 49 64 00 09 03 00 00 00 guments.Id......
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0x0020 00 00 00 00 00 00 00 00 00 01 ..........
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rel 29+8 t=1 &amp;#34;&amp;#34;.Id+0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rel 37+4 t=31 go.info.int+0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="amd64-æ±‡ç¼–è¾“å‡º">AMD64 æ±‡ç¼–è¾“å‡º
&lt;/h3>&lt;p>AMD64 æž¶æž„çš„è¾“å‡ºæ›´ç®€æ´ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># command-line-arguments
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">go.cuinfo.packagename.command-line-arguments SDWARFCUINFO dupok size=0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0x0000 70 6b 67 pkg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#34;&amp;#34;.Id SNOPTRDATA size=8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0x0000 37 25 00 00 00 00 00 00 7%......
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ±‡ç¼–è¾“å‡ºè§£æž">æ±‡ç¼–è¾“å‡ºè§£æž
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>&lt;strong>&lt;code>go.cuinfo.producer.command-line-arguments&lt;/code>&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>è¡¨ç¤ºç¼–è¯‘å™¨ä¿¡æ¯ï¼Œ&lt;code>SDWARFCUINFO&lt;/code> æ˜¯ DWARF è°ƒè¯•ä¿¡æ¯çš„ç¼–è¯‘å•å…ƒï¼ˆCompilation Unitï¼‰éƒ¨åˆ†ã€‚&lt;/li>
&lt;li>&lt;code>dupok&lt;/code>ï¼šå…è®¸ç¬¦å·é‡å¤ï¼Œå¸¸è§äºŽå¤šæ–‡ä»¶ç¼–è¯‘åœºæ™¯ã€‚&lt;/li>
&lt;li>&lt;code>0x0000 2d 73 68 61 72 65 64&lt;/code>ï¼šè¡¨ç¤º &lt;code>-shared&lt;/code> çš„ ASCII ç ï¼ˆ16 è¿›åˆ¶ï¼‰ï¼Œç”¨äºŽç¼–è¯‘å™¨å…ƒæ•°æ®ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>&lt;code>go.cuinfo.packagename.command-line-arguments&lt;/code>&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>æŒ‡å®šåŒ…å &lt;code>pkg&lt;/code>ï¼Œå­˜å‚¨ä¸º ASCII ç ï¼ˆ&lt;code>0x0000 70 6b 67&lt;/code>ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>&lt;code>&amp;quot;&amp;quot;.Id SNOPTRDATA size=8&lt;/code>&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>å®šä¹‰å…¨å±€å˜é‡ &lt;code>Id&lt;/code>ï¼Œå€¼ä¸º &lt;code>9527&lt;/code>ï¼ˆ16 è¿›åˆ¶ &lt;code>0x2537&lt;/code>ï¼Œä½Žå­—èŠ‚åºå­˜å‚¨ä¸º &lt;code>37 25&lt;/code>ï¼‰ã€‚&lt;/li>
&lt;li>&lt;code>SNOPTRDATA&lt;/code>ï¼šè¡¨ç¤ºè¯¥æ•°æ®ä¸åŒ…å«æŒ‡é’ˆï¼ŒGCï¼ˆåžƒåœ¾å›žæ”¶ï¼‰æ— éœ€æ‰«æã€‚&lt;/li>
&lt;li>&lt;code>size=8&lt;/code>ï¼šå˜é‡å ç”¨ 8 å­—èŠ‚ï¼ˆ&lt;code>int&lt;/code> ç±»åž‹ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>&lt;code>go.info.command-line-arguments.Id&lt;/code>&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>DWARF è°ƒè¯•ä¿¡æ¯ï¼Œè®°å½•å˜é‡ &lt;code>Id&lt;/code> çš„å…ƒæ•°æ®ï¼ˆå¦‚åç§°ã€ç±»åž‹ï¼‰ã€‚&lt;/li>
&lt;li>&lt;code>rel&lt;/code>ï¼šé‡å®šä½ä¿¡æ¯ï¼ŒæŒ‡å‘å˜é‡åœ°å€æˆ–ç±»åž‹ä¿¡æ¯ï¼ˆå¦‚ &lt;code>go.info.int&lt;/code>ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>DWARF ç®€ä»‹&lt;/strong>ï¼š
DWARFï¼ˆDebugging With Attributed Record Formatsï¼‰æ˜¯ä¸€ç§æ ‡å‡†åŒ–è°ƒè¯•æ•°æ®æ ¼å¼ï¼Œç”¨äºŽå­˜å‚¨ç¨‹åºçš„ç¬¦å·è¡¨ã€ç±»åž‹ä¿¡æ¯å’Œæºä»£ç æ˜ å°„ã€‚Go ç¼–è¯‘å™¨é€šè¿‡ DWARF æä¾›è°ƒè¯•æ”¯æŒï¼Œæ–¹ä¾¿å·¥å…·å¦‚ Delve åˆ†æžå˜é‡å’Œè°ƒç”¨æ ˆã€‚æ›´å¤šèµ„æºï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="http://dwarfstd.org/doc/dwarf-2.0.0.pdf" target="_blank" rel="noopener"
>DWARF æ ‡å‡†&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://developer.ibm.com/articles/au-dwarf-debug-format/" target="_blank" rel="noopener"
>IBM DWARF ä»‹ç»&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.grant.pizza/blog/dwarf/" target="_blank" rel="noopener"
>Parsing Go Binary DWARF Info&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ARM64 vs. AMD64&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ARM64 è¾“å‡ºæ›´å¤æ‚ï¼ŒåŒ…å«é¢å¤–å…ƒæ•°æ®ï¼ˆå¦‚ &lt;code>go.info&lt;/code> è°ƒè¯•ä¿¡æ¯ï¼‰ï¼Œå› ä¸º ARM64 æž¶æž„éœ€è¦æ›´å¤šæŒ‡ä»¤å¯¹é½å’Œå…ƒæ•°æ®æ”¯æŒã€‚&lt;/li>
&lt;li>AMD64 è¾“å‡ºæ›´ç®€æ´ï¼Œéƒ¨åˆ†è°ƒè¯•ä¿¡æ¯å¯èƒ½è¢«ä¼˜åŒ–çœç•¥ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="-go-æ±‡ç¼–åœ¨ç®—æ³•ä¼˜åŒ–ä¸­çš„åº”ç”¨">ðŸ› ï¸ Go æ±‡ç¼–åœ¨ç®—æ³•ä¼˜åŒ–ä¸­çš„åº”ç”¨
&lt;/h2>&lt;p>Go æ±‡ç¼–å¯ç”¨äºŽä¼˜åŒ–æ€§èƒ½æ•æ„Ÿçš„ç®—æ³•ï¼Œå¦‚é«˜é¢‘æ•°å­¦è®¡ç®—ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„æ±‡ç¼–å®žçŽ°ï¼Œè®¡ç®—ä¸¤ä¸ª &lt;code>int64&lt;/code> å€¼çš„å’Œï¼Œå±•ç¤ºå¦‚ä½•ç”¨æ±‡ç¼–ä¼˜åŒ–åŠ æ³•æ“ä½œã€‚&lt;/p>
&lt;h3 id="æ±‡ç¼–ä»£ç ç¤ºä¾‹">æ±‡ç¼–ä»£ç ç¤ºä¾‹
&lt;/h3>&lt;p>åˆ›å»ºæ–‡ä»¶ &lt;code>sum_amd64.s&lt;/code>ï¼ˆé’ˆå¯¹ AMD64 æž¶æž„ï¼‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// sum_amd64.s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">#&lt;/span>&lt;span class="nx">include&lt;/span> &lt;span class="s">&amp;#34;textflag.h&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// func Sum(a, b int64) int64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">TEXT&lt;/span> &lt;span class="err">Â·&lt;/span>&lt;span class="nf">Sum&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">SB&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="nx">NOSPLIT&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="err">$&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">MOVQ&lt;/span> &lt;span class="nx">a&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">FP&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="nx">AX&lt;/span> &lt;span class="c1">// åŠ è½½ç¬¬ä¸€ä¸ªå‚æ•° a åˆ° AX å¯„å­˜å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">MOVQ&lt;/span> &lt;span class="nx">b&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">FP&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="nx">BX&lt;/span> &lt;span class="c1">// åŠ è½½ç¬¬äºŒä¸ªå‚æ•° b åˆ° BX å¯„å­˜å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ADDQ&lt;/span> &lt;span class="nx">BX&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">AX&lt;/span> &lt;span class="c1">// AX = AX + BX&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">MOVQ&lt;/span> &lt;span class="nx">AX&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ret&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">16&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">FP&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// å°†ç»“æžœå­˜å‚¨åˆ°è¿”å›žå€¼&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">RET&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯¹åº”çš„ Go ä»£ç  &lt;code>sum.go&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">pkg&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Sum å‡½æ•°å£°æ˜Žï¼Œæ±‡ç¼–å®žçŽ°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">Sum&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">b&lt;/span> &lt;span class="kt">int64&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">int64&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>ç¼–è¯‘ä¸Žæµ‹è¯•&lt;/strong>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">go build -o sum sum.go sum_amd64.s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æµ‹è¯•ä»£ç  &lt;code>main.go&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;pkg&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">result&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">pkg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Sum&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Sum(10, 20) =&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">result&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// è¾“å‡º: Sum(10, 20) = 30&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>ç®—æ³•ä¼˜åŒ–&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ç›´æŽ¥å¯„å­˜å™¨æ“ä½œ&lt;/strong>ï¼šä½¿ç”¨ &lt;code>MOVQ&lt;/code> å’Œ &lt;code>ADDQ&lt;/code> æŒ‡ä»¤ç›´æŽ¥æ“ä½œå¯„å­˜å™¨ï¼Œå‡å°‘ Go ç¼–è¯‘å™¨ç”Ÿæˆçš„é¢å¤–æ£€æŸ¥ï¼ˆå¦‚è¾¹ç•Œæ£€æŸ¥ï¼‰ã€‚&lt;/li>
&lt;li>&lt;strong>NOSPLIT æ ‡å¿—&lt;/strong>ï¼šç¦æ­¢æ ˆåˆ†è£‚ï¼Œå‡å°‘å‡½æ•°è°ƒç”¨å¼€é”€ï¼Œé€‚åˆç®€å•å‡½æ•°ã€‚&lt;/li>
&lt;li>&lt;strong>æ—¶é—´å¤æ‚åº¦&lt;/strong>ï¼šO(1)ï¼Œå•æŒ‡ä»¤åŠ æ³•ï¼Œæ€§èƒ½æŽ¥è¿‘ç¡¬ä»¶æžé™ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>æ€§èƒ½æµ‹è¯•&lt;/strong>ï¼ˆMac M1ï¼ŒGo 1.18ï¼‰ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>å®žçŽ°æ–¹å¼&lt;/strong>&lt;/th>
&lt;th>&lt;strong>åœºæ™¯&lt;/strong>&lt;/th>
&lt;th>&lt;strong>æ‰§è¡Œæ—¶é—´&lt;/strong>&lt;/th>
&lt;th>&lt;strong>å†…å­˜å ç”¨&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Go å®žçŽ°&lt;/td>
&lt;td>int64 ç›¸åŠ &lt;/td>
&lt;td>2.1 ns/op&lt;/td>
&lt;td>0 B/op&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>æ±‡ç¼–å®žçŽ°&lt;/td>
&lt;td>int64 ç›¸åŠ &lt;/td>
&lt;td>1.8 ns/op&lt;/td>
&lt;td>0 B/op&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;strong>åˆ†æž&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>æ±‡ç¼–ç‰ˆæœ¬å‡å°‘äº†çº¦ 14% çš„æ‰§è¡Œæ—¶é—´ï¼Œå› é¿å…äº† Go ç¼–è¯‘å™¨çš„æ ˆæ£€æŸ¥å’Œå‚æ•°ä¼ é€’å¼€é”€ã€‚&lt;/li>
&lt;li>å†…å­˜å ç”¨å‡ä¸º 0ï¼Œå› æ“ä½œä»…æ¶‰åŠå¯„å­˜å™¨ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="-å®žé™…æ¡ˆä¾‹ä¼˜åŒ–é«˜é¢‘å¾ªçŽ¯">ðŸ§ª å®žé™…æ¡ˆä¾‹ï¼šä¼˜åŒ–é«˜é¢‘å¾ªçŽ¯
&lt;/h2>&lt;p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®žé™…æ¡ˆä¾‹ï¼šä½¿ç”¨ Go æ±‡ç¼–ä¼˜åŒ–é«˜é¢‘å¾ªçŽ¯è®¡ç®—æ•°ç»„å…ƒç´ å’Œï¼Œç›¸æ¯” Go å®žçŽ°å‡å°‘æŒ‡ä»¤å¼€é”€ã€‚&lt;/p>
&lt;h3 id="go-å®žçŽ°">Go å®žçŽ°
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">pkg&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">SumArray&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">arr&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">int64&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">sum&lt;/span> &lt;span class="kt">int64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">v&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">arr&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">sum&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="nx">v&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">sum&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ±‡ç¼–å®žçŽ°amd64">æ±‡ç¼–å®žçŽ°ï¼ˆAMD64ï¼‰
&lt;/h3>&lt;p>åˆ›å»ºæ–‡ä»¶ &lt;code>sumarray_amd64.s&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// sumarray_amd64.s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">#&lt;/span>&lt;span class="nx">include&lt;/span> &lt;span class="s">&amp;#34;textflag.h&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// func SumArray(arr []int64) int64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">TEXT&lt;/span> &lt;span class="err">Â·&lt;/span>&lt;span class="nf">SumArray&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">SB&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="nx">NOSPLIT&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="err">$&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">MOVQ&lt;/span> &lt;span class="nx">arr&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">FP&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="nx">SI&lt;/span> &lt;span class="c1">// åŠ è½½æ•°ç»„åœ°å€&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">MOVQ&lt;/span> &lt;span class="nx">arr&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">FP&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="nx">CX&lt;/span> &lt;span class="c1">// åŠ è½½æ•°ç»„é•¿åº¦&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">MOVQ&lt;/span> &lt;span class="err">$&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">AX&lt;/span> &lt;span class="c1">// åˆå§‹åŒ– sum (AX = 0)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">TESTQ&lt;/span> &lt;span class="nx">CX&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">CX&lt;/span> &lt;span class="c1">// æ£€æŸ¥æ•°ç»„é•¿åº¦æ˜¯å¦ä¸º 0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">JE&lt;/span> &lt;span class="nx">done&lt;/span> &lt;span class="c1">// å¦‚æžœä¸º 0ï¼Œè·³è½¬åˆ°ç»“æŸ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">loop&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">ADDQ&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">SI&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="nx">AX&lt;/span> &lt;span class="c1">// sum += *SIï¼ˆå½“å‰å…ƒç´ ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ADDQ&lt;/span> &lt;span class="err">$&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">SI&lt;/span> &lt;span class="c1">// SI += 8ï¼ˆæŒ‡å‘ä¸‹ä¸€ä¸ª int64ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">DECQ&lt;/span> &lt;span class="nx">CX&lt;/span> &lt;span class="c1">// é•¿åº¦é€’å‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">JNZ&lt;/span> &lt;span class="nx">loop&lt;/span> &lt;span class="c1">// å¦‚æžœ CX != 0ï¼Œç»§ç»­å¾ªçŽ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">done&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">MOVQ&lt;/span> &lt;span class="nx">AX&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ret&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">16&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">FP&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// å­˜å‚¨è¿”å›žå€¼&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">RET&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>æµ‹è¯•ä»£ç &lt;/strong>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;pkg&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">arr&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">int64&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">result&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">pkg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">SumArray&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">arr&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;SumArray:&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">result&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// è¾“å‡º: SumArray: 15&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>æ€§èƒ½æµ‹è¯•&lt;/strong>ï¼ˆ1000 å…ƒç´ æ•°ç»„ï¼ŒMac M1ï¼ŒGo 1.18ï¼‰ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>å®žçŽ°æ–¹å¼&lt;/strong>&lt;/th>
&lt;th>&lt;strong>æ‰§è¡Œæ—¶é—´&lt;/strong>&lt;/th>
&lt;th>&lt;strong>å†…å­˜å ç”¨&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Go å®žçŽ°&lt;/td>
&lt;td>245 ns/op&lt;/td>
&lt;td>0 B/op&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>æ±‡ç¼–å®žçŽ°&lt;/td>
&lt;td>210 ns/op&lt;/td>
&lt;td>0 B/op&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;strong>ä¼˜åŒ–åˆ†æž&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>å‡å°‘æŒ‡ä»¤&lt;/strong>ï¼šæ±‡ç¼–ç‰ˆæœ¬ç›´æŽ¥æ“ä½œæŒ‡é’ˆå’Œå¯„å­˜å™¨ï¼Œå‡å°‘ Go ç¼–è¯‘å™¨çš„å¾ªçŽ¯å¼€é”€ï¼ˆå¦‚è¾¹ç•Œæ£€æŸ¥ï¼‰ã€‚&lt;/li>
&lt;li>&lt;strong>æ€§èƒ½æå‡&lt;/strong>ï¼šçº¦ 14% çš„æ€§èƒ½æå‡ï¼Œé€‚åˆé«˜é¢‘è°ƒç”¨åœºæ™¯ã€‚&lt;/li>
&lt;li>&lt;strong>å±€é™æ€§&lt;/strong>ï¼šæ±‡ç¼–ä»£ç éœ€é’ˆå¯¹ç‰¹å®šæž¶æž„ç¼–å†™ï¼ˆå¦‚ AMD64ï¼‰ï¼Œè·¨å¹³å°éœ€é‡å†™ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="-æœ€ä½³å®žè·µä¸Žæ³¨æ„äº‹é¡¹">ðŸ›¡ï¸ æœ€ä½³å®žè·µä¸Žæ³¨æ„äº‹é¡¹
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>&lt;strong>æ˜Žç¡®ä½¿ç”¨åœºæ™¯&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ä»…åœ¨æ€§èƒ½ç“¶é¢ˆå¤„ä½¿ç”¨æ±‡ç¼–ï¼ˆå¦‚é«˜é¢‘è®¡ç®—ã€å†…å­˜æ“ä½œï¼‰ã€‚&lt;/li>
&lt;li>é¿å…åœ¨ç®€å•é€»è¾‘ä¸­ä½¿ç”¨ï¼Œå¢žåŠ ç»´æŠ¤æˆæœ¬ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æž¶æž„é€‚é…&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¸ºæ¯ç§æž¶æž„ï¼ˆå¦‚ AMD64ã€ARM64ï¼‰ç¼–å†™å¯¹åº”çš„æ±‡ç¼–ä»£ç ã€‚&lt;/li>
&lt;li>ä½¿ç”¨ &lt;code>+build&lt;/code> æ ‡ç­¾åŒºåˆ†å¹³å°ï¼š
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// +build amd64&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>è°ƒè¯•ä¸Žæµ‹è¯•&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ &lt;code>go tool objdump&lt;/code> æŸ¥çœ‹ç”Ÿæˆçš„ç›®æ ‡ä»£ç ï¼ŒéªŒè¯æ±‡ç¼–å®žçŽ°ã€‚&lt;/li>
&lt;li>ç¼–å†™å•å…ƒæµ‹è¯•ï¼Œç¡®ä¿æ±‡ç¼–ä¸Ž Go é€»è¾‘ä¸€è‡´ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ³¨æ„äº‹é¡¹&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>æ ˆç®¡ç†&lt;/strong>ï¼šç¡®ä¿æ­£ç¡®å¤„ç†æ ˆå¸§ï¼Œé¿å…æ ˆæº¢å‡ºã€‚&lt;/li>
&lt;li>&lt;strong>ç¬¦å·å†²çª&lt;/strong>ï¼šä½¿ç”¨ &lt;code>Â·&lt;/code> å‰ç¼€ï¼ˆå¦‚ &lt;code>Â·Sum&lt;/code>ï¼‰é¿å…ç¬¦å·å†²çªã€‚&lt;/li>
&lt;li>&lt;strong>DWARF è°ƒè¯•&lt;/strong>ï¼šç¡®ä¿æ±‡ç¼–ä»£ç åŒ…å«è¶³å¤Ÿè°ƒè¯•ä¿¡æ¯ï¼Œæ”¯æŒ Delve è°ƒè¯•ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ€§èƒ½ç›‘æŽ§&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ &lt;code>go test -bench&lt;/code> æµ‹é‡æ€§èƒ½ï¼Œç¡®ä¿æ±‡ç¼–ä¼˜åŒ–æœ‰æ•ˆã€‚&lt;/li>
&lt;li>ç»“åˆ &lt;code>pprof&lt;/code> åˆ†æž CPU å’Œå†…å­˜ä½¿ç”¨æƒ…å†µã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h2 id="æ€»ç»“">æ€»ç»“
&lt;/h2>&lt;p>Go æ±‡ç¼–é€šè¿‡ Plan 9 ä¼ªæ±‡ç¼–æä¾›åº•å±‚ä¼˜åŒ–èƒ½åŠ›ï¼Œé€‚åˆæ€§èƒ½æ•æ„Ÿåœºæ™¯ï¼ˆå¦‚é«˜é¢‘è®¡ç®—ã€ç³»ç»Ÿè°ƒç”¨ï¼‰ã€‚æœ¬æ–‡é€šè¿‡åˆ†æžä¼ªæ±‡ç¼–è¾“å‡ºã€å®žçŽ°ç®€å•åŠ æ³•å’Œæ•°ç»„æ±‚å’Œç®—æ³•ï¼Œå±•ç¤ºäº† Go æ±‡ç¼–çš„å®žé™…åº”ç”¨ã€‚æ€§èƒ½æµ‹è¯•è¡¨æ˜Žï¼Œæ±‡ç¼–å¯å‡å°‘çº¦ 10-15% çš„æ‰§è¡Œæ—¶é—´ï¼Œä½†éœ€æƒè¡¡å¼€å‘å’Œç»´æŠ¤æˆæœ¬ã€‚ç»“åˆ DWARF è°ƒè¯•ä¿¡æ¯å’Œæœ€ä½³å®žè·µï¼Œå¼€å‘è€…å¯ä»¥åœ¨é€‚å½“åœºæ™¯ä¸‹åˆ©ç”¨ Go æ±‡ç¼–æå‡æ€§èƒ½ï¼ŒåŒæ—¶ä¿æŒä»£ç å¯ç»´æŠ¤æ€§ã€‚&lt;/p></description></item><item><title>vscodeå¥‡æŠ€æ·«å·§</title><link>https://60ke.github.io/drafts/vscode%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A7/</link><pubDate>Fri, 18 Sep 2020 14:29:16 +0000</pubDate><guid>https://60ke.github.io/drafts/vscode%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A7/</guid><description>&lt;h2 id="ç”¨æˆ·ä»£ç ç‰‡æ®µ">ç”¨æˆ·ä»£ç ç‰‡æ®µ
&lt;/h2>&lt;p>ä¹‹å‰åœ¨sublimeä¸Šå¸¸ç”¨tmplæ’ä»¶æ¥æ–°å»ºpythonæ–‡ä»¶,æ–‡ä»¶é»˜è®¤åŒ…å«å¤´æ–‡ä»¶æ¨¡æ¿ã€‚vscodeå¯ä»¥ç›´æŽ¥æ·»åŠ ä¸Žæ–‡ä»¶ç›¸å…³çš„ä»£ç ç‰‡æ®µã€‚
pythonç”¨æˆ·ä»£ç ç‰‡æ®µ:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;HEADER&amp;#34;&lt;/span>&lt;span class="p">:{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;header&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;body&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;#!/usr/bin/env python&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;# -*- encoding: utf-8 -*-&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;&amp;#39;&amp;#39;&amp;#39;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;@File : $TM_FILENAME&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;@Time : $CURRENT_YEAR/$CURRENT_MONTH/$CURRENT_DATE $CURRENT_HOUR:$CURRENT_MINUTE:$CURRENT_SECOND&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;@Author : worileqing&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;@Version : 1.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;@Contact : worileqing@163.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;@Desc : None&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;&amp;#39;&amp;#39;&amp;#39;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;# here put the import lib&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;$0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>markdownç”¨æˆ·ä»£ç ç‰‡æ®µ:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;HEADER&amp;#34;&lt;/span>&lt;span class="p">:{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;date&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;body&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;date : $CURRENT_YEAR-$CURRENT_MONTH-$CURRENT_DATE $CURRENT_HOUR:$CURRENT_MINUTE:$CURRENT_SECOND&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;HEADER&amp;#34;&lt;/span>&lt;span class="p">:{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;code is&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;body&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;code is cheap,show code:&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½†æ˜¯åˆ›å»ºå®Œæˆé…ç½®æœªèƒ½åœ¨markdownä¸­ç”Ÿæ•ˆ,è§£å†³åŠžæ³•:
åœ¨setting.jsonä¸­æ·»åŠ :&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;[markdown]&amp;#34;&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;editor.quickSuggestions&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;other&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;comments&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;strings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>&lt;span class="err">,&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="coder-runner">coder runner
&lt;/h2>&lt;p>å¯ä»¥åœ¨ä»»æ„ç±»åž‹çš„æ–‡ä»¶é‡Œé¢é€‰ä¸­ä»£ç  &lt;code>code run by some language&lt;/code>&lt;/p></description></item><item><title>sgxå¼€å‘</title><link>https://60ke.github.io/posts/sgx/</link><pubDate>Fri, 17 Jan 2020 16:46:35 +0000</pubDate><guid>https://60ke.github.io/posts/sgx/</guid><description>&lt;h1 id="sgx-å¼€å‘">sgx å¼€å‘
&lt;/h1>&lt;h2 id="å½“å‰é¡¹ç›®ä¾èµ–">å½“å‰é¡¹ç›®ä¾èµ–ï¼š
&lt;/h2>&lt;p>&lt;a class="link" href="https://github.com/apache/incubator-teaclave-sgx-sdk" target="_blank" rel="noopener"
>incubator-teaclave-sgx-sdk&lt;/a> 1.0.9(åŽŸbaidu rust sgx sdk)&lt;/p>
&lt;p>Rust nightly-2019-08-01&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/enigmampc/enigma-core" target="_blank" rel="noopener"
>https://github.com/enigmampc/enigma-core&lt;/a> çš„ä¸€äº›crate(åŽç»­å¼€å‘å‰”é™¤)&lt;/p>
&lt;p>é€‚ç”¨äºŽrust sgxçš„crateï¼š&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/dingelish/sgx-world" target="_blank" rel="noopener"
>https://github.com/dingelish/sgx-world&lt;/a>&lt;/p>
&lt;h2 id="é¡¹ç›®å¼€å‘é‡åˆ°çš„é—®é¢˜">é¡¹ç›®å¼€å‘é‡åˆ°çš„é—®é¢˜
&lt;/h2>&lt;h3 id="evmè¯»å†™é›†çš„è®°å½•">evmè¯»å†™é›†çš„è®°å½•ï¼š
&lt;/h3>&lt;p>åœ¨sputnikvmçš„è¿”å›žç»“æžœä¸Šæ·»åŠ è¯»å†™é›†ã€‚å¯å¯¹æ¯” &lt;a class="link" href="https://github.com/60ke/sputnikvm" target="_blank" rel="noopener"
>https://github.com/60ke/sputnikvm&lt;/a> ä¸Ž &lt;a class="link" href="https://github.com/enigmampc/sputnikvm/tree/enigma-next" target="_blank" rel="noopener"
>https://github.com/enigmampc/sputnikvm/tree/enigma-next&lt;/a> çš„åŒºåˆ«&lt;/p>
&lt;h3 id="ocall">ocallï¼š
&lt;/h3>&lt;p>ä¼ å…¥addresså’Œstorageçš„keyæ¥èŽ·å–storageçš„valueçš„edléƒ¨åˆ†çš„ä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="nf">ocall_get_storage&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">in&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">size&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">addr_len&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="kt">uint8_t&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">addr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="kt">uint8_t&lt;/span> &lt;span class="n">addr_len&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">in&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">size&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">index_len&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="kt">uint8_t&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">index&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="kt">uint8_t&lt;/span> &lt;span class="n">index_len&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">size&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1000&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="kt">uint8_t&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="p">,[&lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="kt">uint8_t&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">value_len&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="enclaveä¸Žå¤–ç•Œçš„æ•°æ®ç±»åž‹äº¤äº’">enclaveä¸Žå¤–ç•Œçš„æ•°æ®ç±»åž‹äº¤äº’ï¼š
&lt;/h3>&lt;p>ç”±edlç”Ÿæˆcå‡½æ•°,é€šè¿‡æŒ‡é’ˆçš„æ–¹æ³•è¿›è¡Œè¿›è¡Œäº¤äº’&lt;/p>
&lt;h3 id="solidityæµ‹è¯•åˆçº¦">solidityæµ‹è¯•åˆçº¦
&lt;/h3>&lt;p>regchain wikiä¸­çš„åˆçº¦ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">pragma solidity ^0.4.24;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">contract sample {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> uint256 a = 0;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> function add() payable public returns (uint256) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> a = a + msg.value;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return a;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>éœ€è¦æ“ä½œstorageçš„åˆçº¦ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">pragma solidity ^0.4.24;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">contract MyContract {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> uint[] array = [1,2,3,4,5];
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> function removeAtIndex(uint index) returns (uint[]) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (index &amp;gt;= array.length) return;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> for (uint i = index; i &amp;lt; array.length-1; i++) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> array[i] = array[i+1];
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> delete array[array.length-1];
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> array.length--;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return array;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="åˆ©ç”¨vscodeå’Œsgx-gdbè¿›è¡Œè°ƒè¯•">åˆ©ç”¨vscodeå’Œsgx-gdbè¿›è¡Œè°ƒè¯•
&lt;/h3>&lt;p>æ•™ç¨‹ï¼š&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/apache/incubator-teaclave-sgx-sdk/wiki/Setup-gdb-7.11-on-Ubuntu-18.04-for-VSCode---sgx-gdb-remote-debugging" target="_blank" rel="noopener"
>Setup gdb 7.11 on Ubuntu 18.04 for VSCode sgx gdb remote debugging&lt;/a>&lt;/p>
&lt;p>å¯¹åº”ä»£ç å®žä¾‹ï¼š&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/apache/incubator-teaclave-sgx-sdk/tree/master/samplecode/hello-rust-vscode-debug" target="_blank" rel="noopener"
>hello-rust-vscode-debug&lt;/a>&lt;/p>
&lt;h3 id="intelè¿œç¨‹è¯å®ž">intelè¿œç¨‹è¯å®ž
&lt;/h3>&lt;ul>
&lt;li>
&lt;h4 id="è‹±ç‰¹å°”å®˜æ–¹è¿œç¨‹è¯å®ž">è‹±ç‰¹å°”å®˜æ–¹è¿œç¨‹è¯å®ž
&lt;/h4>&lt;p>æ³¨å†Œè‹±ç‰¹å°”å¼€å‘è€…è´¦å·èŽ·å–spidå’Œkey:&lt;/p>
&lt;p>&lt;a class="link" href="https://software.intel.com/registration/?lang=zh-cn" target="_blank" rel="noopener"
>https://software.intel.com/registration/?lang=zh-cn&lt;/a>&lt;/p>
&lt;p>intelå®˜æ–¹å®žä¾‹ï¼šhttps://software.intel.com/zh-cn/articles/code-sample-intel-software-guard-extensions-remote-attestation-end-to-end-example&lt;/p>
&lt;p>Rust sgxç›¸å…³ä»£ç å®žä¾‹ï¼š&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/apache/incubator-teaclave-sgx-sdk/tree/master/samplecode/mutual-ra" target="_blank" rel="noopener"
>mutual-ra&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/apache/incubator-teaclave-sgx-sdk/tree/master/samplecode/ue-ra" target="_blank" rel="noopener"
>ue-ra&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;h4 id="ç¬¬ä¸‰æ–¹è¿œç¨‹è¯å®ždcap">ç¬¬ä¸‰æ–¹è¿œç¨‹è¯å®žï¼ˆdcapï¼‰
&lt;/h4>&lt;p>&lt;a class="link" href="https://github.com/intel/SGXDataCenterAttestationPrimitives" target="_blank" rel="noopener"
>https://github.com/intel/SGXDataCenterAttestationPrimitives&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/Jianbo-Gao/RegChain/wiki/Sgx%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BF%9C%E7%A8%8B%E8%AF%81%E5%AE%9E%E7%A1%AC%E4%BB%B6%E8%AF%B4%E6%98%8E" target="_blank" rel="noopener"
>Sgxç¬¬ä¸‰æ–¹è¿œç¨‹è¯å®žç¡¬ä»¶è¯´æ˜Ž&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="arm-trustzone">ARM TrustZone:
&lt;/h3>&lt;p>&lt;a class="link" href="https://github.com/OP-TEE/optee_os" target="_blank" rel="noopener"
>OP-TEE / optee_os&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/ARMmbed/meta-mbl" target="_blank" rel="noopener"
>ARMmbed / meta-mbl&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://blog.csdn.net/shuaifengyun/article/details/73716352" target="_blank" rel="noopener"
>https://blog.csdn.net/shuaifengyun/article/details/73716352&lt;/a>&lt;/p></description></item><item><title>MySQL</title><link>https://60ke.github.io/drafts/mysql/</link><pubDate>Wed, 10 Jul 2019 11:20:46 +0000</pubDate><guid>https://60ke.github.io/drafts/mysql/</guid><description>&lt;p>MySQL5.7.22æ•°æ®åº“å®‰è£…å®ŒåŽæ›´æ”¹å¯†ç ï¼›&lt;/p>
&lt;p>&lt;code>ALTER USER USER() IDENTIFIED BY '12345678';&lt;/code>&lt;/p></description></item><item><title>paramiko æ‰§è¡Œsudo</title><link>https://60ke.github.io/drafts/paramiko-%E6%89%A7%E8%A1%8Csudo/</link><pubDate>Tue, 28 May 2019 12:00:26 +0000</pubDate><guid>https://60ke.github.io/drafts/paramiko-%E6%89%A7%E8%A1%8Csudo/</guid><description>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">paramiko&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ssh&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">paramiko&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SSHClient&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ssh&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">set_missing_host_key_policy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">paramiko&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">AutoAddPolicy&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">host_ips&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;127.0.0.1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">username&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;admin&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">password&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;admin&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">port&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ssh&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">connect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host_ip&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">port&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">password&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">stdin&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">stdout&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">stderr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ssh&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">exec_command&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;sudo -S -p &amp;#39;&amp;#39; service redis restart;&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#stdout.read()å¯ä»¥èŽ·å–è¾“å‡ºå†…å®¹&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ³¨æ„æ‰§è¡Œå¸¦æœ‰ &lt;code>sudo&lt;/code>çš„ &lt;code>ssh.exec_command()&lt;/code>æ—¶éœ€è¦åœ¨å‘½ä»¤å‰åŠ  &lt;code>sudo -S -p '' &lt;/code>&lt;/p></description></item><item><title>Archives</title><link>https://60ke.github.io/archives/</link><pubDate>Tue, 28 May 2019 00:00:00 +0000</pubDate><guid>https://60ke.github.io/archives/</guid><description/></item><item><title>about</title><link>https://60ke.github.io/about/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://60ke.github.io/about/</guid><description>&lt;p>coder&lt;/p></description></item><item><title>Search</title><link>https://60ke.github.io/search/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://60ke.github.io/search/</guid><description/></item></channel></rss>