<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="test ä¸‹é¢çš„ä»£ç æ˜¯ä¿®æ”¹è¿‡çš„,ä¸­æ–‡ç‰ˆçš„goç¨‹åºè®¾è®¡è¯­è¨€,8.5å¹¶è¡Œå¾ªç¯çš„æœ€åä¸€ä¸ªç¤ºä¾‹: ä»£ç è™½æœ‰ä¿®æ”¹,ä½†æ˜¯åªæ”¹å˜äº†å¹¶å‘çš„åŠŸèƒ½,å¹¶å‘çš„é€»è¾‘ä¸æºç æ²¡ä»€ä¹ˆåŒºåˆ«
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 package main import ( &amp;#34;fmt&amp;#34; &amp;#34;sync&amp;#34; &amp;#34;time&amp;#34; ) func main() { var wg sync.WaitGroup sizes := make(chan int64) wg."><title>goè¯­è¨€åœ£ç»8.5--goroutineè§£æƒ‘</title><link rel=canonical href=https://60ke.github.io/drafts/go%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F8-5-goroutine%E8%A7%A3%E6%83%91/><link rel=stylesheet href=/scss/style.min.8191399262444ab68b72a18c97392f5349be20a1615d77445be51e974c144cff.css><meta property="og:title" content="goè¯­è¨€åœ£ç»8.5--goroutineè§£æƒ‘"><meta property="og:description" content="test ä¸‹é¢çš„ä»£ç æ˜¯ä¿®æ”¹è¿‡çš„,ä¸­æ–‡ç‰ˆçš„goç¨‹åºè®¾è®¡è¯­è¨€,8.5å¹¶è¡Œå¾ªç¯çš„æœ€åä¸€ä¸ªç¤ºä¾‹: ä»£ç è™½æœ‰ä¿®æ”¹,ä½†æ˜¯åªæ”¹å˜äº†å¹¶å‘çš„åŠŸèƒ½,å¹¶å‘çš„é€»è¾‘ä¸æºç æ²¡ä»€ä¹ˆåŒºåˆ«
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 package main import ( &amp;#34;fmt&amp;#34; &amp;#34;sync&amp;#34; &amp;#34;time&amp;#34; ) func main() { var wg sync.WaitGroup sizes := make(chan int64) wg."><meta property="og:url" content="https://60ke.github.io/drafts/go%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F8-5-goroutine%E8%A7%A3%E6%83%91/"><meta property="og:site_name" content="LookForAdmin"><meta property="og:type" content="article"><meta property="article:section" content="Drafts"><meta property="article:tag" content="golang"><meta property="article:tag" content="å¹¶å‘ç¼–ç¨‹"><meta property="article:published_time" content="2021-08-10T18:21:51+00:00"><meta property="article:modified_time" content="2021-08-10T18:21:51+00:00"><meta name=twitter:title content="goè¯­è¨€åœ£ç»8.5--goroutineè§£æƒ‘"><meta name=twitter:description content="test ä¸‹é¢çš„ä»£ç æ˜¯ä¿®æ”¹è¿‡çš„,ä¸­æ–‡ç‰ˆçš„goç¨‹åºè®¾è®¡è¯­è¨€,8.5å¹¶è¡Œå¾ªç¯çš„æœ€åä¸€ä¸ªç¤ºä¾‹: ä»£ç è™½æœ‰ä¿®æ”¹,ä½†æ˜¯åªæ”¹å˜äº†å¹¶å‘çš„åŠŸèƒ½,å¹¶å‘çš„é€»è¾‘ä¸æºç æ²¡ä»€ä¹ˆåŒºåˆ«
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 package main import ( &amp;#34;fmt&amp;#34; &amp;#34;sync&amp;#34; &amp;#34;time&amp;#34; ) func main() { var wg sync.WaitGroup sizes := make(chan int64) wg."><link rel="shortcut icon" href=/img/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/Avatar.jpeg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>ğŸ¥</span></figure><div class=site-meta><h1 class=site-name><a href=/>LookForAdmin</a></h1><h2 class=site-description>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</h2></div></header><ol class=social-menu><li><a href=https://github.com/60ke target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/posts target=_blank><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/drafts><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-infinity" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M9.828 9.172a4 4 0 100 5.656A10 10 0 0012 12a10 10 0 012.172-2.828 4 4 0 110 5.656A10 10 0 0112 12 10 10 0 009.828 9.172"/></svg><span>è‰ç¨¿ç®±</span></a></li><li><a href=/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>about</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>æš—è‰²æ¨¡å¼</span></li></div></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/drafts/go%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F8-5-goroutine%E8%A7%A3%E6%83%91/>goè¯­è¨€åœ£ç»8.5--goroutineè§£æƒ‘</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Aug 10, 2021</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>é˜…è¯»æ—¶é•¿: 2 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><p>test
ä¸‹é¢çš„ä»£ç æ˜¯ä¿®æ”¹è¿‡çš„,ä¸­æ–‡ç‰ˆçš„goç¨‹åºè®¾è®¡è¯­è¨€,8.5å¹¶è¡Œå¾ªç¯çš„æœ€åä¸€ä¸ªç¤ºä¾‹:
ä»£ç è™½æœ‰ä¿®æ”¹,ä½†æ˜¯åªæ”¹å˜äº†å¹¶å‘çš„åŠŸèƒ½,å¹¶å‘çš„é€»è¾‘ä¸æºç æ²¡ä»€ä¹ˆåŒºåˆ«</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Go data-lang=Go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;sync&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>wg</span> <span class=nx>sync</span><span class=p>.</span><span class=nx>WaitGroup</span>
</span></span><span class=line><span class=cl>	<span class=nx>sizes</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int64</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>wg</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>go</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>defer</span> <span class=nx>wg</span><span class=p>.</span><span class=nf>Done</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=k>defer</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;send size 11&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>sizes</span> <span class=o>&lt;-</span> <span class=mi>11</span>
</span></span><span class=line><span class=cl>	<span class=p>}()</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>2</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>wg</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>t</span> <span class=o>:=</span> <span class=nx>i</span>
</span></span><span class=line><span class=cl>		<span class=k>go</span> <span class=kd>func</span><span class=p>(</span><span class=nx>t</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>defer</span> <span class=nx>wg</span><span class=p>.</span><span class=nf>Done</span><span class=p>()</span>
</span></span><span class=line><span class=cl>			<span class=k>defer</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;send size: %d\n&#34;</span><span class=p>,</span> <span class=nx>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=nx>sizes</span> <span class=o>&lt;-</span> <span class=nb>int64</span><span class=p>(</span><span class=nx>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}(</span><span class=nx>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;waiting for all goroutine &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>go</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>wg</span><span class=p>.</span><span class=nf>Wait</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span> <span class=o>*</span> <span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;wg done&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=c1>// close(sizes)
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=p>}()</span>
</span></span><span class=line><span class=cl>	<span class=k>go</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span> <span class=o>*</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;time sleep 8s&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}()</span>
</span></span><span class=line><span class=cl>	<span class=c1>// wg.Wait()
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;All goroutines finished!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1>// fmt.Println(&lt;-sizes)
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// time.Sleep(time.Second * 3)
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=kd>var</span> <span class=nx>total</span> <span class=kt>int64</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>size</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>sizes</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;get size:&#34;</span><span class=p>,</span> <span class=nx>size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>total</span> <span class=o>+=</span> <span class=nx>size</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// close(sizes)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ä¸­æ–‡ç‰ˆå…³äºè¿™æ®µçš„ä»£ç çš„æè¿°æ˜¯:</p><blockquote><p>æ³¨æ„Addå’ŒDoneæ–¹æ³•çš„ä¸å¯¹ç§°æ€§ã€‚Addé€’å¢è®¡æ•°å™¨,å®ƒå¿…é¡»åœ¨å·¥ä½œgoroutineå¼€å§‹ä¹‹å‰æ‰§è¡Œ,è€Œä¸æ˜¯åœ¨ä¸­é—´ã€‚å¦ä¸€æ–¹é¢,ä¸èƒ½ä¿è¯Addåœ¨å…³é—­è€…goroutineè°ƒç”¨Waitä¹‹å‰å‘ç”Ÿã€‚å¦å¤–,Addæœ‰ä¸€ä¸ªå‚æ•°,ä½†Doneæ²¡æœ‰,å®ƒç­‰ä»·äºAdd(-1)ã€‚ä½¿ç”¨deferæ¥ç¡®ä¿åœ¨å‘é€é”™è¯¯çš„æƒ…å†µä¸‹è®¡æ•°å™¨å¯ä»¥é€’å‡ã€‚ä½¿ç”¨deferæ¥ç¡®ä¿åœ¨å‘é€é”™è¯¯çš„æƒ…å†µä¸‹è®¡æ•°å™¨å¯ä»¥é€’å‡ã€‚åœ¨ä¸çŸ¥é“è¿­ä»£æ¬¡æ•°çš„æƒ…å†µä¸‹,ä¸Šé¢çš„ä»£ç ç»“æ„æ˜¯é€šç”¨çš„,ç¬¦åˆä¹ æƒ¯çš„å¹¶è¡Œå¾ªç¯æ¨¡å¼ã€‚</p></blockquote><blockquote><p>sizesé€šé“å°†æ¯ä¸€ä¸ªæ–‡ä»¶çš„å¤§å°å¸¦å›ä¸»goroutine,å®ƒä½¿ç”¨rangeå¾ªç¯è¿›è¡Œæ¥æ”¶ç„¶åè®¡ç®—æ€»å’Œã€‚æ³¨æ„,åœ¨å…³é—­è€…goroutineä¸­,åœ¨å…³é—­sizesé€šé“ä¹‹å‰,ç­‰å¾…æ‰€æœ‰çš„å·¥ä½œè€…ç»“æŸã€‚è¿™é‡Œä¸¤ä¸ªæ“ä½œï¼ˆç­‰å¾…å’Œå…³é—­ï¼‰å¿…é¡»åœ¨sizesé€šé“ä¸Šé¢çš„è¿­ä»£å¹¶è¡Œæ‰§è¡Œã€‚è€ƒè™‘æ›¿ä»£æ–¹æ¡ˆï¼šå¦‚æœæˆ‘ä»¬å°†ç­‰å¾…æ“ä½œæ”¾åœ¨å¾ªç¯ä¹‹å‰çš„ä¸»goroutineä¸­,å› ä¸ºé€šé“ä¼šæ»¡,å®ƒå°†æ°¸ä¸ç»“æŸï¼›å¦‚æœæ”¾åœ¨å¾ªç¯åé¢,å®ƒå°†ä¸å¯è¾¾,å› ä¸ºæ²¡æœ‰ä»»ä½•ä¸œè¥¿å¯ç”¨æ¥å…³é—­é€šé“,å¾ªç¯å¯èƒ½æ°¸ä¸ç»“æŸã€‚</p></blockquote><p>ä¸å¾—ä¸æ‰¿è®¤,è¿™ä¸ªä»£ç çš„ä¸­æ–‡æè¿°çš„å‰ä¸‰å¥è¯å°±ç»™æˆ‘æ•´æ‡µäº†:<code>æ³¨æ„Addå’ŒDoneæ–¹æ³•çš„ä¸å¯¹ç§°æ€§ã€‚Addé€’å¢è®¡æ•°å™¨,å®ƒå¿…é¡»åœ¨å·¥ä½œgoroutineå¼€å§‹ä¹‹å‰æ‰§è¡Œ,è€Œä¸æ˜¯åœ¨ä¸­é—´ã€‚å¦ä¸€æ–¹é¢,ä¸èƒ½ä¿è¯Addåœ¨å…³é—­è€…goroutineè°ƒç”¨Waitä¹‹å‰å‘ç”Ÿã€‚</code>ç¬¬ä¸€å¥è¯å¾ˆå®¹æ˜“ç†è§£ï¼šå› ä¸º<code>Add</code>å‡½æ•°æ˜¯åœ¨<code>main</code>å‡½æ•°é‡Œé¢çš„,è€Œ<code>Done</code>å‡½æ•°æ˜¯åœ¨goroutineä¸­çš„ï¼ˆä¸æ˜¯éƒ½åœ¨<code>main</code>ä¸­æˆ–éƒ½åœ¨<code>goroutine</code>ä¸­ï¼‰,æ‰€ä»¥å®ƒä»¬æ˜¯ä¸å¯¹ç§°çš„ã€‚æ¥ç€çœ‹ç¬¬äºŒå¥ï¼šå‰åŠå¥<code>Addé€’å¢è®¡æ•°å™¨</code>æŒ‡çš„æ˜¯<code>wg.Add(1)</code>,è¿™ä¸ªå°±æ˜¯å­—é¢æ„æ€,æ˜¯è¯´è¿™ä¸ªæ“ä½œä¼šå°†<code>wg+1</code>,åé¢<code>å®ƒå¿…é¡»åœ¨å·¥ä½œgoroutineå¼€å§‹ä¹‹å‰æ‰§è¡Œ,è€Œä¸æ˜¯åœ¨ä¸­é—´ã€‚</code>å°±å¼€å§‹ä¸å°†äººè¯äº†(è¯æ±‡æœ‰é™,æ²¡æœ‰ä¾®è¾±çš„æ„æ€)ã€‚ç›²çŒœè¿™ä¸ªè¯çš„æ„æ€åº”è¯¥æ˜¯ï¼š<code>Addæ“ä½œ,éœ€è¦åœ¨å…¶åé¢çš„ä»£ç </code>:<code>go func(){...}</code>ä¹‹å‰æ‰§è¡Œ,è€Œä¸æ˜¯æ”¾åœ¨<code>go func(){è¿™é‡Œï¼ˆå³ä¸­é—´ï¼‰}</code>æ‰§è¡Œ,æ—¢ç„¶æ˜¯ç›²çŒœ,é‚£è¿˜å¾—æ¥ç€çœ‹æ‰å¥½éªŒè¯ï¼š<code>å¦ä¸€æ–¹é¢,ä¸èƒ½ä¿è¯Addåœ¨å…³é—­è€…goroutineè°ƒç”¨Waitä¹‹å‰å‘ç”Ÿã€‚</code>å¦ä¸€æ–¹é¢,å¦ä¸€æ–¹é¢å‘ƒå‘ƒå‘ƒ,å…³é—­è€…goroutineåº”è¯¥æ˜¯é‚£ä¸ªå«æœ‰<code>wg.Wait()</code>çš„goroutine,ä¸èƒ½ä¿è¯Addå‡½æ•°åœ¨å…¶ä¹‹å‰å‘ç”Ÿæ˜¯ä»€ä¹ˆæ„æ€ï¼š<code>åˆç€è¿™ä¸ªä»£ç å¯èƒ½è¿˜æ²¡è¿è¡ŒAddå°±è¿è¡Œäº†Waitå‘—</code>,é‚£è¿™æ®µä»£ç çš„æ„ä¹‰ä½•åœ¨ï¼ï¼ï¼ï¼ï¼</p><p>ç„¶åå°±æœ‰äº†ä¸Šé¢çš„ä»£ç å®æµ‹,æäº†ä¸€ä¸‹åˆç»ˆäºå¼„æ˜ç™½äº†,è¿™è¯è¯´é”™äº†,å¯¹æˆ‘äº§ç”Ÿäº†è¯¯å¯¼,å¾ˆå¤§çš„è¯¯å¯¼ã€‚
å…ˆä¸è¯´ä»£ç çš„è¯æ˜,å…ˆçœ‹çœ‹è‹±æ–‡ç‰ˆåŸä¹¦æ˜¯æ€ä¹ˆæè¿°çš„å§:</p><blockquote><p>Note the asymmetry in the Add and Done methods. Add, which increments the counter, must be called before the worker goroutine starts, not within it; otherwise we would not be sure that theAddhappensbeforetheâ€˜â€˜closerâ€™â€™goroutinecallsWait. Also,Addtakesaparameter,but Done does not; itâ€™s equivalent to Add(-1). We use defer to ensure that the counter is decremented even in the error case. The structure of the code above is a common and idiomatic pattern for looping in parallel when we donâ€™t know the number of iterations.
The sizes channel carries each file size back to the main goroutine, which receives them using a range loop and computes the sum. Observe how we create a closer goroutine that waits for the workers to finish before closing the sizes channel. These two operations, wait and close, must be concurrent with the loop over sizes. Consider the alternatives: if the wait operation were placed in the main goroutine before the loop, it would never end, and if placed after the loop, it would be unreachable since with nothing closing the channel, the loop would never terminate.</p></blockquote><p>å¥½å®¶ä¼™,åŸæ¥æˆ‘çœ‹è§çš„ä¸­æ–‡ç‰ˆçš„ä¸‰å¥è¯æ˜¯ä¸¤å¥ï¼š<code>Note the asymmetry in the Add and Done methods. Add, which increments the counter, must be called before the worker goroutine starts, not within it; otherwise we would not be sure that theAddhappensbeforetheâ€˜â€˜closerâ€™â€™goroutinecallsWait. </code>çœ‹äº†è‹±æ–‡æˆ‘çªç„¶è§‰å¾—è‹±æ–‡ç‰ˆçš„æ¯”ä¸­æ–‡è¿˜å¥½ç†è§£,ä¸”ä¸è¯´é‚£ä¸ª<code>å·¥ä½œgoroutine</code>è·Ÿä¸ªæœºç¿»ä¼¼çš„,ä¹Ÿä¸è¯´é‚£ä¸ª<code>within it</code>è¢«ä»–ç¿»è¯‘æˆäº†<code>åœ¨ä¸­é—´</code>,æœ€è¿‡åˆ†çš„æ˜¯è‹±æ–‡è¿™é‡Œçš„åˆ†å·<code>;</code>,ä¸­æ–‡ç»™æ¥äº†ä¸ªå¥å·,<code>otherwise</code>è¢«ä»–ç¿»è¯‘æˆäº†<code>å¦ä¸€æ–¹é¢</code>,ç›´æ¥æŠŠæ„æ€ç»™å¼„åã€‚æˆ‘æ¥ç”¨æˆ‘æ‹™åŠ£çš„è¨€è¯­æŠŠç¬¬äºŒå¥ç»™ä¸ªä¸­æ–‡ç¿»è¯‘å§:<code>Addæ“ä½œæ˜¯å°†è®¡æ•°å™¨wgé€’å¢,å®ƒå¿…é¡»è¿è¡Œåœ¨å°†è¦è¿è¡Œçš„goroutine(è¿™é‡Œä¸ºåŒ…å«æœ‰wg.Doneçš„goroutine)ä¹‹å¤–,å› ä¸ºï¼ˆä¸è¿è¡Œåœ¨ä¹‹å¤–çš„è¯ï¼‰å°±æ— æ³•ä¿è¯Addåœ¨Waitä¹‹å‰è¿è¡Œäº†</code>ã€‚ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªAddå‡½æ•°ç°åœ¨çš„ä½ç½®æ°æ°å°±æ˜¯ä¸ºäº†ä¿è¯Addåœ¨Waitä¹‹å‰è¿è¡Œçš„ï¼ï¼ï¼ï¼</p></section><footer class=article-footer><section class=article-tags><a href=/tags/golang/>golang</a>
<a href=/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/>å¹¶å‘ç¼–ç¨‹</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><script src=https://utteranc.es/client.js repo=60ke/blogs issue-term=pathname crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2023 LookForAdmin</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.16.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>