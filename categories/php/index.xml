<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>php on LookForAdmin</title><link>https://60ke.github.io/categories/php/</link><description>Recent content in php on LookForAdmin</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Sun, 09 Apr 2017 12:30:00 +0000</lastBuildDate><atom:link href="https://60ke.github.io/categories/php/index.xml" rel="self" type="application/rss+xml"/><item><title>电子商务网站开发-1-需求分析</title><link>https://60ke.github.io/drafts/%E7%94%B5%E5%AD%90%E5%95%86%E5%8A%A1%E7%BD%91%E7%AB%99%E5%BC%80%E5%8F%91-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90/</link><pubDate>Sun, 09 Apr 2017 12:30:00 +0000</pubDate><guid>https://60ke.github.io/drafts/%E7%94%B5%E5%AD%90%E5%95%86%E5%8A%A1%E7%BD%91%E7%AB%99%E5%BC%80%E5%8F%91-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90/</guid><description>&lt;h2 id="功能分析">功能分析&lt;/h2>
&lt;h2 id="一丶前台">一丶前台&lt;/h2>
&lt;ol>
&lt;li>用户登录：验证用户登录输入的用户名和密码&lt;/li>
&lt;li>用户注册：要求提供用户的详细资料&lt;/li>
&lt;li>商品浏览：用户对本站提供的商品进行浏览&lt;/li>
&lt;li>商品详情：查看商品的详细信息&lt;/li>
&lt;/ol>
&lt;h2 id="二丶后台">二丶后台&lt;/h2>
&lt;ol>
&lt;li>管理员模块：添加管理员,管理员列表,编辑管理员信息,删除管理员&lt;/li>
&lt;li>商品分类模块：添加分类,分类列表,编辑分类,删除分类&lt;/li>
&lt;li>商品管理模块：添加商品,商品列表,编辑商品,删除商品&lt;/li>
&lt;li>用户管理模块：添加用户,用户列表,编辑用户,删除用户&lt;/li>
&lt;li>商品图片模块：添加文字水印,添加图片水印
&lt;img src="http://www.worileqing.top/usr/uploads/2017/04/803895375.png"
loading="lazy"
alt="需求分析.png"
>&lt;/li>
&lt;/ol>
&lt;h1 id="性能需求">性能需求&lt;/h1>
&lt;h2 id="数据精确度">数据精确度&lt;/h2>
&lt;ol>
&lt;li>在执行数据的增加、删除、修改操作时,不允许因为程序原因导致操作失败。&lt;/li>
&lt;li>在执行数据增加时,不允许发生多增加或重复增加数据的情况。&lt;/li>
&lt;li>在执行数据删除时,不允许发生多删除数据的情况。&lt;/li>
&lt;li>在执行数据删除时,对有关联的数据要求删除完全,如不能删除,请给予提示。&lt;/li>
&lt;li>在执行数据修改时,也要求保持对应的准确性。&lt;/li>
&lt;/ol>
&lt;h2 id="时间特性">时间特性&lt;/h2>
&lt;ol>
&lt;li>在管理员执行增加删除等操作时,数据库响应时间要求在2秒之内。&lt;/li>
&lt;li>Web用户浏览时,页面响应时间要求在4秒之内。&lt;/li>
&lt;/ol>
&lt;h2 id="支持软件">支持软件&lt;/h2>
&lt;p>客户端软件
操作系统：Windows7、Liunx、UNIX.
浏览器：IE、FireFox、Chrome等&lt;/p>
&lt;p>服务器端软件
操作系统：Windows NT / 2000 Server 或更高版本、Liunx、UNIX.
Web服务器：Apache2.0以上版本。
数据库产品：MYSQL5.0 以上版本。
服务器脚本：PHP5.2以上版本&lt;/p></description></item><item><title>laravel学习-1</title><link>https://60ke.github.io/drafts/laravel%E5%AD%A6%E4%B9%A0-1/</link><pubDate>Thu, 06 Apr 2017 14:49:48 +0000</pubDate><guid>https://60ke.github.io/drafts/laravel%E5%AD%A6%E4%B9%A0-1/</guid><description>&lt;p>laravel基础&lt;/p>
&lt;!-- raw HTML omitted --></description></item><item><title>php面试题-1</title><link>https://60ke.github.io/drafts/php%E9%9D%A2%E8%AF%95%E9%A2%98-1/</link><pubDate>Thu, 06 Apr 2017 07:05:00 +0000</pubDate><guid>https://60ke.github.io/drafts/php%E9%9D%A2%E8%AF%95%E9%A2%98-1/</guid><description>&lt;h2 id="谈谈你对http协议的理解">Ⅰ谈谈你对http协议的理解&lt;/h2>
&lt;p>1.首先http（超文本传输协议）其处于OSI7层模型中的应用层,OSI7层模型分别为应用层-》表示层-》会话层-》传输层-》网络层-》数据链路层-》物理层,对于这7层模型,我们应该大致的了解每一层是干嘛的,这个是必须的,在此就不一一说明。&lt;/p>
&lt;p>2.http事物是指从客户端（IE）向服务器端发送http请求,再由服务器将响应的内容返发回给客户端的一个过程。&lt;/p>
&lt;p>3.http链接是通过tcp链接,首先客户端会打开一条连向服务器端的链接,然后开始发送http请求,接着由服务器返发响应的内容,当客户端接受后就断开此链接,这样一次客户端与服务器端的通信就结束了。&lt;/p>
&lt;p>4.http报文：由客户端向服务器端发送的http请求和从服务器端发送到客户端响应的内容都是http报文,其格式为：起始行、头部（HEAD）、主体(BODY
对于报文的理解,在这里向大家推荐一个工具叫：fiddler。通过它可以详细的看到http报文的组成结构和具体的内容。&lt;/p>
&lt;p>5.http中的方法分为5种：增（PUT）、删(DELETE)、改(POST)、查(GET)、HEAD&lt;/p>
&lt;p>6.MIME（多用途网络邮箱扩展）类型：对象类型/特定子类型,如:image/png,通过fiddler可在http请求的起始行中看到。&lt;/p>
&lt;p>7.发送http请求的目的是为了请求某一资源,然后由服务器返回客户端需要的资源,客户端（IE）通过解析将其显示出来,这里的资源是如何标识的呢？其实是通过URI(Uniform Resource Identifier)统一资源标识符,其主要有2中形式：URL（统一资源定位符）和URN（统一资源名称）,目前最常用的是URL。&lt;/p>
&lt;h2 id="谈谈对ajax的理解">Ⅱ谈谈对ajax的理解&lt;/h2>
&lt;p>Ajax的全称是Asynchronous JavaScript and XML 中文名称定义为异步的JavaScript和XML。ajax是JavaScript、XML、CSS、DOM等多种已有技术的组合,它可以实现客户端的异步请求操作,这样可以实现在不需要刷新页面的情况下与服务器进行通信,从而减少用户的等待时间。&lt;/p>
&lt;h2 id="谈谈对数据库事务的理解">Ⅲ谈谈对数据库事务的理解&lt;/h2>
&lt;p>数据库事务(Database Transaction) ,是指作为单个逻辑工作单元执行的一系列操作,要么完全地执行,要么完全地不执行。 事务处理可以确保除非事务性单元内的所有操作都成功完成,否则不会永久更新面向数据的资源。通过将一组相关操作组合为一个要么全部成功要么全部失败的单元,可以简化错误恢复并使应用程序更加可靠。一个逻辑工作单元要成为事务,必须满足所谓的ACID（原子性、一致性、隔离性和持久性）属性。事务是数据库运行中的逻辑工作单位,由DBMS中的事务管理子系统负责事务的处理。&lt;/p>
&lt;h2 id="谈谈序列化的作用">Ⅳ谈谈序列化的作用&lt;/h2>
&lt;p>序列化 (Serialization)将对象的状态信息转换为可以存储或传输的形式的过程。在序列化期间,对象将其当前状态写入到临时或持久性存储区。以后,可以通过从存储区中读取或反序列化对象的状态,重新创建该对象。
序列化使其他代码可以查看或修改那些不序列化便无法访问的对象实例数据。确切地说,代码执行序列化需要特殊的权限：即指定了 SerializationFormatter 标志的 SecurityPermission。在默认策略下,通过 Internet 下载的代码或 Internet 代码不会授予该权限；只有本地计算机上的代码才被授予该权限。
通常,对象实例的所有字段都会被序列化,这意味着数据会被表示为实例的序列化数据。这样,能够解释该格式的代码有可能能够确定这些数据的值,而不依赖于该成员的可访问性。类似地,反序列化从序列化的表示形式中提取数据,并直接设置对象状态,这也与可访问性规则无关。
对于任何可能包含重要的安全性数据的对象,如果可能,应该使该对象不可序列化。如果它必须为可序列化的,请尝试生成特定字段来保存不可序列化的重要数据。如果无法实现这一点,则应注意该数据会被公开给任何拥有序列化权限的代码,并确保不让任何恶意代码获得该权限。&lt;/p>
&lt;h2 id="写出你所知道的数据库的优化方法">Ⅴ写出你所知道的数据库的优化方法&lt;/h2>
&lt;p>1、创建索引
对于查询占主要的应用来说,索引显得尤为重要。很多时候性能问题很简单的就是因为我们忘了添加索引而造成的,或者说没有添加更为有效的索引导致。如果不加索引的话,那么查找任何哪怕只是一条特定的数据都会进行一次全表扫描,如果一张表的数据量很大而符合条件的结果又很少,那么不加索引会引起致命的性能下降。但是也不是什么情况都非得建索引不可,比如性别可能就只有两个值,建索引不仅没什么优势,还会影响到更新速度,这被称为过度索引。
2、复合索引
比如有一条语句是这样的：select * from users where area=&amp;lsquo;beijing&amp;rsquo; and age=22;
如果我们是在area和age上分别创建单个索引的话,由于mysql查询每次只能使用一个索引,所以虽然这样已经相对不做索引时全表扫描提高了很多效率,但是如果在area、age两列上创建复合索引的话将带来更高的效率。如果我们创建了(area, age, salary)的复合索引,那么其实相当于创建了(area,age,salary)、(area,age)、(area)三个索引,这被称为最佳左前缀特性。因此我们在创建复合索引时应该将最常用作限制条件的列放在最左边,依次递减。
3、索引不会包含有NULL值的列
只要列中包含有NULL值都将不会被包含在索引中,复合索引中只要有一列含有NULL值,那么这一列对于此复合索引就是无效的。所以我们在数据库设计时不要让字段的默认值为NULL。
4、使用短索引
对串列进行索引,如果可能应该指定一个前缀长度。例如,如果有一个CHAR(255)的 列,如果在前10 个或20 个字符内,多数值是惟一的,那么就不要对整个列进行索引。短索引不仅可以提高查询速度而且可以节省磁盘空间和I/O操作。
5、排序的索引问题
mysql查询只使用一个索引,因此如果where子句中已经使用了索引的话,那么order by中的列是不会使用索引的。因此数据库默认排序可以符合要求的情况下不要使用排序操作；尽量不要包含多个列的排序,如果需要最好给这些列创建复合索引。
6、like语句操作
一般情况下不鼓励使用like操作,如果非使用不可,如何使用也是一个问题。like “%aaa%” 不会使用索引而like “aaa%”可以使用索引。
7、不要在列上进行运算
select * from users where YEAR(adddate)&amp;lt;2007;
将在每个行上进行运算,这将导致索引失效而进行全表扫描,因此我们可以改成
select * from users where adddate&amp;lt;‘2007-01-01&amp;rsquo;;
8、不使用NOT IN和&amp;lt;&amp;gt;操作
NOT IN和&amp;lt;&amp;gt;操作都不会使用索引将进行全表扫描。NOT IN可以NOT EXISTS代替,id&amp;lt;&amp;gt;3则可使用id&amp;gt;3 or id&amp;lt;3来代替。&lt;/p>
&lt;h2 id="写出你所知道的排序方法并说出他们的时间复杂度空间复杂度以及稳定性">Ⅵ写出你所知道的排序方法并说出他们的时间复杂度空间复杂度以及稳定性&lt;/h2>
&lt;p>&lt;a class="link" href="http://blog.chinaunix.net/attachment/201201/18/21457204_1326898064RUxx.jpg" target="_blank" rel="noopener"
>http://blog.chinaunix.net/attachment/201201/18/21457204_1326898064RUxx.jpg&lt;/a>&lt;/p>
&lt;h2 id="简述cookie和session">Ⅶ简述cookie和session&lt;/h2>
&lt;p>cookie是一种在客户浏览器端存储数据并以此来跟踪和识别用户的机制。
session 用来在服务器端保存用户的状态信息。
cookie数据存放在客户的浏览器上,服务器端不用保存。session数据放在服务器上,本地内存也有一份。
cookie安全性不如session。因为普通cookie保存在本地硬盘上,黑客可以伪造url等方式发起xss攻击,获取本地硬盘保存状态的cookie,进而窃取用户的敏感信息。
session则不同,只有在用户登录此网站时发起xss攻击才能获取session信息,关闭浏览器之后,session即被销毁,安全性较cookie要好
Cookie支持跨域名访问,Session仅在他所在的域名内有效。
cookie的保存内容大小有限制。&lt;/p>
&lt;h2 id="tcp与udp有什么差别列举几个基于udp和tcp的协议">Ⅷtcp与udp有什么差别,列举几个基于udp和tcp的协议&lt;/h2>
&lt;p>TCP&amp;mdash;传输控制协议,提供的是面向连接、可靠的字节流服务。当客户和服务器彼此交换数据前,必须先在双方之间建立一个TCP连接,之后才能传输数据。TCP提供超时重发,丢弃重复数据,检验数据,流量控制等功能,保证数据能从一端传到另一端。
UDP&amp;mdash;用户数据报协议,是一个简单的面向数据报的运输层协议。UDP不提供可靠性,它只是把应用程序传给IP层的数据报发送出去,但是并不能保证它们能到达目的地。由于UDP在传输数据报前不用在客户和服务器之间建立一个连接,且没有超时重发等机制,故而传输速度很快
TCP是面向连接的,有比较高的可靠性,
一些要求比较高的服务一般使用这个协议,如FTP、Telnet、SMTP、HTTP、POP3等,而UDP是面向无连接的,使用这个协议的常见服务有DNS、SNMP、QQ等。对于QQ必须另外说明一下,QQ2003以前是只使用UDP协议的,其服务器使用8000端口,侦听是否有信息传来,客户端使用4000端口,向外发送信息（这也就不难理解在一般的显IP的QQ版本中显示好友的IP地址信息中端口常为4000或其后续端口的原因了）,即QQ程序既接受服务又提供服务,在以后的QQ版本中也支持使用TCP协议了。&lt;/p></description></item><item><title>PHP常用类库</title><link>https://60ke.github.io/drafts/php%E5%B8%B8%E7%94%A8%E7%B1%BB%E5%BA%93/</link><pubDate>Sun, 06 Mar 2016 05:50:00 +0000</pubDate><guid>https://60ke.github.io/drafts/php%E5%B8%B8%E7%94%A8%E7%B1%BB%E5%BA%93/</guid><description>&lt;p>PHP常用类库&lt;/p>
&lt;p>数组类&lt;/p>
&lt;p>class libArray
{
/**
* 多维数组合并
* @return array
*/
public static function merge ()
{
$args = func_get_args();
$array = [];
foreach ( $args as $arg ) {
if ( is_array($arg) ) {
foreach ( $arg as $k =&amp;gt; $v ) {
if ( is_array($v) ) {
$array[$k] = isset($array[$k]) ? $array[$k] : [];
$array[$k] = self::merge($array[$k], $v);
} else {
$array[$k] = $v;
}
}
}
}
return $array;
}&lt;/p>
&lt;pre>&lt;code>/**
* 多维to一维
* [1=&amp;gt;['a'=&amp;gt;'v1']] to ['1|a'=&amp;gt;'v1']
* @param array $array
* @param string $delimiter
* @param string $key
* @return array
*/
public static function mTo1 (array $array, $delimiter = '|', $key = '')
{
$data = [];
if ( !is_array($array) ) {
return $data;
}
foreach ( $array as $k =&amp;gt; $v ) {
$keyNew = trim($key.$delimiter.$k, $delimiter);
if ( is_array($v) ) {
$data = array_merge($data, self::mTo1($v, $delimiter, $keyNew));
} else {
$data[$keyNew] = $v;
}
}
return $data;
}
/**
* 数组排序
* @param array $array
* @param $column
* @param bool $reverse
* @return bool
*/
public static function sort (array &amp;amp;$array, $column, $reverse = FALSE)
{
$arrColumn = [];
foreach ( $array as $key =&amp;gt; $val ) {
$arrColumn[$key] = $val[$column];
}
return array_multisort($arrColumn, $reverse ? SORT_DESC : SORT_ASC, $array);
}
/**
* 添加索引
* @param array $array
* @param $key
* @return array
*/
public static function index (array $array, $key)
{
$ret = [];
foreach ( $array as $val ) {
$ret[$val[$key]] = $val;
}
return $ret;
}
/**
* 添加前后缀
* @param $array
* @param null $pre
* @param null $suf
* @return array
*/
public static function addFix (array $array, $pre = NULL, $suf = NULL)
{
$ret = [];
foreach ( $array as $key =&amp;gt; $val ) {
$ret[$key] = $pre.$val.$suf;
}
return $ret;
}
&lt;/code>&lt;/pre>
&lt;p>}
数据检查类&lt;/p>
&lt;p>class libCheck
{
/**
* 是否为IP（IPv4）
* @param $ip
* @return bool
*/
public static function isIP ($ip)
{
$isIP = filter_var($ip, FILTER_VALIDATE_IP) ? TRUE : FALSE;
return $isIP;
}&lt;/p>
&lt;pre>&lt;code>/**
* 是否为邮箱地址
* @param $mail
* @return bool
*/
public static function isMail ($mail)
{
$isMail = filter_var($mail, FILTER_VALIDATE_EMAIL) ? TRUE : FALSE;
return $isMail;
}
/**
* 是否为URL
* @param $url
* @return bool
*/
public static function isURL ($url)
{
$isMail = filter_var($url, FILTER_VALIDATE_URL) ? TRUE : FALSE;
return $isMail;
}
/**
* 是否为正整数
* @param $num
* @return bool
*/
public static function isPosiInt ($num)
{
$isPosiInt = is_int($num) &amp;amp;&amp;amp; $num &amp;gt; 0;
return $isPosiInt;
}
/**
* 是否在范围内
* @param $num
* @param int $min
* @param null $max
* @return bool
*/
public static function isBetween ($num, $min = 0, $max = NULL)
{
$isBetween = $num &amp;gt;= $min;
if ( $max ) {
$isBetween = $isBetween &amp;amp;&amp;amp; $num &amp;lt;= $max;
}
return $isBetween;
}
/**
* 是否为有效长度
* @param $str
* @param int $min
* @param null $max
* @return bool
*/
public static function isValidLen ($str, $min = 1, $max = NULL)
{
$length = mb_strlen($str);
$isValidLen = self::isBetween($length, $min, $max);
return $isValidLen;
}
&lt;/code>&lt;/pre>
&lt;p>}
文件类&lt;/p>
&lt;p>class libFile
{
/**
* 获取目录下所有文件
* @param $path
* @return array
*/
public static function getFiles ($path)
{
$path = self::formatePath($path);
if (!is_dir($path)) {
return [];
}
$dh = opendir($path);
$files = [];
while ( ($filename = readdir($dh)) !== FALSE ) {
if ( $filename != &amp;lsquo;.&amp;rsquo; &amp;amp;&amp;amp; $filename != &amp;lsquo;..&amp;rsquo; ) {
$files[] = implode(&amp;rsquo;/&amp;rsquo;, [$path, $filename]);
}
}
closedir($dh);
return $files;
}&lt;/p>
&lt;pre>&lt;code>/**
* 按模式取目录下文件
* @param $path
* @param $pattern
* @return array
*/
public static function getFilesByPattern ($path, $pattern)
{
$path = self::formatePath($path);
$filePattern = sprintf('%s/%s', $path, $pattern);
return glob($filePattern);
}
/**
* 递归删除文件夹
* @param $dir
* @return bool
*/
public static function rmDir($dir)
{
$dir = self::formatePath($dir);
$dh = opendir($dir);
while ($filename = readdir($dh)) {
if ($filename != '.' &amp;amp;&amp;amp; $filename != '..') {
$path = sprintf('%s/%s', $dir, $filename);
is_dir($path) ? self::rmDir($path) : unlink($path);
}
}
closedir($dh);
return rmdir($dir);
}
/**
* 获取最后修改时间
* @param $path
* @return int
*/
public static function getModifiedTime ($path)
{
return filemtime($path);
}
/**
* 格式化路径
* @param $path
* @return string
*/
public static function formatePath ($path)
{
return rtrim($path, '/');
}
&lt;/code>&lt;/pre>
&lt;p>}
HTTP类&lt;/p>
&lt;p>class libHttp
{
/**
* GET方法
* @param $url
* @param array $options
* @return bool|mixed
*/
public static function get ($url, $options = [])
{
return self::send($url, NULL, NULL, $options);
}&lt;/p>
&lt;pre>&lt;code>/**
* POST方法
* @param $url
* @param array $params
* @param array $options
* @return bool|mixed
*/
public static function post ($url, $params = [], $options = [])
{
return self::send($url, 'POST', $params, $options);
}
/**
* @param $url
* @param string $method
* @param array $params
* @param array $options
* @return mixed|string
*/
public static function send ($url, $method = 'GET', $params = [], $options = [])
{
$ch = curl_init($url);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);
curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 30);
if ($method == 'POST') {
$options[CURLOPT_POST] = TRUE;
$options[CURLOPT_POSTFIELDS] = $params;
}
curl_setopt_array($ch, $options);
$result = curl_exec($ch);
return curl_errno($ch) ? curl_error($ch) : $result;
}
&lt;/code>&lt;/pre>
&lt;p>}
字符串类&lt;/p>
&lt;p>class libString
{
/**
* 随机字符串
* @param int $length
* @param bool $num
* @param bool $lower
* @param bool $upper
* @return string
*/
public static function rand ($length=5, $num=TRUE, $lower=TRUE, $upper=TRUE)
{
$str = &amp;lsquo;&amp;rsquo;;
$num &amp;amp;&amp;amp; $str .= &amp;lsquo;0123456789&amp;rsquo;;
$lower &amp;amp;&amp;amp; $str .= &amp;lsquo;abcdefghijklmnopqrstuvwxyz&amp;rsquo;;
$upper &amp;amp;&amp;amp; $str .= &amp;lsquo;ABCDEFGHIJKLMNOPQRSTUVWXYZ&amp;rsquo;;
$rand = substr(str_shuffle($str), -$length);
return $rand;
}&lt;/p>
&lt;pre>&lt;code>/**
* 字符串截取（单次）
* @param $ld
* @param $rd
* @param $str
* @return string
*/
public static function sub ($ld, $rd, $str)
{
$start = strpos($str, $ld) + strlen($ld);
$end = strpos($str, $rd, $start);
$data = substr($str, $start, $end - $start);
return $data;
}
/**
* 字符串截取（批量）
* @param $ld
* @param $rd
* @param $str
* @return array
*/
public static function subs ($ld, $rd, $str)
{
$data = [];
$lLen = strlen($ld);
$rLen = strlen($rd);
$offset = 0;
while ( ($start = strpos($str, $ld, $offset)) !== FALSE ) {
$start += $lLen;
$end = strpos($str, $rd, $start);
$data[] = substr($str, $start, $end - $start);
$offset = $end + $rLen;
}
return $data;
}
/**
* 生成唯一ID
* @return string
*/
public static function uniqid ()
{
return md5(uniqid(rand(), true));
}
&lt;/code>&lt;/pre>
&lt;p>}
其它工具类&lt;/p>
&lt;p>class libTool
{
/**
* ip-&amp;gt;int
* @param $ip
* @return string
*/
public static function ip2long ($ip)
{
$long = sprintf(&amp;rsquo;%u&amp;rsquo;, ip2long($ip));
return $long;
}&lt;/p>
&lt;pre>&lt;code>/**
* 系统负载
* @return mixed
*/
public static function loadAvg ()
{
$load = sys_getloadavg()[0];
return $load;
}
/**
* 写日志文件
* @param $file
* @param $msg
* @param bool $newLine
*/
public static function log ($file, $msg, $newLine = TRUE)
{
$newLine &amp;amp;&amp;amp; $msg .= &amp;quot;\n&amp;quot;;
file_put_contents($file, $msg, FILE_APPEND);
}
/**
* 内存使用峰值(M)
* @return float
*/
public static function memoryUsage ()
{
$memory = memory_get_peak_usage(TRUE) / pow(1024, 2);
$memory = round($memory, 2);
return $memery;
}
/**
* 浏览器变量输出
* @param $var
* @param bool|FALSE $return
* @param bool|TRUE $strict
* @return bool|mixed|string
*/
public static function dump ($var, $return = FALSE, $strict = TRUE)
{
if (!$strict) {
if (ini_get('html_errors')) {
$output = print_r($var, TRUE);
$output = sprintf('&amp;lt;pre&amp;gt;%s&amp;lt;/pre&amp;gt;', htmlspecialchars($output, ENT_QUOTES));
} else {
$output = print_r($var, TRUE);
}
} else {
ob_start();
var_dump($var);
$output = ob_get_clean();
if (!extension_loaded('xdebug')) {
$output = preg_replace('/\]\=\&amp;gt;\n(\s+)/m', '] =&amp;gt; ', $output);
$output = sprintf('&amp;lt;pre&amp;gt;%s&amp;lt;/pre&amp;gt;', htmlspecialchars($output, ENT_QUOTES));
}
}
if ($return) {
return $output;
} else {
echo $output;
return TRUE;
}
}
&lt;/code>&lt;/pre>
&lt;p>}&lt;/p></description></item><item><title>微信二维码技术原理</title><link>https://60ke.github.io/drafts/%E5%BE%AE%E4%BF%A1%E4%BA%8C%E7%BB%B4%E7%A0%81%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86/</link><pubDate>Wed, 10 Feb 2016 03:05:00 +0000</pubDate><guid>https://60ke.github.io/drafts/%E5%BE%AE%E4%BF%A1%E4%BA%8C%E7%BB%B4%E7%A0%81%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86/</guid><description>&lt;p>微信扫描二维码登录网站 网站应用微信登录开发指南&lt;/p>
&lt;p>微信扫描二维码登录网站是微信开放平台下网站应用的一种接口实现的功能。微信开放平台的网址是 &lt;a class="link" href="https://open.weixin.qq.com" target="_blank" rel="noopener"
>https://open.weixin.qq.com&lt;/a>&lt;/p>
&lt;p>准备工作
网站应用微信登录是基于OAuth2.0协议标准构建的微信OAuth2.0授权登录系统。&lt;/p>
&lt;p>在进行微信OAuth2.在进行微信OAuth2.0授权登录接入之前,在微信开放平台注册开发者帐号,并拥有一个已审核通过的网站应用,并获得相应的AppID和AppSecret,申请微信登录且通过审核后,可开始接入流程。&lt;/p>
&lt;p>授权流程说明
微信OAuth2.0授权登录让微信用户使用微信身份安全登录第三方应用或网站,在微信用户授权登录已接入微信OAuth2.0的第三方应用后,第三方可以获取到用户的接口调用凭证（access_token）,通过access_token可以进行微信开放平台授权关系接口调用,从而可实现获取微信用户基本开放信息和帮助用户实现基础开放功能等。&lt;/p>
&lt;p>微信OAuth2.0授权登录目前支持authorization_code模式,适用于拥有server端的应用授权。该模式整体流程为：&lt;/p>
&lt;ol>
&lt;li>第三方发起微信授权登录请求,微信用户允许授权第三方应用后,微信会拉起应用或重定向到第三方网站,并且带上授权临时票据code参数；&lt;/li>
&lt;li>通过code参数加上AppID和AppSecret等,通过API换取access_token；&lt;/li>
&lt;li>通过access_token进行接口调用,获取用户基本数据资源或帮助用户实现基本操作。
获取access_token时序图：&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="http://www.worileqing.top/usr/uploads/2017/04/1979070331.png"
loading="lazy"
alt="12168b9.png"
>&lt;/p>
&lt;p>第一步：请求CODE
第三方使用网站应用授权登录前请注意已获取相应网页授权作用域（scope=snsapi_login）,则可以通过在PC端打开以下链接：
&lt;a class="link" href="https://open.weixin.qq.com/connect/qrconnect?appid=APPID&amp;amp;redirect_uri=REDIRECT_URI&amp;amp;response_type=code&amp;amp;scope=SCOPE&amp;amp;state=STATE#wechat_redirect" target="_blank" rel="noopener"
>https://open.weixin.qq.com/connect/qrconnect?appid=APPID&amp;redirect_uri=REDIRECT_URI&amp;response_type=code&amp;scope=SCOPE&amp;state=STATE#wechat_redirect&lt;/a>&lt;/p>
&lt;p>若提示“该链接无法访问”,请检查参数是否填写错误,如redirect_uri的域名与审核时填写的授权域名不一致或scope不为snsapi_login。&lt;/p>
&lt;p>参数说明
参数 是否必须 说明
appid 是 应用唯一标识
redirect_uri 是 重定向地址,需要进行UrlEncode
response_type 是 填code
scope 是 应用授权作用域,拥有多个作用域用逗号（,）分隔,网页应用目前仅填写snsapi_login即可
state 否 用于保持请求和回调的状态,授权请求后原样带回给第三方。该参数可用于防止csrf攻击（跨站请求伪造攻击）,建议第三方带上该参数,可设置为简单的随机数加session进行校验
返回说明
用户允许授权后,将会重定向到redirect_uri的网址上,并且带上code和state参数&lt;/p>
&lt;p>redirect_uri?code=CODE&amp;amp;state=STATE
若用户禁止授权,则重定向后不会带上code参数,仅会带上state参数&lt;/p>
&lt;p>redirect_uri?state=STATE
请求示例
登录一号店网站应用&lt;/p>
&lt;p>&lt;a class="link" href="https://passport.yhd.com/wechat/login.do" target="_blank" rel="noopener"
>https://passport.yhd.com/wechat/login.do&lt;/a>&lt;/p>
&lt;p>打开后,一号店会生成state参数,跳转到
&lt;a class="link" href="https://open.weixin.qq.com/connect/qrconnect?appid=wxbdc5610cc59c1631&amp;amp;redirect_uri=https%3A%2F%2Fpassport.yhd.com%2Fwechat%2Fcallback.do&amp;amp;response_type=code&amp;amp;scope=snsapi_login&amp;amp;state=3d6be0a4035d839573b04816624a415e#wechat_redirect" target="_blank" rel="noopener"
>https://open.weixin.qq.com/connect/qrconnect?appid=wxbdc5610cc59c1631&amp;redirect_uri=https%3A%2F%2Fpassport.yhd.com%2Fwechat%2Fcallback.do&amp;response_type=code&amp;scope=snsapi_login&amp;state=3d6be0a4035d839573b04816624a415e#wechat_redirect&lt;/a>&lt;/p>
&lt;p>微信用户使用微信扫描二维码并且确认登录后,PC端会跳转到&lt;/p>
&lt;p>&lt;a class="link" href="https://passport.yhd.com/wechat/callback.do?code=CODE&amp;amp;state=3d6be0a4035d839573b04816624a415e" target="_blank" rel="noopener"
>https://passport.yhd.com/wechat/callback.do?code=CODE&amp;state=3d6be0a4035d839573b04816624a415e&lt;/a>&lt;/p>
&lt;p>为了满足网站更定制化的需求,我们还提供了第二种获取code的方式,支持网站将微信登录二维码内嵌到自己页面中,用户使用微信扫码授权后通过JS将code返回给网站。&lt;/p>
&lt;p>JS微信登录主要用途：网站希望用户在网站内就能完成登录,无需跳转到微信域下登录后再返回,提升微信登录的流畅性与成功率。 网站内嵌二维码微信登录JS实现办法：&lt;/p>
&lt;p>步骤1：在页面中先引入如下JS文件（支持https）：&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;p>步骤2：在需要使用微信登录的地方实例以下JS对象：
var obj = new WxLogin({
id:&amp;ldquo;login_container&amp;rdquo;,
appid: &amp;ldquo;&amp;rdquo;,
scope: &amp;ldquo;&amp;rdquo;,
redirect_uri: &amp;ldquo;&amp;rdquo;,
state: &amp;ldquo;&amp;rdquo;,
style: &amp;ldquo;&amp;rdquo;,
href: &amp;quot;&amp;quot;
}); &lt;br>
参数说明
参数 是否必须 说明
id 是 第三方页面显示二维码的容器id
appid 是 应用唯一标识,在微信开放平台提交应用审核通过后获得
scope 是 应用授权作用域,拥有多个作用域用逗号（,）分隔,网页应用目前仅填写snsapi_login即可
redirect_uri 是 重定向地址,需要进行UrlEncode
state 否 用于保持请求和回调的状态,授权请求后原样带回给第三方。该参数可用于防止csrf攻击 &lt;br>
style 否 提供&amp;quot;black&amp;quot;、&amp;ldquo;white&amp;quot;可选,默认为黑色文字描述。详见文档底部FAQ
href 否 自定义样式链接,第三方可根据实际需求覆盖默认样式。详见文档底部FAQ
第二步：通过code获取access_token
通过code获取access_token&lt;/p>
&lt;p>&lt;a class="link" href="https://api.weixin.qq.com/sns/oauth2/access_token?appid=APPID&amp;amp;secret=SECRET&amp;amp;code=CODE&amp;amp;grant_type=authorization_code" target="_blank" rel="noopener"
>https://api.weixin.qq.com/sns/oauth2/access_token?appid=APPID&amp;secret=SECRET&amp;code=CODE&amp;grant_type=authorization_code&lt;/a>
参数说明
参数 是否必须 说明
appid 是 应用唯一标识,在微信开放平台提交应用审核通过后获得
secret 是 应用密钥AppSecret,在微信开放平台提交应用审核通过后获得
code 是 填写第一步获取的code参数
grant_type 是 填authorization_code
返回说明
正确的返回：&lt;/p>
&lt;p>{
&amp;ldquo;access_token&amp;rdquo;:&amp;ldquo;ACCESS_TOKEN&amp;rdquo;,
&amp;ldquo;expires_in&amp;rdquo;:7200,
&amp;ldquo;refresh_token&amp;rdquo;:&amp;ldquo;REFRESH_TOKEN&amp;rdquo;,
&amp;ldquo;openid&amp;rdquo;:&amp;ldquo;OPENID&amp;rdquo;,
&amp;ldquo;scope&amp;rdquo;:&amp;ldquo;SCOPE&amp;rdquo;
}
参数 说明
access_token 接口调用凭证
expires_in access_token接口调用凭证超时时间,单位（秒）
refresh_token 用户刷新access_token
openid 授权用户唯一标识
scope 用户授权的作用域,使用逗号（,）分隔
错误返回样例：&lt;/p>
&lt;p>{&amp;ldquo;errcode&amp;rdquo;:40029,&amp;ldquo;errmsg&amp;rdquo;:&amp;ldquo;invalid code&amp;rdquo;}
刷新access_token有效期
access_token是调用授权关系接口的调用凭证,由于access_token有效期（目前为2个小时）较短,当access_token超时后,可以使用refresh_token进行刷新,access_token刷新结果有两种：&lt;/p>
&lt;ol>
&lt;li>若access_token已超时,那么进行refresh_token会获取一个新的access_token,新的超时时间；&lt;/li>
&lt;li>若access_token未超时,那么进行refresh_token不会改变access_token,但超时时间会刷新,相当于续期access_token。
refresh_token拥有较长的有效期（30天）,当refresh_token失效的后,需要用户重新授权。&lt;/li>
&lt;/ol>
&lt;p>请求方法
获取第一步的code后,请求以下链接进行refresh_token：&lt;/p>
&lt;p>&lt;a class="link" href="https://api.weixin.qq.com/sns/oauth2/refresh_token?appid=APPID&amp;amp;grant_type=refresh_token&amp;amp;refresh_token=REFRESH_TOKEN" target="_blank" rel="noopener"
>https://api.weixin.qq.com/sns/oauth2/refresh_token?appid=APPID&amp;grant_type=refresh_token&amp;refresh_token=REFRESH_TOKEN&lt;/a>
参数说明
参数 是否必须 说明
appid 是 应用唯一标识
grant_type 是 填refresh_token
refresh_token 是 填写通过access_token获取到的refresh_token参数
返回说明
正确的返回：&lt;/p>
&lt;p>{
&amp;ldquo;access_token&amp;rdquo;:&amp;ldquo;ACCESS_TOKEN&amp;rdquo;,
&amp;ldquo;expires_in&amp;rdquo;:7200,
&amp;ldquo;refresh_token&amp;rdquo;:&amp;ldquo;REFRESH_TOKEN&amp;rdquo;,
&amp;ldquo;openid&amp;rdquo;:&amp;ldquo;OPENID&amp;rdquo;,
&amp;ldquo;scope&amp;rdquo;:&amp;ldquo;SCOPE&amp;rdquo;
}
参数 说明
access_token 接口调用凭证
expires_in access_token接口调用凭证超时时间,单位（秒）
refresh_token 用户刷新access_token
openid 授权用户唯一标识
scope 用户授权的作用域,使用逗号（,）分隔
错误返回样例：&lt;/p>
&lt;p>{&amp;ldquo;errcode&amp;rdquo;:40030,&amp;ldquo;errmsg&amp;rdquo;:&amp;ldquo;invalid refresh_token&amp;rdquo;}
第三步：通过access_token调用接口
获取access_token后,进行接口调用,有以下前提：&lt;/p>
&lt;ol>
&lt;li>access_token有效且未超时；&lt;/li>
&lt;li>微信用户已授权给第三方应用帐号相应接口作用域（scope）。
对于接口作用域（scope）,能调用的接口有以下：&lt;/li>
&lt;/ol>
&lt;p>授权作用域（scope） 接口 接口说明
snsapi_base /sns/oauth2/access_token 通过code换取access_token、refresh_token和已授权scope
/sns/oauth2/refresh_token 刷新或续期access_token使用
/sns/auth 检查access_token有效性
snsapi_userinfo /sns/userinfo 获取用户个人信息
其中snsapi_base属于基础接口,若应用已拥有其它scope权限,则默认拥有snsapi_base的权限。使用snsapi_base可以让移动端网页授权绕过跳转授权登录页请求用户授权的动作,直接跳转第三方网页带上授权临时票据（code）,但会使得用户已授权作用域（scope）仅为snsapi_base,从而导致无法获取到需要用户授权才允许获得的数据和基础功能。&lt;/p>
&lt;p>接口调用方法可查阅《微信授权关系接口调用指南》&lt;/p>
&lt;p>F.A.Q&lt;/p>
&lt;ol>
&lt;li>
&lt;p>什么是授权临时票据（code）？
答：第三方通过code进行获取access_token的时候需要用到,code的超时时间为10分钟,一个code只能成功换取一次access_token即失效。code的临时性和一次保障了微信授权登录的安全性。第三方可通过使用https和state参数,进一步加强自身授权登录的安全性。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>什么是授权作用域（scope）？
答：授权作用域（scope）代表用户授权给第三方的接口权限,第三方应用需要向微信开放平台申请使用相应scope的权限后,使用文档所述方式让用户进行授权,经过用户授权,获取到相应access_token后方可对接口进行调用。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>网站内嵌二维码微信登录JS代码中style字段作用？
答：第三方页面颜色风格可能为浅色调或者深色调,若第三方页面为浅色背景,style字段应提供&amp;quot;black&amp;quot;值（或者不提供,black为默认值）,则对应的微信登录文字样式为黑色。相关效果如下：&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>若提供&amp;quot;white&amp;quot;值,则对应的文字描述将显示为白色,适合深色背景。相关效果如下：&lt;/p>
&lt;p>4.网站内嵌二维码微信登录JS代码中href字段作用？
答：如果第三方觉得微信团队提供的默认样式与自己的页面样式不匹配,可以自己提供样式文件来覆盖默认样式。举个例子,如第三方觉得默认二维码过大,可以提供相关css样式文件,并把链接地址填入href字段&lt;/p>
&lt;p>.impowerBox .qrcode {width: 200px;}
.impowerBox .title {display: none;}
.impowerBox .info {width: 200px;}
.status_icon {display：none}
.impowerBox .status {text-align: center;}
相关效果如下：&lt;/p>
&lt;p>============================================&lt;/p></description></item><item><title>微信公众号开发-1</title><link>https://60ke.github.io/drafts/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91-1/</link><pubDate>Sun, 24 Jan 2016 15:06:00 +0000</pubDate><guid>https://60ke.github.io/drafts/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91-1/</guid><description>&lt;ol>
&lt;li>注册微信公众平台账号
微信公众平台:
&lt;a class="link" href="https://mp.weixin.qq.com/" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/&lt;/a>&lt;/li>
&lt;/ol>
&lt;p>注: 目前一张身份证只能注册两个账号,账号名称关乎加V认证,请慎重注册。&lt;/p>
&lt;ol start="2">
&lt;li>
&lt;p>申请服务器/虚拟主机
没有服务器/虚拟主机的童鞋可以使用BAE和SAE,不多介绍。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>开启开发者模式
微信公众平台有两个模式,一个是编辑模式（傻瓜模式）,简单但功能单一。另一个是开发者模式,可以通过开发实现复杂功能。两个模式互斥,显而易见,登录微信公众平台并通过“高级功能”菜单开启开发者模式。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>填写接口配置信息
同样是在“高级功能”菜单中配置,需要配置两项参数:
URL: 开发者应用访问地址,目前仅支持80端口,以“http://www.worileqing.top/weixin/index.php”为例。
TOKEN: 随意填写,用于生成签名,以“YoonPer”为例。
填写完把下面代码保存为index.php并上传至http://www.worileqing.top/weixin/目录,最后点击“提交”完成验证。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="mo">01&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;?&lt;/span>&lt;span class="nx">php&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">02&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">define&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;TOKEN&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;YoonPer&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">//TOKEN值
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="mo">03&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$wechatObj&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">wechat&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">04&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$wechatObj&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">valid&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">05&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">wechat&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">06&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">public&lt;/span> &lt;span class="k">function&lt;/span> &lt;span class="nf">valid&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">07&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$echoStr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$_GET&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;echostr&amp;#34;&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">08&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">checkSignature&lt;/span>&lt;span class="p">()){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">09&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">echo&lt;/span> &lt;span class="nv">$echoStr&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">exit&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">13&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">14&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">private&lt;/span> &lt;span class="k">function&lt;/span> &lt;span class="nf">checkSignature&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">15&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$signature&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$_GET&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;signature&amp;#34;&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$timestamp&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$_GET&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">17&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$nonce&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$_GET&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;nonce&amp;#34;&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">18&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$token&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">TOKEN&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">19&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$tmpArr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$token&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nv">$timestamp&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nv">$nonce&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">sort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$tmpArr&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">21&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$tmpStr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">implode&lt;/span>&lt;span class="p">(&lt;/span> &lt;span class="nv">$tmpArr&lt;/span> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$tmpStr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">sha1&lt;/span>&lt;span class="p">(&lt;/span> &lt;span class="nv">$tmpStr&lt;/span> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">23&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span> &lt;span class="nv">$tmpStr&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nv">$signature&lt;/span> &lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">true&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">25&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">26&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">false&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">27&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">28&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">29&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">30&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">?&amp;gt;&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这玩意儿就是微信公众平台校验URL是否正确接入,研究代码没有实质性意义,验证完即可删除文件,就不详细说明了,有兴趣的童鞋可以查看官方文档。
微信公众平台API文档:
&lt;a class="link" href="http://mp.weixin.qq.com/wiki/index.php" target="_blank" rel="noopener"
>http://mp.weixin.qq.com/wiki/index.php&lt;/a>&lt;/p>
&lt;ol start="5">
&lt;li>开发微信公众平台功能
OK,上面提到了,微信公众平台与开发者之间的数据交互是通过XML完成的,既然用到XML,当然得遵循规范,所以在着手开发之前先看看官方接口文档提供的XML规范,以文本消息为例:&lt;/li>
&lt;/ol>
&lt;p>当用户向微信公众账号发送消息时,微信服务器会POST给开发者一些数据:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="mo">01&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">xml&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">02&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;!--&lt;/span>&lt;span class="nx">开发者微信号&lt;/span>&lt;span class="o">--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">03&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">ToUserName&lt;/span>&lt;span class="o">&amp;gt;&amp;lt;!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">CDATA&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">toUser&lt;/span>&lt;span class="p">]]&lt;/span>&lt;span class="o">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nx">ToUserName&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">04&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;!--&lt;/span>&lt;span class="nx">发送方帐号（OpenID）&lt;/span>&lt;span class="o">--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">05&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">FromUserName&lt;/span>&lt;span class="o">&amp;gt;&amp;lt;!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">CDATA&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">fromUser&lt;/span>&lt;span class="p">]]&lt;/span>&lt;span class="o">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nx">FromUserName&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">06&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;!--&lt;/span>&lt;span class="nx">消息创建时间&lt;/span> &lt;span class="nx">（整型）&lt;/span>&lt;span class="o">--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">07&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">CreateTime&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="mi">12345678&lt;/span>&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="nx">CreateTime&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">08&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;!--&lt;/span>&lt;span class="nx">消息类别&lt;/span> &lt;span class="nx">（text文本消息）&lt;/span>&lt;span class="o">--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">09&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">MsgType&lt;/span>&lt;span class="o">&amp;gt;&amp;lt;!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">CDATA1&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nx">MsgType&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;!--&lt;/span>&lt;span class="nx">消息内容&lt;/span>&lt;span class="o">--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">Content&lt;/span>&lt;span class="o">&amp;gt;&amp;lt;!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">CDATA&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">content&lt;/span>&lt;span class="p">]]&lt;/span>&lt;span class="o">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nx">Content&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;!--&lt;/span>&lt;span class="nx">消息ID&lt;/span> &lt;span class="nx">（64位整型）&lt;/span>&lt;span class="o">--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">13&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">MsgId&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="mi">1234567890123456&lt;/span>&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="nx">MsgId&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">14&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="nx">xml&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">开发者在处理完消息后需要返回数据给微信服务器&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">01&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">xml&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">02&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;!--&lt;/span>&lt;span class="nx">接收方帐号（OpenID）&lt;/span>&lt;span class="o">--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">03&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">ToUserName&lt;/span>&lt;span class="o">&amp;gt;&amp;lt;!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">CDATA&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">toUser&lt;/span>&lt;span class="p">]]&lt;/span>&lt;span class="o">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nx">ToUserName&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">04&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;!--&lt;/span>&lt;span class="nx">开发者微信号&lt;/span>&lt;span class="o">--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">05&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">FromUserName&lt;/span>&lt;span class="o">&amp;gt;&amp;lt;!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">CDATA&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">fromUser&lt;/span>&lt;span class="p">]]&lt;/span>&lt;span class="o">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nx">FromUserName&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">06&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;!--&lt;/span>&lt;span class="nx">消息创建时间&lt;/span> &lt;span class="nx">（整型）&lt;/span>&lt;span class="o">--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">07&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">CreateTime&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="mi">12345678&lt;/span>&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="nx">CreateTime&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">08&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;!--&lt;/span>&lt;span class="nx">消息类别&lt;/span> &lt;span class="nx">（text文本消息）&lt;/span>&lt;span class="o">--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">09&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">MsgType&lt;/span>&lt;span class="o">&amp;gt;&amp;lt;!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">CDATA1&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nx">MsgType&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;!--&lt;/span>&lt;span class="nx">回复消息内容&lt;/span>&lt;span class="o">--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">Content&lt;/span>&lt;span class="o">&amp;gt;&amp;lt;!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">CDATA&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">content&lt;/span>&lt;span class="p">]]&lt;/span>&lt;span class="o">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nx">Content&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;!--&lt;/span>&lt;span class="nx">星标操作（位0x0001被标志时&lt;/span> &lt;span class="nx">星标刚收到的消息）&lt;/span>&lt;span class="o">--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">13&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">FuncFlag&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="nx">FuncFlag&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">14&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="nx">xml&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">除文本消息外&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nx">微信公众平台还支持用户发送图片消息、地理位置消息、链接消息、事件推送&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nx">而开发者还可以向微信公众平台回复音乐消息和图文消息&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nx">各类消息XML规范也可以参见官方文档。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">来看看官方提供的一个PHP示例&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nx">我做了一些精简&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">01&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;?&lt;/span>&lt;span class="nx">php&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">02&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$wechatObj&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">wechat&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">03&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$wechatObj&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">responseMsg&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">04&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">wechat&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">05&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">public&lt;/span> &lt;span class="k">function&lt;/span> &lt;span class="nf">responseMsg&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">06&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">07&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//---------- 接 收 数 据 ---------- //
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="mi">08&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">09&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$postStr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$GLOBALS&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;HTTP_RAW_POST_DATA&amp;#34;&lt;/span>&lt;span class="p">];&lt;/span> &lt;span class="c1">//获取POST数据
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//用SimpleXML解析POST过来的XML数据
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="mi">12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$postObj&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">simplexml_load_string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$postStr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;SimpleXMLElement&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nx">LIBXML_NOCDATA&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">13&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">14&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$fromUsername&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$postObj&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">FromUserName&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">//获取发送方帐号（OpenID）
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="mi">15&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$toUsername&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$postObj&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">ToUserName&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">//获取接收方账号
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="mi">16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$keyword&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">trim&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$postObj&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">Content&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">//获取消息内容
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="mi">17&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$time&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">();&lt;/span> &lt;span class="c1">//获取当前时间戳
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="mi">18&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">19&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//---------- 返 回 数 据 ---------- //
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="mi">21&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//返回消息模板
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="mi">23&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$textTpl&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&amp;lt;xml&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">24
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> &amp;lt;ToUserName&amp;gt;&amp;lt;![CDATA[%s]]&amp;gt;&amp;lt;/ToUserName&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">25
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> &amp;lt;FromUserName&amp;gt;&amp;lt;![CDATA[%s]]&amp;gt;&amp;lt;/FromUserName&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">26
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> &amp;lt;CreateTime&amp;gt;%s&amp;lt;/CreateTime&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">27
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> &amp;lt;MsgType&amp;gt;&amp;lt;![CDATA[%s]]&amp;gt;&amp;lt;/MsgType&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">28
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> &amp;lt;Content&amp;gt;&amp;lt;![CDATA[%s]]&amp;gt;&amp;lt;/Content&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">29
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> &amp;lt;FuncFlag&amp;gt;0&amp;lt;/FuncFlag&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">30
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> &amp;lt;/xml&amp;gt;&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">31&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">32&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$msgType&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;text&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">//消息类型
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="mi">33&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$contentStr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;http://www.worileqing.top&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">//返回消息内容
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="mi">34&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">35&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//格式化消息模板
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="mi">36&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$resultStr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">sprintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$textTpl&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nv">$fromUsername&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nv">$toUsername&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">37&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$time&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nv">$msgType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nv">$contentStr&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">38&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">echo&lt;/span> &lt;span class="nv">$resultStr&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">//输出结果
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="mi">39&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">40&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">41&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">?&amp;gt;&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>把代码保存为index.php并上传至http://www.worileqing.top/weixin/目录,如果刚才没删除该文件,则直接覆盖。&lt;/p>
&lt;p>现在用户通过微信公众平台发送任何消息公众账号均会返回一条内容为“http://www.worileqing.top”的消息。
接下来需要做的就是根据用户消息动态返回结果~&lt;/p>
&lt;p>SimSimi（小黄鸡）是目前比较火的聊天机器人,我用CURL开发了一个免费的SimSimi（小黄鸡）接口,传入关键词会返回文本回复,这部分不是本文重点,就不多说明,直接上代码(2014.07.28更新):&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="mo">01&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;?&lt;/span>&lt;span class="nx">php&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">02&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> &lt;span class="nf">simsimi&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">$keyword&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">03&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">04&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$keyword&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">urlencode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$keyword&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">05&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//----------- 获取COOKIE ----------//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="mo">06&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$url&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;http://www.simsimi.com/&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mo">07&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$ch&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">curl_init&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$url&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">08&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">curl_setopt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$ch&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">CURLOPT_HEADER&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">09&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">curl_setopt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$ch&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">CURLOPT_RETURNTRANSFER&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$content&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">curl_exec&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$ch&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$header&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nv">$body&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">explode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\r\n\r\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nv">$content&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">preg_match_all&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;/set\-cookie:([^&lt;/span>&lt;span class="se">\r\n&lt;/span>&lt;span class="s2">]*);/iU&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nv">$header&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nv">$matches&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">13&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$cookie&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">implode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nv">$matches&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="s2">&amp;#34;;simsimi_uid=1;&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">14&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">curl_close&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$ch&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">15&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//----------- 抓 取 回 复 ----------//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="mi">16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$url&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;http://www.simsimi.com/func/reqN?lc=ch&amp;amp;ft=0.0&amp;amp;req=&lt;/span>&lt;span class="si">$keyword&lt;/span>&lt;span class="s2">&amp;amp;fl=http%3A%2F%2Fwww.simsimi.com%2Ftalk.htm&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">17&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$ch&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">curl_init&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$url&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">18&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">curl_setopt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$ch&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">CURLOPT_RETURNTRANSFER&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">19&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">curl_setopt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$ch&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">CURLOPT_COOKIE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nv">$cookie&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$content&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">json_decode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">curl_exec&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$ch&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">21&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">curl_close&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$ch&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span> &lt;span class="nv">$content&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;result&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;200&amp;#39;&lt;/span> &lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">23&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nv">$content&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;sentence_resp&amp;#39;&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">25&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s1">&amp;#39;我还不会回答这个问题...&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">26&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">27&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">28&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">?&amp;gt;&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>把上面两段代码整合在一起就大功告成了,需要说明一点,微信服务器在5秒内收不到响应会断掉连接,通过此接口有可能会超时,且SimSimi已经屏蔽了BAE和SAE上的抓取请求,推荐使用SimSimi官方收费API,速度比较快~&lt;/p></description></item></channel></rss>